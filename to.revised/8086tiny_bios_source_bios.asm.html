<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>/home/agguro/Documents/tiny8086/8086tiny/bios_source/bios.asm</title><meta charset="utf-8"><style>body{margin:0;padding:0;tab-size:4}
/*

Original highlight.js style (c) Ivan Sagalaev <maniac@softwaremaniacs.org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #F0F0F0;
}


/* Base color: saturation 0; */

.hljs,
.hljs-subst {
  color: #444;
}

.hljs-comment {
  color: #888888;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-meta-keyword,
.hljs-doctag,
.hljs-name {
  font-weight: bold;
}


/* User color: hue: 0 */

.hljs-type,
.hljs-string,
.hljs-number,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #880000;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #BC6060;
}


/* Language color: hue: 90; */

.hljs-literal {
  color: #78A960;
}

.hljs-built_in,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #397300;
}


/* Meta color: hue: 200 */

.hljs-meta {
  color: #1f7199;
}

.hljs-meta-string {
  color: #4d99bf;
}


/* Misc effects */

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

/*

Google Code style (c) Aahan Krish <geekpanth3r@gmail.com>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: white;
  color: black;
}

.hljs-comment,
.hljs-quote {
  color: #800;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-section,
.hljs-title,
.hljs-name {
  color: #008;
}

.hljs-variable,
.hljs-template-variable {
  color: #660;
}

.hljs-string,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-regexp {
  color: #080;
}

.hljs-literal,
.hljs-symbol,
.hljs-bullet,
.hljs-meta,
.hljs-number,
.hljs-link {
  color: #066;
}

.hljs-title,
.hljs-doctag,
.hljs-type,
.hljs-attr,
.hljs-built_in,
.hljs-builtin-name,
.hljs-params {
  color: #606;
}

.hljs-attribute,
.hljs-subst {
  color: #000;
}

.hljs-formula {
  background-color: #eee;
  font-style: italic;
}

.hljs-selector-id,
.hljs-selector-class {
  color: #9B703F
}

.hljs-addition {
  background-color: #baeeba;
}

.hljs-deletion {
  background-color: #ffc8bd;
}

.hljs-doctag,
.hljs-strong {
  font-weight: bold;
}

.hljs-emphasis {
  font-style: italic;
}


/* Line numbers */

table {
  border: none;
  border-collapse: collapse;
}
.line-number {
  border-right: thin solid silver;
  padding-right: 0.3em;
  text-align: right;
  vertical-align: top;
}
.line-text {
  margin-left: 0.7em;
  padding-bottom: 0em;
  white-space: pre-wrap;
}

.hljs { max-width:100%; width:100%; font-family: "'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback'", monospace; font-size: 10pt; }
</style></head><body><table class="hljs"><tbody><tr><td class="line-number">1</td><td class="line-text"><span class="hljs-comment">; BIOS source for 8086tiny IBM PC emulator (revision 1.21 and above). Compiles with NASM.</span>
</td></tr>
<tr><td class="line-number">2</td><td class="line-text"><span class="hljs-comment">; Copyright 2013-14, Adrian Cable (adrian.cable@gmail.com) - http://www.megalith.co.uk/8086tiny</span>
</td></tr>
<tr><td class="line-number">3</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">4</td><td class="line-text"><span class="hljs-comment">; Revision 1.61</span>
</td></tr>
<tr><td class="line-number">5</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">6</td><td class="line-text"><span class="hljs-comment">; This work is licensed under the MIT License. See included LICENSE.TXT.</span>
</td></tr>
<tr><td class="line-number">7</td><td class="line-text">
</td></tr>
<tr><td class="line-number">8</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">9</td><td class="line-text">
</td></tr>
<tr><td class="line-number">10</td><td class="line-text"><span class="hljs-comment">; Here we define macros for some custom instructions that help the emulator talk with the outside</span>
</td></tr>
<tr><td class="line-number">11</td><td class="line-text"><span class="hljs-comment">; world. They are described in detail in the hint.html file, which forms part of the emulator</span>
</td></tr>
<tr><td class="line-number">12</td><td class="line-text"><span class="hljs-comment">; distribution.</span>
</td></tr>
<tr><td class="line-number">13</td><td class="line-text">
</td></tr>
<tr><td class="line-number">14</td><td class="line-text">%macro	extended_putchar_al <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">15</td><td class="line-text">	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x0f</span>, <span class="hljs-number">0x00</span>
</td></tr>
<tr><td class="line-number">16</td><td class="line-text">%endmacro
</td></tr>
<tr><td class="line-number">17</td><td class="line-text">
</td></tr>
<tr><td class="line-number">18</td><td class="line-text">%macro	extended_get_rtc <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">19</td><td class="line-text">	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x0f</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">20</td><td class="line-text">%endmacro
</td></tr>
<tr><td class="line-number">21</td><td class="line-text">
</td></tr>
<tr><td class="line-number">22</td><td class="line-text">%macro	extended_read_disk <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">23</td><td class="line-text">	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x0f</span>, <span class="hljs-number">0x02</span>
</td></tr>
<tr><td class="line-number">24</td><td class="line-text">%endmacro
</td></tr>
<tr><td class="line-number">25</td><td class="line-text">
</td></tr>
<tr><td class="line-number">26</td><td class="line-text">%macro	extended_write_disk <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">27</td><td class="line-text">	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x0f</span>, <span class="hljs-number">0x03</span>
</td></tr>
<tr><td class="line-number">28</td><td class="line-text">%endmacro
</td></tr>
<tr><td class="line-number">29</td><td class="line-text">
</td></tr>
<tr><td class="line-number">30</td><td class="line-text">org	<span class="hljs-number">100h</span>				<span class="hljs-comment">; BIOS loads at offset 0x0100</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">31</td><td class="line-text">
</td></tr>
<tr><td class="line-number">32</td><td class="line-text">main:
</td></tr>
<tr><td class="line-number">33</td><td class="line-text">
</td></tr>
<tr><td class="line-number">34</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	bios_entry
</td></tr>
<tr><td class="line-number">35</td><td class="line-text">
</td></tr>
<tr><td class="line-number">36</td><td class="line-text"><span class="hljs-comment">; Here go pointers to the different data tables used for instruction decoding</span>
</td></tr>
<tr><td class="line-number">37</td><td class="line-text">
</td></tr>
<tr><td class="line-number">38</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode12_reg1	<span class="hljs-comment">; Table 0: R/M mode 1/2 "register 1" lookup</span>
</td></tr>
<tr><td class="line-number">39</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode012_reg2	<span class="hljs-comment">; Table 1: R/M mode 1/2 "register 2" lookup</span>
</td></tr>
<tr><td class="line-number">40</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode12_disp	<span class="hljs-comment">; Table 2: R/M mode 1/2 "DISP multiplier" lookup</span>
</td></tr>
<tr><td class="line-number">41</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode12_dfseg	<span class="hljs-comment">; Table 3: R/M mode 1/2 "default segment" lookup</span>
</td></tr>
<tr><td class="line-number">42</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode0_reg1	<span class="hljs-comment">; Table 4: R/M mode 0 "register 1" lookup</span>
</td></tr>
<tr><td class="line-number">43</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode012_reg2 <span class="hljs-comment">; Table 5: R/M mode 0 "register 2" lookup</span>
</td></tr>
<tr><td class="line-number">44</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode0_disp	<span class="hljs-comment">; Table 6: R/M mode 0 "DISP multiplier" lookup</span>
</td></tr>
<tr><td class="line-number">45</td><td class="line-text">	<span class="hljs-built_in">dw</span>	rm_mode0_dfseg	<span class="hljs-comment">; Table 7: R/M mode 0 "default segment" lookup</span>
</td></tr>
<tr><td class="line-number">46</td><td class="line-text">	<span class="hljs-built_in">dw</span>	xlat_ids	<span class="hljs-comment">; Table 8: Translation of raw opcode index ("Raw ID") to function number ("Xlat'd ID")</span>
</td></tr>
<tr><td class="line-number">47</td><td class="line-text">	<span class="hljs-built_in">dw</span>	ex_data		<span class="hljs-comment">; Table 9: Translation of Raw ID to Extra Data</span>
</td></tr>
<tr><td class="line-number">48</td><td class="line-text">	<span class="hljs-built_in">dw</span>	std_flags	<span class="hljs-comment">; Table 10: How each Raw ID sets the flags (bit 1 = sets SZP, bit 2 = sets AF/OF for arithmetic, bit 3 = sets OF/CF for logic)</span>
</td></tr>
<tr><td class="line-number">49</td><td class="line-text">	<span class="hljs-built_in">dw</span>	parity		<span class="hljs-comment">; Table 11: Parity flag loop-up table (256 entries)</span>
</td></tr>
<tr><td class="line-number">50</td><td class="line-text">	<span class="hljs-built_in">dw</span>	base_size	<span class="hljs-comment">; Table 12: Translation of Raw ID to base instruction size (bytes)</span>
</td></tr>
<tr><td class="line-number">51</td><td class="line-text">	<span class="hljs-built_in">dw</span>	i_w_adder	<span class="hljs-comment">; Table 13: Translation of Raw ID to i_w size adder yes/no</span>
</td></tr>
<tr><td class="line-number">52</td><td class="line-text">	<span class="hljs-built_in">dw</span>	i_mod_adder	<span class="hljs-comment">; Table 14: Translation of Raw ID to i_mod size adder yes/no</span>
</td></tr>
<tr><td class="line-number">53</td><td class="line-text">	<span class="hljs-built_in">dw</span>	jxx_dec_a	<span class="hljs-comment">; Table 15: Jxx decode table A</span>
</td></tr>
<tr><td class="line-number">54</td><td class="line-text">	<span class="hljs-built_in">dw</span>	jxx_dec_b	<span class="hljs-comment">; Table 16: Jxx decode table B</span>
</td></tr>
<tr><td class="line-number">55</td><td class="line-text">	<span class="hljs-built_in">dw</span>	jxx_dec_c	<span class="hljs-comment">; Table 17: Jxx decode table C</span>
</td></tr>
<tr><td class="line-number">56</td><td class="line-text">	<span class="hljs-built_in">dw</span>	jxx_dec_d	<span class="hljs-comment">; Table 18: Jxx decode table D</span>
</td></tr>
<tr><td class="line-number">57</td><td class="line-text">	<span class="hljs-built_in">dw</span>	flags_mult	<span class="hljs-comment">; Table 19: FLAGS multipliers</span>
</td></tr>
<tr><td class="line-number">58</td><td class="line-text">
</td></tr>
<tr><td class="line-number">59</td><td class="line-text"><span class="hljs-comment">; These values (BIOS ID string, BIOS date and so forth) go at the very top of memory</span>
</td></tr>
<tr><td class="line-number">60</td><td class="line-text">
</td></tr>
<tr><td class="line-number">61</td><td class="line-text">biosstr	<span class="hljs-built_in">db</span>	<span class="hljs-string">'8086tiny BIOS Revision 1.61!'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Why not?</span>
</td></tr>
<tr><td class="line-number">62</td><td class="line-text">mem_top	<span class="hljs-built_in">db</span>	<span class="hljs-number">0xea</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-string">'03/08/14'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">63</td><td class="line-text">
</td></tr>
<tr><td class="line-number">64</td><td class="line-text">bios_entry:
</td></tr>
<tr><td class="line-number">65</td><td class="line-text">
</td></tr>
<tr><td class="line-number">66</td><td class="line-text">	<span class="hljs-comment">; Set up initial stack to F000:F000</span>
</td></tr>
<tr><td class="line-number">67</td><td class="line-text">
</td></tr>
<tr><td class="line-number">68</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">sp</span>, <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">69</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ss</span>, <span class="hljs-built_in">sp</span>
</td></tr>
<tr><td class="line-number">70</td><td class="line-text">
</td></tr>
<tr><td class="line-number">71</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">72</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">73</td><td class="line-text">
</td></tr>
<tr><td class="line-number">74</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">75</td><td class="line-text">
</td></tr>
<tr><td class="line-number">76</td><td class="line-text">	<span class="hljs-comment">; The emulator requires a few control registers in memory to always be zero for correct</span>
</td></tr>
<tr><td class="line-number">77</td><td class="line-text">	<span class="hljs-comment">; instruction decoding (in particular, register look-up operations). These are the</span>
</td></tr>
<tr><td class="line-number">78</td><td class="line-text">	<span class="hljs-comment">; emulator's zero segment (ZS) and always-zero flag (XF). Because the emulated memory</span>
</td></tr>
<tr><td class="line-number">79</td><td class="line-text">	<span class="hljs-comment">; space is uninitialised, we need to be sure these values are zero before doing anything</span>
</td></tr>
<tr><td class="line-number">80</td><td class="line-text">	<span class="hljs-comment">; else. The instructions we need to use to set them must not rely on look-up operations.</span>
</td></tr>
<tr><td class="line-number">81</td><td class="line-text">	<span class="hljs-comment">; So e.g. MOV to memory is out but string operations are fine.</span>
</td></tr>
<tr><td class="line-number">82</td><td class="line-text">
</td></tr>
<tr><td class="line-number">83</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">84</td><td class="line-text">
</td></tr>
<tr><td class="line-number">85</td><td class="line-text">	<span class="hljs-keyword">xor</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">86</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">87</td><td class="line-text">	<span class="hljs-keyword">stosw</span>			<span class="hljs-comment">; Set ZS = 0</span>
</td></tr>
<tr><td class="line-number">88</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">49</span>
</td></tr>
<tr><td class="line-number">89</td><td class="line-text">	<span class="hljs-keyword">stosb</span>			<span class="hljs-comment">; Set XF = 0</span>
</td></tr>
<tr><td class="line-number">90</td><td class="line-text">
</td></tr>
<tr><td class="line-number">91</td><td class="line-text">	<span class="hljs-comment">; Now we can do whatever we want! DL starts off being the boot disk.</span>
</td></tr>
<tr><td class="line-number">92</td><td class="line-text">
</td></tr>
<tr><td class="line-number">93</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:boot_device], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">94</td><td class="line-text">
</td></tr>
<tr><td class="line-number">95</td><td class="line-text">	<span class="hljs-comment">; Set up Hercules graphics support. We start with the adapter in text mode</span>
</td></tr>
<tr><td class="line-number">96</td><td class="line-text">
</td></tr>
<tr><td class="line-number">97</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">98</td><td class="line-text">
</td></tr>
<tr><td class="line-number">99</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b8</span>
</td></tr>
<tr><td class="line-number">100</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">101</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Set Hercules support to text mode</span>
</td></tr>
<tr><td class="line-number">102</td><td class="line-text">
</td></tr>
<tr><td class="line-number">103</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">104</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; Hercules CRTC "horizontal displayed" register select</span>
</td></tr>
<tr><td class="line-number">105</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">106</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">107</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x2d</span>	<span class="hljs-comment">; 0x2D = 45 (* 16) = 720 pixels wide (GRAPHICS_X)</span>
</td></tr>
<tr><td class="line-number">108</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">109</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">110</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">6</span>		<span class="hljs-comment">; Hercules CRTC "vertical displayed" register select</span>
</td></tr>
<tr><td class="line-number">111</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">112</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">113</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x57</span>	<span class="hljs-comment">; 0x57 = 87 (* 4) = 348 pixels high (GRAPHICS_Y)</span>
</td></tr>
<tr><td class="line-number">114</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">115</td><td class="line-text">
</td></tr>
<tr><td class="line-number">116</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">117</td><td class="line-text">
</td></tr>
<tr><td class="line-number">118</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">119</td><td class="line-text">
</td></tr>
<tr><td class="line-number">120</td><td class="line-text">	<span class="hljs-comment">; Check cold boot/warm boot. We initialise disk parameters on cold boot only</span>
</td></tr>
<tr><td class="line-number">121</td><td class="line-text">
</td></tr>
<tr><td class="line-number">122</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:boot_state], <span class="hljs-number">0</span>	<span class="hljs-comment">; Cold boot?</span>
</td></tr>
<tr><td class="line-number">123</td><td class="line-text">	<span class="hljs-keyword">jne</span>	boot
</td></tr>
<tr><td class="line-number">124</td><td class="line-text">
</td></tr>
<tr><td class="line-number">125</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:boot_state], <span class="hljs-number">1</span>	<span class="hljs-comment">; Set flag so next boot will be warm boot</span>
</td></tr>
<tr><td class="line-number">126</td><td class="line-text">
</td></tr>
<tr><td class="line-number">127</td><td class="line-text">	<span class="hljs-comment">; First, set up the disk subsystem. Only do this on the very first startup, when</span>
</td></tr>
<tr><td class="line-number">128</td><td class="line-text">	<span class="hljs-comment">; the emulator sets up the CX/AX registers with disk information.</span>
</td></tr>
<tr><td class="line-number">129</td><td class="line-text">
</td></tr>
<tr><td class="line-number">130</td><td class="line-text">	<span class="hljs-comment">; Compute the cylinder/head/sector count for the HD disk image, if present.</span>
</td></tr>
<tr><td class="line-number">131</td><td class="line-text">	<span class="hljs-comment">; Total number of sectors is in CX:AX, or 0 if there is no HD image. First,</span>
</td></tr>
<tr><td class="line-number">132</td><td class="line-text">	<span class="hljs-comment">; we put it in DX:CX.</span>
</td></tr>
<tr><td class="line-number">133</td><td class="line-text">
</td></tr>
<tr><td class="line-number">134</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">135</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">136</td><td class="line-text">
</td></tr>
<tr><td class="line-number">137</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:hd_secs_hi], <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">138</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:hd_secs_lo], <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">139</td><td class="line-text">
</td></tr>
<tr><td class="line-number">140</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">141</td><td class="line-text">	<span class="hljs-keyword">je</span>	maybe_no_hd
</td></tr>
<tr><td class="line-number">142</td><td class="line-text">
</td></tr>
<tr><td class="line-number">143</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:num_disks], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">144</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	calc_hd
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">145</td><td class="line-text">
</td></tr>
<tr><td class="line-number">146</td><td class="line-text">maybe_no_hd:
</td></tr>
<tr><td class="line-number">147</td><td class="line-text">
</td></tr>
<tr><td class="line-number">148</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">149</td><td class="line-text">	<span class="hljs-keyword">je</span>	no_hd
</td></tr>
<tr><td class="line-number">150</td><td class="line-text">
</td></tr>
<tr><td class="line-number">151</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:num_disks], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">152</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	calc_hd
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">153</td><td class="line-text">
</td></tr>
<tr><td class="line-number">154</td><td class="line-text">no_hd:
</td></tr>
<tr><td class="line-number">155</td><td class="line-text">
</td></tr>
<tr><td class="line-number">156</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:num_disks], <span class="hljs-number">1</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">157</td><td class="line-text">
</td></tr>
<tr><td class="line-number">158</td><td class="line-text">calc_hd:
</td></tr>
<tr><td class="line-number">159</td><td class="line-text">
</td></tr>
<tr><td class="line-number">160</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">161</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_track], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">162</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_head], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">163</td><td class="line-text">
</td></tr>
<tr><td class="line-number">164</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; More than 63 total sectors? If so, we have more than 1 track.</span>
</td></tr>
<tr><td class="line-number">165</td><td class="line-text">	<span class="hljs-keyword">ja</span>	sect_overflow
</td></tr>
<tr><td class="line-number">166</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">63</span>
</td></tr>
<tr><td class="line-number">167</td><td class="line-text">	<span class="hljs-keyword">ja</span>	sect_overflow
</td></tr>
<tr><td class="line-number">168</td><td class="line-text">
</td></tr>
<tr><td class="line-number">169</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:hd_max_sector], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">170</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	calc_heads
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">171</td><td class="line-text">
</td></tr>
<tr><td class="line-number">172</td><td class="line-text">sect_overflow:
</td></tr>
<tr><td class="line-number">173</td><td class="line-text">
</td></tr>
<tr><td class="line-number">174</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">63</span>		<span class="hljs-comment">; Calculate number of tracks</span>
</td></tr>
<tr><td class="line-number">175</td><td class="line-text">	<span class="hljs-keyword">div</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">176</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:hd_max_track], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">177</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_sector], <span class="hljs-number">63</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">178</td><td class="line-text">
</td></tr>
<tr><td class="line-number">179</td><td class="line-text">calc_heads:
</td></tr>
<tr><td class="line-number">180</td><td class="line-text">
</td></tr>
<tr><td class="line-number">181</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; More than 1024 tracks? If so, we have more than 1 head.</span>
</td></tr>
<tr><td class="line-number">182</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:hd_max_track]
</td></tr>
<tr><td class="line-number">183</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">1024</span>
</td></tr>
<tr><td class="line-number">184</td><td class="line-text">	<span class="hljs-keyword">ja</span>	track_overflow
</td></tr>
<tr><td class="line-number">185</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">186</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	calc_end
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">187</td><td class="line-text">
</td></tr>
<tr><td class="line-number">188</td><td class="line-text">track_overflow:
</td></tr>
<tr><td class="line-number">189</td><td class="line-text">
</td></tr>
<tr><td class="line-number">190</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">1024</span>
</td></tr>
<tr><td class="line-number">191</td><td class="line-text">	<span class="hljs-keyword">div</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">192</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:hd_max_head], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">193</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_track], <span class="hljs-number">1024</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">194</td><td class="line-text">
</td></tr>
<tr><td class="line-number">195</td><td class="line-text">calc_end:
</td></tr>
<tr><td class="line-number">196</td><td class="line-text">
</td></tr>
<tr><td class="line-number">197</td><td class="line-text">	<span class="hljs-comment">; Convert number of tracks into maximum track (0-based) and then store in INT 41</span>
</td></tr>
<tr><td class="line-number">198</td><td class="line-text">	<span class="hljs-comment">; HD parameter table</span>
</td></tr>
<tr><td class="line-number">199</td><td class="line-text">
</td></tr>
<tr><td class="line-number">200</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:hd_max_head]
</td></tr>
<tr><td class="line-number">201</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:int41_max_heads], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">202</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:hd_max_track]
</td></tr>
<tr><td class="line-number">203</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:int41_max_cyls], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">204</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:hd_max_sector]
</td></tr>
<tr><td class="line-number">205</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:int41_max_sect], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">206</td><td class="line-text">
</td></tr>
<tr><td class="line-number">207</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_track]
</td></tr>
<tr><td class="line-number">208</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:hd_max_head]
</td></tr>
<tr><td class="line-number">209</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">210</td><td class="line-text"><span class="hljs-comment">; Main BIOS entry point. Zero the flags, and set up registers.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">211</td><td class="line-text">
</td></tr>
<tr><td class="line-number">212</td><td class="line-text">boot:	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">213</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">214</td><td class="line-text">	<span class="hljs-keyword">popf</span>
</td></tr>
<tr><td class="line-number">215</td><td class="line-text">
</td></tr>
<tr><td class="line-number">216</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">217</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">218</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">219</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ss</span>
</td></tr>
<tr><td class="line-number">220</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">sp</span>, <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">221</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">222</td><td class="line-text"><span class="hljs-comment">; Set up the IVT. First we zero out the table</span>
</td></tr>
<tr><td class="line-number">223</td><td class="line-text">
</td></tr>
<tr><td class="line-number">224</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">225</td><td class="line-text">
</td></tr>
<tr><td class="line-number">226</td><td class="line-text">	<span class="hljs-keyword">xor</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">227</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">228</td><td class="line-text">	<span class="hljs-keyword">xor</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">229</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">512</span>
</td></tr>
<tr><td class="line-number">230</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">231</td><td class="line-text">
</td></tr>
<tr><td class="line-number">232</td><td class="line-text"><span class="hljs-comment">; Then we load in the pointers to our interrupt handlers</span>
</td></tr>
<tr><td class="line-number">233</td><td class="line-text">
</td></tr>
<tr><td class="line-number">234</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">235</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, int_table
</td></tr>
<tr><td class="line-number">236</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [itbl_size]
</td></tr>
<tr><td class="line-number">237</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsb</span>
</td></tr>
<tr><td class="line-number">238</td><td class="line-text">
</td></tr>
<tr><td class="line-number">239</td><td class="line-text"><span class="hljs-comment">; Set pointer to INT 41 table for hard disk</span>
</td></tr>
<tr><td class="line-number">240</td><td class="line-text">
</td></tr>
<tr><td class="line-number">241</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, int41
</td></tr>
<tr><td class="line-number">242</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">4</span>*<span class="hljs-number">0x41</span>], <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">243</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">244</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">4</span>*<span class="hljs-number">0x41</span> + <span class="hljs-number">2</span>], <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">245</td><td class="line-text">
</td></tr>
<tr><td class="line-number">246</td><td class="line-text"><span class="hljs-comment">; Set up last 16 bytes of memory, including boot jump, BIOS date, machine ID byte</span>
</td></tr>
<tr><td class="line-number">247</td><td class="line-text">
</td></tr>
<tr><td class="line-number">248</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0xffff</span>
</td></tr>
<tr><td class="line-number">249</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">250</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">251</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, mem_top
</td></tr>
<tr><td class="line-number">252</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">16</span>
</td></tr>
<tr><td class="line-number">253</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsb</span>
</td></tr>
<tr><td class="line-number">254</td><td class="line-text">
</td></tr>
<tr><td class="line-number">255</td><td class="line-text"><span class="hljs-comment">; Set up the BIOS data area</span>
</td></tr>
<tr><td class="line-number">256</td><td class="line-text">
</td></tr>
<tr><td class="line-number">257</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">258</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">259</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">260</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, bios_data
</td></tr>
<tr><td class="line-number">261</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0x100</span>
</td></tr>
<tr><td class="line-number">262</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsb</span>
</td></tr>
<tr><td class="line-number">263</td><td class="line-text">
</td></tr>
<tr><td class="line-number">264</td><td class="line-text"><span class="hljs-comment">; Clear video memory</span>
</td></tr>
<tr><td class="line-number">265</td><td class="line-text">
</td></tr>
<tr><td class="line-number">266</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">267</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">268</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">269</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span>*<span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">270</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0700</span>
</td></tr>
<tr><td class="line-number">271</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">272</td><td class="line-text">
</td></tr>
<tr><td class="line-number">273</td><td class="line-text"><span class="hljs-comment">; Clear video memory shadow buffer</span>
</td></tr>
<tr><td class="line-number">274</td><td class="line-text">
</td></tr>
<tr><td class="line-number">275</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0xc800</span>
</td></tr>
<tr><td class="line-number">276</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">277</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">278</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span>*<span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">279</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0700</span>
</td></tr>
<tr><td class="line-number">280</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">281</td><td class="line-text">
</td></tr>
<tr><td class="line-number">282</td><td class="line-text"><span class="hljs-comment">; Set up some I/O ports, between 0 and FFF. Most of them we set to 0xFF, to indicate no device present</span>
</td></tr>
<tr><td class="line-number">283</td><td class="line-text">
</td></tr>
<tr><td class="line-number">284</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x61</span>
</td></tr>
<tr><td class="line-number">285</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">286</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Make sure the speaker is off</span>
</td></tr>
<tr><td class="line-number">287</td><td class="line-text">
</td></tr>
<tr><td class="line-number">288</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x60</span>
</td></tr>
<tr><td class="line-number">289</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; No scancode</span>
</td></tr>
<tr><td class="line-number">290</td><td class="line-text">
</td></tr>
<tr><td class="line-number">291</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x64</span>
</td></tr>
<tr><td class="line-number">292</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; No key waiting</span>
</td></tr>
<tr><td class="line-number">293</td><td class="line-text">
</td></tr>
<tr><td class="line-number">294</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">295</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0xFF</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">296</td><td class="line-text">
</td></tr>
<tr><td class="line-number">297</td><td class="line-text">next_out:
</td></tr>
<tr><td class="line-number">298</td><td class="line-text">
</td></tr>
<tr><td class="line-number">299</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">300</td><td class="line-text">
</td></tr>
<tr><td class="line-number">301</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x40</span>	<span class="hljs-comment">; We deal with the PIT channel 0 later</span>
</td></tr>
<tr><td class="line-number">302</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">303</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x42</span>	<span class="hljs-comment">; We deal with the PIT channel 2 later</span>
</td></tr>
<tr><td class="line-number">304</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">305</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3B8</span>	<span class="hljs-comment">; We deal with the Hercules port later, too</span>
</td></tr>
<tr><td class="line-number">306</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">307</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x60</span>	<span class="hljs-comment">; Keyboard scancode</span>
</td></tr>
<tr><td class="line-number">308</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">309</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x61</span>	<span class="hljs-comment">; Sound output</span>
</td></tr>
<tr><td class="line-number">310</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">311</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x64</span>	<span class="hljs-comment">; Keyboard status</span>
</td></tr>
<tr><td class="line-number">312</td><td class="line-text">	<span class="hljs-keyword">je</span>	next_out
</td></tr>
<tr><td class="line-number">313</td><td class="line-text">
</td></tr>
<tr><td class="line-number">314</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">315</td><td class="line-text">
</td></tr>
<tr><td class="line-number">316</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0xFFF</span>
</td></tr>
<tr><td class="line-number">317</td><td class="line-text">	<span class="hljs-keyword">jl</span>	next_out
</td></tr>
<tr><td class="line-number">318</td><td class="line-text">
</td></tr>
<tr><td class="line-number">319</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">320</td><td class="line-text">
</td></tr>
<tr><td class="line-number">321</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3DA</span>	<span class="hljs-comment">; CGA refresh port</span>
</td></tr>
<tr><td class="line-number">322</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">323</td><td class="line-text">
</td></tr>
<tr><td class="line-number">324</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3BA</span>	<span class="hljs-comment">; Hercules detection port</span>
</td></tr>
<tr><td class="line-number">325</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">326</td><td class="line-text">
</td></tr>
<tr><td class="line-number">327</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3B8</span>	<span class="hljs-comment">; Hercules video mode port</span>
</td></tr>
<tr><td class="line-number">328</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">329</td><td class="line-text">
</td></tr>
<tr><td class="line-number">330</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3BC</span>	<span class="hljs-comment">; LPT1</span>
</td></tr>
<tr><td class="line-number">331</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">332</td><td class="line-text">
</td></tr>
<tr><td class="line-number">333</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x62</span>	<span class="hljs-comment">; PPI - needed for memory parity checks</span>
</td></tr>
<tr><td class="line-number">334</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">335</td><td class="line-text">
</td></tr>
<tr><td class="line-number">336</td><td class="line-text"><span class="hljs-comment">; Get initial RTC value</span>
</td></tr>
<tr><td class="line-number">337</td><td class="line-text">
</td></tr>
<tr><td class="line-number">338</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">339</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">340</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, timetable
</td></tr>
<tr><td class="line-number">341</td><td class="line-text">	extended_get_rtc
</td></tr>
<tr><td class="line-number">342</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">es</span>:tm_msec]
</td></tr>
<tr><td class="line-number">343</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:last_int8_msec], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">344</td><td class="line-text">
</td></tr>
<tr><td class="line-number">345</td><td class="line-text"><span class="hljs-comment">; Read boot sector from FDD, and load it into 0:7C00</span>
</td></tr>
<tr><td class="line-number">346</td><td class="line-text">
</td></tr>
<tr><td class="line-number">347</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">348</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">349</td><td class="line-text">
</td></tr>
<tr><td class="line-number">350</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0201</span>
</td></tr>
<tr><td class="line-number">351</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">352</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, [<span class="hljs-built_in">cs</span>:boot_device]
</td></tr>
<tr><td class="line-number">353</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">354</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x7c00</span>
</td></tr>
<tr><td class="line-number">355</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">13h</span>
</td></tr>
<tr><td class="line-number">356</td><td class="line-text">
</td></tr>
<tr><td class="line-number">357</td><td class="line-text"><span class="hljs-comment">; Jump to boot sector</span>
</td></tr>
<tr><td class="line-number">358</td><td class="line-text">
</td></tr>
<tr><td class="line-number">359</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	<span class="hljs-number">0</span>:<span class="hljs-number">0x7c00</span>
</td></tr>
<tr><td class="line-number">360</td><td class="line-text">
</td></tr>
<tr><td class="line-number">361</td><td class="line-text"><span class="hljs-comment">; ************************* INT 7h handler - keyboard driver (8086tiny internal)</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">362</td><td class="line-text">
</td></tr>
<tr><td class="line-number">363</td><td class="line-text">int7:	<span class="hljs-comment">; Whenever the user presses a key, INT 7 is called by the emulator.</span>
</td></tr>
<tr><td class="line-number">364</td><td class="line-text">	<span class="hljs-comment">; ASCII character of the keystroke is at 0040:this_keystroke</span>
</td></tr>
<tr><td class="line-number">365</td><td class="line-text">
</td></tr>
<tr><td class="line-number">366</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">367</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">368</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">369</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">370</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">371</td><td class="line-text">
</td></tr>
<tr><td class="line-number">372</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">373</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">374</td><td class="line-text">
</td></tr>
<tr><td class="line-number">375</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>	<span class="hljs-comment">; Set segment to BIOS data area segment (0x40)</span>
</td></tr>
<tr><td class="line-number">376</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">377</td><td class="line-text">
</td></tr>
<tr><td class="line-number">378</td><td class="line-text">	<span class="hljs-comment">; Retrieve the keystroke</span>
</td></tr>
<tr><td class="line-number">379</td><td class="line-text">
</td></tr>
<tr><td class="line-number">380</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">es</span>:this_keystroke-bios_data]
</td></tr>
<tr><td class="line-number">381</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke+<span class="hljs-number">1</span>-bios_data], <span class="hljs-number">0</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">382</td><td class="line-text">
</td></tr>
<tr><td class="line-number">383</td><td class="line-text">  real_key:
</td></tr>
<tr><td class="line-number">384</td><td class="line-text">
</td></tr>
<tr><td class="line-number">385</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:last_key_sdl], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">386</td><td class="line-text">
</td></tr>
<tr><td class="line-number">387</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">4</span> <span class="hljs-comment">; This key doesn't come from SDL</span>
</td></tr>
<tr><td class="line-number">388</td><td class="line-text">	<span class="hljs-keyword">jz</span>	check_linux_bksp
</td></tr>
<tr><td class="line-number">389</td><td class="line-text">
</td></tr>
<tr><td class="line-number">390</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">391</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags2-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">392</td><td class="line-text">
</td></tr>
<tr><td class="line-number">393</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:last_key_sdl], <span class="hljs-number">1</span> <span class="hljs-comment">; Key down from SDL</span>
</td></tr>
<tr><td class="line-number">394</td><td class="line-text">
</td></tr>
<tr><td class="line-number">395</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x40</span> <span class="hljs-comment">; Key up</span>
</td></tr>
<tr><td class="line-number">396</td><td class="line-text">	<span class="hljs-keyword">jz</span>	sdl_check_specials
</td></tr>
<tr><td class="line-number">397</td><td class="line-text">
</td></tr>
<tr><td class="line-number">398</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:last_key_sdl], <span class="hljs-number">2</span> <span class="hljs-comment">; Key up from SDL</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">399</td><td class="line-text">
</td></tr>
<tr><td class="line-number">400</td><td class="line-text">  sdl_check_specials:
</td></tr>
<tr><td class="line-number">401</td><td class="line-text">
</td></tr>
<tr><td class="line-number">402</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">403</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">7</span> <span class="hljs-comment">; If key is between 52F and 534 (Shift/Ctrl/Alt), ignore the key state flags</span>
</td></tr>
<tr><td class="line-number">404</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x52f</span>
</td></tr>
<tr><td class="line-number">405</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_shift
</td></tr>
<tr><td class="line-number">406</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x530</span>
</td></tr>
<tr><td class="line-number">407</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_shift
</td></tr>
<tr><td class="line-number">408</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x533</span>
</td></tr>
<tr><td class="line-number">409</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_alt
</td></tr>
<tr><td class="line-number">410</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x534</span>
</td></tr>
<tr><td class="line-number">411</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_alt
</td></tr>
<tr><td class="line-number">412</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x531</span>
</td></tr>
<tr><td class="line-number">413</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_ctrl
</td></tr>
<tr><td class="line-number">414</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x532</span>
</td></tr>
<tr><td class="line-number">415</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_just_press_ctrl
</td></tr>
<tr><td class="line-number">416</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	sdl_check_alt
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">417</td><td class="line-text">
</td></tr>
<tr><td class="line-number">418</td><td class="line-text">  sdl_just_press_shift:
</td></tr>
<tr><td class="line-number">419</td><td class="line-text">
</td></tr>
<tr><td class="line-number">420</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x36</span> <span class="hljs-comment">; Shift</span>
</td></tr>
<tr><td class="line-number">421</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x40</span> <span class="hljs-comment">; Key up?</span>
</td></tr>
<tr><td class="line-number">422</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">423</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">424</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">425</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">426</td><td class="line-text">
</td></tr>
<tr><td class="line-number">427</td><td class="line-text">  sdl_just_press_alt:
</td></tr>
<tr><td class="line-number">428</td><td class="line-text">
</td></tr>
<tr><td class="line-number">429</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x38</span> <span class="hljs-comment">; Alt</span>
</td></tr>
<tr><td class="line-number">430</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x40</span> <span class="hljs-comment">; Key up?</span>
</td></tr>
<tr><td class="line-number">431</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">432</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">433</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">434</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">435</td><td class="line-text">
</td></tr>
<tr><td class="line-number">436</td><td class="line-text">  sdl_just_press_ctrl:
</td></tr>
<tr><td class="line-number">437</td><td class="line-text">
</td></tr>
<tr><td class="line-number">438</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1d</span> <span class="hljs-comment">; Ctrl</span>
</td></tr>
<tr><td class="line-number">439</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x40</span> <span class="hljs-comment">; Key up?</span>
</td></tr>
<tr><td class="line-number">440</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">441</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">442</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">443</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">444</td><td class="line-text">
</td></tr>
<tr><td class="line-number">445</td><td class="line-text">  sdl_check_alt:
</td></tr>
<tr><td class="line-number">446</td><td class="line-text">
</td></tr>
<tr><td class="line-number">447</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">8</span> <span class="hljs-comment">; Alt+something?</span>
</td></tr>
<tr><td class="line-number">448</td><td class="line-text">	<span class="hljs-keyword">jz</span>	sdl_no_alt
</td></tr>
<tr><td class="line-number">449</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">8</span>
</td></tr>
<tr><td class="line-number">450</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags2-bios_data], <span class="hljs-number">2</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">451</td><td class="line-text">
</td></tr>
<tr><td class="line-number">452</td><td class="line-text">  sdl_no_alt:
</td></tr>
<tr><td class="line-number">453</td><td class="line-text">
</td></tr>
<tr><td class="line-number">454</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x20</span> <span class="hljs-comment">; Ctrl+something?</span>
</td></tr>
<tr><td class="line-number">455</td><td class="line-text">	<span class="hljs-keyword">jz</span>	sdl_no_ctrl
</td></tr>
<tr><td class="line-number">456</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">4</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">457</td><td class="line-text">
</td></tr>
<tr><td class="line-number">458</td><td class="line-text">  sdl_no_ctrl:
</td></tr>
<tr><td class="line-number">459</td><td class="line-text">
</td></tr>
<tr><td class="line-number">460</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x10</span> <span class="hljs-comment">; Shift+something?</span>
</td></tr>
<tr><td class="line-number">461</td><td class="line-text">	<span class="hljs-keyword">jz</span>	sdl_no_mods
</td></tr>
<tr><td class="line-number">462</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">1</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">463</td><td class="line-text">
</td></tr>
<tr><td class="line-number">464</td><td class="line-text">  sdl_no_mods:
</td></tr>
<tr><td class="line-number">465</td><td class="line-text">
</td></tr>
<tr><td class="line-number">466</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; We have processed all SDL modifiers, so remove them</span>
</td></tr>
<tr><td class="line-number">467</td><td class="line-text">
</td></tr>
<tr><td class="line-number">468</td><td class="line-text">	<span class="hljs-comment">;cmp	ax, 160 ; Alt+Space?</span>
</td></tr>
<tr><td class="line-number">469</td><td class="line-text">	<span class="hljs-comment">;jne	next_sdl_alt_keys</span>
</td></tr>
<tr><td class="line-number">470</td><td class="line-text">	<span class="hljs-comment">;mov	al, ' '</span>
</td></tr>
<tr><td class="line-number">471</td><td class="line-text">	<span class="hljs-comment">;mov	byte [es:this_keystroke-bios_data], al</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">472</td><td class="line-text">
</td></tr>
<tr><td class="line-number">473</td><td class="line-text">  check_sdl_f_keys:
</td></tr>
<tr><td class="line-number">474</td><td class="line-text">
</td></tr>
<tr><td class="line-number">475</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x125</span>
</td></tr>
<tr><td class="line-number">476</td><td class="line-text">	<span class="hljs-keyword">ja</span>	i2_dne <span class="hljs-comment">; Unknown key</span>
</td></tr>
<tr><td class="line-number">477</td><td class="line-text">
</td></tr>
<tr><td class="line-number">478</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x11a</span>
</td></tr>
<tr><td class="line-number">479</td><td class="line-text">	<span class="hljs-keyword">jb</span>	check_sdl_pgup_pgdn_keys
</td></tr>
<tr><td class="line-number">480</td><td class="line-text">
</td></tr>
<tr><td class="line-number">481</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0xdf</span> <span class="hljs-comment">; F1 - F10</span>
</td></tr>
<tr><td class="line-number">482</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x45</span>
</td></tr>
<tr><td class="line-number">483</td><td class="line-text">	<span class="hljs-keyword">jb</span>	check_sdl_f_keys2
</td></tr>
<tr><td class="line-number">484</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x12</span> <span class="hljs-comment">; F11 - F12</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">485</td><td class="line-text">
</td></tr>
<tr><td class="line-number">486</td><td class="line-text">  check_sdl_f_keys2:
</td></tr>
<tr><td class="line-number">487</td><td class="line-text">
</td></tr>
<tr><td class="line-number">488</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">489</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">490</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	sdl_scancode_xlat_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">491</td><td class="line-text">
</td></tr>
<tr><td class="line-number">492</td><td class="line-text">  check_sdl_pgup_pgdn_keys:
</td></tr>
<tr><td class="line-number">493</td><td class="line-text">
</td></tr>
<tr><td class="line-number">494</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x116</span>
</td></tr>
<tr><td class="line-number">495</td><td class="line-text">	<span class="hljs-keyword">jb</span>	check_sdl_cursor_keys
</td></tr>
<tr><td class="line-number">496</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x119</span>
</td></tr>
<tr><td class="line-number">497</td><td class="line-text">	<span class="hljs-keyword">ja</span>	check_sdl_cursor_keys
</td></tr>
<tr><td class="line-number">498</td><td class="line-text">
</td></tr>
<tr><td class="line-number">499</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x116</span>
</td></tr>
<tr><td class="line-number">500</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, pgup_pgdn_xlt
</td></tr>
<tr><td class="line-number">501</td><td class="line-text">	<span class="hljs-built_in">cs</span>	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">502</td><td class="line-text">
</td></tr>
<tr><td class="line-number">503</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">504</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">505</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	sdl_scancode_xlat_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">506</td><td class="line-text">
</td></tr>
<tr><td class="line-number">507</td><td class="line-text">  check_sdl_cursor_keys:
</td></tr>
<tr><td class="line-number">508</td><td class="line-text">
</td></tr>
<tr><td class="line-number">509</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x111</span> <span class="hljs-comment">; SDL cursor keys</span>
</td></tr>
<tr><td class="line-number">510</td><td class="line-text">	<span class="hljs-keyword">jb</span>	sdl_process_key <span class="hljs-comment">; No special handling for other keys yet</span>
</td></tr>
<tr><td class="line-number">511</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">512</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x111</span>
</td></tr>
<tr><td class="line-number">513</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, unix_cursor_xlt
</td></tr>
<tr><td class="line-number">514</td><td class="line-text">	<span class="hljs-keyword">xlat</span>	<span class="hljs-comment">; Convert SDL cursor keys to scancode</span>
</td></tr>
<tr><td class="line-number">515</td><td class="line-text">
</td></tr>
<tr><td class="line-number">516</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">517</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">518</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">519</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	sdl_scancode_xlat_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">520</td><td class="line-text">
</td></tr>
<tr><td class="line-number">521</td><td class="line-text">  sdl_process_key:
</td></tr>
<tr><td class="line-number">522</td><td class="line-text">
</td></tr>
<tr><td class="line-number">523</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x100</span>
</td></tr>
<tr><td class="line-number">524</td><td class="line-text">	<span class="hljs-keyword">jae</span>	i2_dne <span class="hljs-comment">; Unsupported key</span>
</td></tr>
<tr><td class="line-number">525</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x7f</span> <span class="hljs-comment">; SDL 0x7F backspace? Convert to 0x08</span>
</td></tr>
<tr><td class="line-number">526</td><td class="line-text">	<span class="hljs-keyword">jne</span>	sdl_process_key2
</td></tr>
<tr><td class="line-number">527</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">8</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">528</td><td class="line-text">
</td></tr>
<tr><td class="line-number">529</td><td class="line-text">  sdl_process_key2:
</td></tr>
<tr><td class="line-number">530</td><td class="line-text">
</td></tr>
<tr><td class="line-number">531</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">532</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, a2scan_tbl <span class="hljs-comment">; ASCII to scancode table</span>
</td></tr>
<tr><td class="line-number">533</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">534</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">535</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span> <span class="hljs-comment">; Scancode in BH, keycode in AL</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">536</td><td class="line-text">
</td></tr>
<tr><td class="line-number">537</td><td class="line-text">  sdl_scancode_xlat_done:
</td></tr>
<tr><td class="line-number">538</td><td class="line-text">
</td></tr>
<tr><td class="line-number">539</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; Key up scancode</span>
</td></tr>
<tr><td class="line-number">540</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:last_key_sdl], <span class="hljs-number">2</span> <span class="hljs-comment">; Key up?</span>
</td></tr>
<tr><td class="line-number">541</td><td class="line-text">	<span class="hljs-keyword">je</span>	sdl_not_in_buf
</td></tr>
<tr><td class="line-number">542</td><td class="line-text">
</td></tr>
<tr><td class="line-number">543</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; Key down scancode</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">544</td><td class="line-text">
</td></tr>
<tr><td class="line-number">545</td><td class="line-text">  sdl_key_down:
</td></tr>
<tr><td class="line-number">546</td><td class="line-text">
</td></tr>
<tr><td class="line-number">547</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-built_in">al</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">548</td><td class="line-text">		
</td></tr>
<tr><td class="line-number">549</td><td class="line-text">  sdl_not_in_buf:
</td></tr>
<tr><td class="line-number">550</td><td class="line-text">
</td></tr>
<tr><td class="line-number">551</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">bh</span>
</td></tr>
<tr><td class="line-number">552</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">553</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne	
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">554</td><td class="line-text">
</td></tr>
<tr><td class="line-number">555</td><td class="line-text">  check_linux_bksp:
</td></tr>
<tr><td class="line-number">556</td><td class="line-text">
</td></tr>
<tr><td class="line-number">557</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Null keystroke - ignore</span>
</td></tr>
<tr><td class="line-number">558</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_dne
</td></tr>
<tr><td class="line-number">559</td><td class="line-text">
</td></tr>
<tr><td class="line-number">560</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x7f</span> <span class="hljs-comment">; Linux code for backspace - change to 8</span>
</td></tr>
<tr><td class="line-number">561</td><td class="line-text">	<span class="hljs-keyword">jne</span>	after_check_bksp
</td></tr>
<tr><td class="line-number">562</td><td class="line-text">
</td></tr>
<tr><td class="line-number">563</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">8</span>
</td></tr>
<tr><td class="line-number">564</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">8</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">565</td><td class="line-text">
</td></tr>
<tr><td class="line-number">566</td><td class="line-text">  after_check_bksp:
</td></tr>
<tr><td class="line-number">567</td><td class="line-text">
</td></tr>
<tr><td class="line-number">568</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_fn-bios_data], <span class="hljs-number">1</span> <span class="hljs-comment">; If previous keypress was Ctrl+F (signifying this key is is Fxx), skip checks for Ctrl+A (Alt+xx) and Ctrl+F (Fxx)</span>
</td></tr>
<tr><td class="line-number">569</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_n
</td></tr>
<tr><td class="line-number">570</td><td class="line-text">
</td></tr>
<tr><td class="line-number">571</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x01</span> <span class="hljs-comment">; Ctrl+A pressed - this is the sequence for "next key is Alt+"</span>
</td></tr>
<tr><td class="line-number">572</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_not_alt
</td></tr>
<tr><td class="line-number">573</td><td class="line-text">
</td></tr>
<tr><td class="line-number">574</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">8</span> <span class="hljs-comment">; Alt flag down</span>
</td></tr>
<tr><td class="line-number">575</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags2-bios_data], <span class="hljs-number">2</span> <span class="hljs-comment">; Alt flag down</span>
</td></tr>
<tr><td class="line-number">576</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x38</span> <span class="hljs-comment">; Simulated Alt by Ctrl+A prefix?</span>
</td></tr>
<tr><td class="line-number">577</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">578</td><td class="line-text">
</td></tr>
<tr><td class="line-number">579</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_alt-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">580</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">581</td><td class="line-text">
</td></tr>
<tr><td class="line-number">582</td><td class="line-text">  i2_not_alt:
</td></tr>
<tr><td class="line-number">583</td><td class="line-text">
</td></tr>
<tr><td class="line-number">584</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x06</span> <span class="hljs-comment">; Ctrl+F pressed - this is the sequence for "next key is Fxx"</span>
</td></tr>
<tr><td class="line-number">585</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_not_fn
</td></tr>
<tr><td class="line-number">586</td><td class="line-text">
</td></tr>
<tr><td class="line-number">587</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_fn-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">588</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">589</td><td class="line-text">
</td></tr>
<tr><td class="line-number">590</td><td class="line-text">  i2_not_fn:
</td></tr>
<tr><td class="line-number">591</td><td class="line-text">
</td></tr>
<tr><td class="line-number">592</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:notranslate_flg-bios_data], <span class="hljs-number">1</span> <span class="hljs-comment">; If no translation mode is on, just pass through the scan code. ASCII key is zero.</span>
</td></tr>
<tr><td class="line-number">593</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:notranslate_flg-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">594</td><td class="line-text">	<span class="hljs-keyword">jne</span>	need_to_translate
</td></tr>
<tr><td class="line-number">595</td><td class="line-text">
</td></tr>
<tr><td class="line-number">596</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">597</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	after_translate
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">598</td><td class="line-text">
</td></tr>
<tr><td class="line-number">599</td><td class="line-text">  need_to_translate:
</td></tr>
<tr><td class="line-number">600</td><td class="line-text">
</td></tr>
<tr><td class="line-number">601</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0xe0</span> <span class="hljs-comment">; Some OSes return scan codes after 0xE0 for things like cursor moves. So, if we find it, set a flag saying the next code received should not be translated.</span>
</td></tr>
<tr><td class="line-number">602</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:notranslate_flg-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">603</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_dne	<span class="hljs-comment">; Don't add the 0xE0 to the keyboard buffer</span>
</td></tr>
<tr><td class="line-number">604</td><td class="line-text">
</td></tr>
<tr><td class="line-number">605</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:notranslate_flg-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">606</td><td class="line-text">
</td></tr>
<tr><td class="line-number">607</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1b</span> <span class="hljs-comment">; ESC key pressed. Either this a "real" escape, or it is UNIX cursor keys. In either case, we do nothing now, except set a flag</span>
</td></tr>
<tr><td class="line-number">608</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_escnext
</td></tr>
<tr><td class="line-number">609</td><td class="line-text">
</td></tr>
<tr><td class="line-number">610</td><td class="line-text">	<span class="hljs-comment">; If the last key pressed was ESC, then we need to stuff it</span>
</td></tr>
<tr><td class="line-number">611</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">612</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_sf
</td></tr>
<tr><td class="line-number">613</td><td class="line-text">
</td></tr>
<tr><td class="line-number">614</td><td class="line-text">	<span class="hljs-comment">; Stuff an ESC character</span>
</td></tr>
<tr><td class="line-number">615</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">616</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x1b</span>
</td></tr>
<tr><td class="line-number">617</td><td class="line-text">
</td></tr>
<tr><td class="line-number">618</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">619</td><td class="line-text">	<span class="hljs-keyword">call</span>	keypress_release
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">620</td><td class="line-text">
</td></tr>
<tr><td class="line-number">621</td><td class="line-text">  i2_sf:
</td></tr>
<tr><td class="line-number">622</td><td class="line-text">
</td></tr>
<tr><td class="line-number">623</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">624</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">625</td><td class="line-text">
</td></tr>
<tr><td class="line-number">626</td><td class="line-text">  i2_escnext:
</td></tr>
<tr><td class="line-number">627</td><td class="line-text">
</td></tr>
<tr><td class="line-number">628</td><td class="line-text">	<span class="hljs-comment">; Check if the last key was an escape character</span>
</td></tr>
<tr><td class="line-number">629</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">630</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_noesc
</td></tr>
<tr><td class="line-number">631</td><td class="line-text">
</td></tr>
<tr><td class="line-number">632</td><td class="line-text">	<span class="hljs-comment">; It is, so check if this key is a [ control character</span>
</td></tr>
<tr><td class="line-number">633</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span> <span class="hljs-comment">; [ key pressed</span>
</td></tr>
<tr><td class="line-number">634</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_esc
</td></tr>
<tr><td class="line-number">635</td><td class="line-text">
</td></tr>
<tr><td class="line-number">636</td><td class="line-text">	<span class="hljs-comment">; It isn't, so stuff an ESC character plus this key</span>
</td></tr>
<tr><td class="line-number">637</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">638</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x1b</span>
</td></tr>
<tr><td class="line-number">639</td><td class="line-text">
</td></tr>
<tr><td class="line-number">640</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">641</td><td class="line-text">	<span class="hljs-keyword">call</span>	keypress_release
</td></tr>
<tr><td class="line-number">642</td><td class="line-text">
</td></tr>
<tr><td class="line-number">643</td><td class="line-text">	<span class="hljs-comment">; Now actually process this key</span>
</td></tr>
<tr><td class="line-number">644</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">645</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:this_keystroke-bios_data]
</td></tr>
<tr><td class="line-number">646</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_noesc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">647</td><td class="line-text">
</td></tr>
<tr><td class="line-number">648</td><td class="line-text">  i2_esc:
</td></tr>
<tr><td class="line-number">649</td><td class="line-text">
</td></tr>
<tr><td class="line-number">650</td><td class="line-text">	<span class="hljs-comment">; Last + this characters are ESC ] - do nothing now, but set escape flag</span>
</td></tr>
<tr><td class="line-number">651</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">652</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">653</td><td class="line-text">
</td></tr>
<tr><td class="line-number">654</td><td class="line-text">  i2_noesc:
</td></tr>
<tr><td class="line-number">655</td><td class="line-text">
</td></tr>
<tr><td class="line-number">656</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">657</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i2_regular_key
</td></tr>
<tr><td class="line-number">658</td><td class="line-text">
</td></tr>
<tr><td class="line-number">659</td><td class="line-text">	<span class="hljs-comment">; No shifts or Alt for cursor keys</span>
</td></tr>
<tr><td class="line-number">660</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">661</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags2-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">662</td><td class="line-text">
</td></tr>
<tr><td class="line-number">663</td><td class="line-text">	<span class="hljs-comment">; Last + this characters are ESC ] xxx - cursor key, so translate and stuff it</span>
</td></tr>
<tr><td class="line-number">664</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'A'</span>
</td></tr>
<tr><td class="line-number">665</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, unix_cursor_xlt
</td></tr>
<tr><td class="line-number">666</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">667</td><td class="line-text">
</td></tr>
<tr><td class="line-number">668</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">669</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	after_translate
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">670</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">671</td><td class="line-text">  i2_regular_key:
</td></tr>
<tr><td class="line-number">672</td><td class="line-text">
</td></tr>
<tr><td class="line-number">673</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:notranslate_flg-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">674</td><td class="line-text">
</td></tr>
<tr><td class="line-number">675</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, a2shift_tbl <span class="hljs-comment">; ASCII to shift code table</span>
</td></tr>
<tr><td class="line-number">676</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">677</td><td class="line-text">
</td></tr>
<tr><td class="line-number">678</td><td class="line-text">	<span class="hljs-comment">; Now, BL is 1 if shift is down, 0 otherwise. If shift is down, put a shift down scan code</span>
</td></tr>
<tr><td class="line-number">679</td><td class="line-text">	<span class="hljs-comment">; in port 0x60. Then call int 9. Otherwise, put a shift up scan code in, and call int 9.</span>
</td></tr>
<tr><td class="line-number">680</td><td class="line-text">
</td></tr>
<tr><td class="line-number">681</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">682</td><td class="line-text">
</td></tr>
<tr><td class="line-number">683</td><td class="line-text">	<span class="hljs-comment">; Put shift flags in BIOS, 0040:0017. Add 8 to shift flags if Alt is down.</span>
</td></tr>
<tr><td class="line-number">684</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, [<span class="hljs-built_in">es</span>:next_key_alt-bios_data]
</td></tr>
<tr><td class="line-number">685</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">686</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">687</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">688</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">689</td><td class="line-text">
</td></tr>
<tr><td class="line-number">690</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x1A</span> <span class="hljs-comment">; Ctrl+A to Ctrl+Z? Then add Ctrl to BIOS key flags</span>
</td></tr>
<tr><td class="line-number">691</td><td class="line-text">	<span class="hljs-keyword">ja</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">692</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">693</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">694</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0xD</span> <span class="hljs-comment">; CR</span>
</td></tr>
<tr><td class="line-number">695</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">696</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0xA</span> <span class="hljs-comment">; LF</span>
</td></tr>
<tr><td class="line-number">697</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">698</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x8</span> <span class="hljs-comment">; Backspace</span>
</td></tr>
<tr><td class="line-number">699</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">700</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x9</span> <span class="hljs-comment">; Tab</span>
</td></tr>
<tr><td class="line-number">701</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_no_ctrl
</td></tr>
<tr><td class="line-number">702</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">4</span> <span class="hljs-comment">; Ctrl in key flags</span>
</td></tr>
<tr><td class="line-number">703</td><td class="line-text">
</td></tr>
<tr><td class="line-number">704</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">705</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1d</span> <span class="hljs-comment">; Ctrl key down</span>
</td></tr>
<tr><td class="line-number">706</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">707</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">708</td><td class="line-text">
</td></tr>
<tr><td class="line-number">709</td><td class="line-text">  i2_no_ctrl:
</td></tr>
<tr><td class="line-number">710</td><td class="line-text">
</td></tr>
<tr><td class="line-number">711</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">712</td><td class="line-text">
</td></tr>
<tr><td class="line-number">713</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">714</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">715</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">716</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:keyflags2-bios_data], <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">717</td><td class="line-text">
</td></tr>
<tr><td class="line-number">718</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">719</td><td class="line-text">
</td></tr>
<tr><td class="line-number">720</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; Shift down?</span>
</td></tr>
<tr><td class="line-number">721</td><td class="line-text">	<span class="hljs-keyword">jz</span>	i2_n
</td></tr>
<tr><td class="line-number">722</td><td class="line-text">
</td></tr>
<tr><td class="line-number">723</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x36</span> <span class="hljs-comment">; Right shift down</span>
</td></tr>
<tr><td class="line-number">724</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">725</td><td class="line-text">
</td></tr>
<tr><td class="line-number">726</td><td class="line-text">  i2_n:
</td></tr>
<tr><td class="line-number">727</td><td class="line-text">
</td></tr>
<tr><td class="line-number">728</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:this_keystroke-bios_data]
</td></tr>
<tr><td class="line-number">729</td><td class="line-text">
</td></tr>
<tr><td class="line-number">730</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, a2scan_tbl <span class="hljs-comment">; ASCII to scan code table</span>
</td></tr>
<tr><td class="line-number">731</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">732</td><td class="line-text">
</td></tr>
<tr><td class="line-number">733</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_fn-bios_data], <span class="hljs-number">1</span>	<span class="hljs-comment">; Fxx?</span>
</td></tr>
<tr><td class="line-number">734</td><td class="line-text">	<span class="hljs-keyword">jne</span>	after_translate
</td></tr>
<tr><td class="line-number">735</td><td class="line-text">
</td></tr>
<tr><td class="line-number">736</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">1</span> <span class="hljs-comment">; Ctrl+F then Ctrl+A outputs code for Ctrl+A</span>
</td></tr>
<tr><td class="line-number">737</td><td class="line-text">	<span class="hljs-keyword">je</span>	after_translate
</td></tr>
<tr><td class="line-number">738</td><td class="line-text">
</td></tr>
<tr><td class="line-number">739</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">6</span> <span class="hljs-comment">; Ctrl+F then Ctrl+F outputs code for Ctrl+F  </span>
</td></tr>
<tr><td class="line-number">740</td><td class="line-text">	<span class="hljs-keyword">je</span>	after_translate
</td></tr>
<tr><td class="line-number">741</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">742</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>	<span class="hljs-comment">; Fxx key, so zero out ASCII code</span>
</td></tr>
<tr><td class="line-number">743</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x39</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">744</td><td class="line-text">
</td></tr>
<tr><td class="line-number">745</td><td class="line-text">  after_translate:
</td></tr>
<tr><td class="line-number">746</td><td class="line-text">
</td></tr>
<tr><td class="line-number">747</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">748</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag_last-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">749</td><td class="line-text">
</td></tr>
<tr><td class="line-number">750</td><td class="line-text">	<span class="hljs-comment">; If the key is actually an Alt+ key we use an ASCII code of 0 instead of the real value.</span>
</td></tr>
<tr><td class="line-number">751</td><td class="line-text">
</td></tr>
<tr><td class="line-number">752</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_alt-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">753</td><td class="line-text">	<span class="hljs-keyword">jne</span>	skip_ascii_zero
</td></tr>
<tr><td class="line-number">754</td><td class="line-text">
</td></tr>
<tr><td class="line-number">755</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">756</td><td class="line-text">
</td></tr>
<tr><td class="line-number">757</td><td class="line-text">  skip_ascii_zero:
</td></tr>
<tr><td class="line-number">758</td><td class="line-text">
</td></tr>
<tr><td class="line-number">759</td><td class="line-text">	<span class="hljs-comment">; Output key down/key up event (scancode in AL) to keyboard port</span>
</td></tr>
<tr><td class="line-number">760</td><td class="line-text">	<span class="hljs-keyword">call</span>	keypress_release
</td></tr>
<tr><td class="line-number">761</td><td class="line-text">
</td></tr>
<tr><td class="line-number">762</td><td class="line-text">	<span class="hljs-comment">; If scan code is not 0xE0, then also send right shift up if necessary</span>
</td></tr>
<tr><td class="line-number">763</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0xe0</span>
</td></tr>
<tr><td class="line-number">764</td><td class="line-text">	<span class="hljs-keyword">je</span>	i2_dne
</td></tr>
<tr><td class="line-number">765</td><td class="line-text">
</td></tr>
<tr><td class="line-number">766</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">767</td><td class="line-text">	<span class="hljs-keyword">jz</span>	check_ctrl
</td></tr>
<tr><td class="line-number">768</td><td class="line-text">
</td></tr>
<tr><td class="line-number">769</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0xb6</span> <span class="hljs-comment">; Right shift up</span>
</td></tr>
<tr><td class="line-number">770</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">771</td><td class="line-text">
</td></tr>
<tr><td class="line-number">772</td><td class="line-text">  check_ctrl:
</td></tr>
<tr><td class="line-number">773</td><td class="line-text">
</td></tr>
<tr><td class="line-number">774</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:keyflags1-bios_data], <span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">775</td><td class="line-text">	<span class="hljs-keyword">jz</span>	check_alt
</td></tr>
<tr><td class="line-number">776</td><td class="line-text">
</td></tr>
<tr><td class="line-number">777</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x9d</span> <span class="hljs-comment">; Right Ctrl up</span>
</td></tr>
<tr><td class="line-number">778</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">779</td><td class="line-text">
</td></tr>
<tr><td class="line-number">780</td><td class="line-text">  check_alt:
</td></tr>
<tr><td class="line-number">781</td><td class="line-text">
</td></tr>
<tr><td class="line-number">782</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_alt-bios_data]
</td></tr>
<tr><td class="line-number">783</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_alt-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">784</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:next_key_fn-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">785</td><td class="line-text">
</td></tr>
<tr><td class="line-number">786</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">787</td><td class="line-text">	<span class="hljs-keyword">je</span>	endalt
</td></tr>
<tr><td class="line-number">788</td><td class="line-text">
</td></tr>
<tr><td class="line-number">789</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i2_dne
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">790</td><td class="line-text">
</td></tr>
<tr><td class="line-number">791</td><td class="line-text">  endalt:
</td></tr>
<tr><td class="line-number">792</td><td class="line-text">
</td></tr>
<tr><td class="line-number">793</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0xb8</span> <span class="hljs-comment">; Left Alt up</span>
</td></tr>
<tr><td class="line-number">794</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">795</td><td class="line-text">
</td></tr>
<tr><td class="line-number">796</td><td class="line-text">  i2_dne:
</td></tr>
<tr><td class="line-number">797</td><td class="line-text">
</td></tr>
<tr><td class="line-number">798</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">799</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">800</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">801</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">802</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">803</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">804</td><td class="line-text">
</td></tr>
<tr><td class="line-number">805</td><td class="line-text"><span class="hljs-comment">; ************************* INT 9h handler - keyboard (PC BIOS standard)</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">806</td><td class="line-text">
</td></tr>
<tr><td class="line-number">807</td><td class="line-text">int9:
</td></tr>
<tr><td class="line-number">808</td><td class="line-text">
</td></tr>
<tr><td class="line-number">809</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">810</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">811</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">812</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">813</td><td class="line-text">
</td></tr>
<tr><td class="line-number">814</td><td class="line-text">	<span class="hljs-keyword">in</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x60</span>
</td></tr>
<tr><td class="line-number">815</td><td class="line-text">
</td></tr>
<tr><td class="line-number">816</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; Key up?</span>
</td></tr>
<tr><td class="line-number">817</td><td class="line-text">	<span class="hljs-keyword">jae</span>	no_add_buf
</td></tr>
<tr><td class="line-number">818</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x36</span> <span class="hljs-comment">; Shift?</span>
</td></tr>
<tr><td class="line-number">819</td><td class="line-text">	<span class="hljs-keyword">je</span>	no_add_buf
</td></tr>
<tr><td class="line-number">820</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x38</span> <span class="hljs-comment">; Alt?</span>
</td></tr>
<tr><td class="line-number">821</td><td class="line-text">	<span class="hljs-keyword">je</span>	no_add_buf
</td></tr>
<tr><td class="line-number">822</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1d</span> <span class="hljs-comment">; Ctrl?</span>
</td></tr>
<tr><td class="line-number">823</td><td class="line-text">	<span class="hljs-keyword">je</span>	no_add_buf
</td></tr>
<tr><td class="line-number">824</td><td class="line-text">
</td></tr>
<tr><td class="line-number">825</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">826</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">827</td><td class="line-text">
</td></tr>
<tr><td class="line-number">828</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">829</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:this_keystroke-bios_data]
</td></tr>
<tr><td class="line-number">830</td><td class="line-text">
</td></tr>
<tr><td class="line-number">831</td><td class="line-text">	<span class="hljs-comment">; Tail of the BIOS keyboard buffer goes in BP. This is where we add new keystrokes</span>
</td></tr>
<tr><td class="line-number">832</td><td class="line-text">
</td></tr>
<tr><td class="line-number">833</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, [<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data]
</td></tr>
<tr><td class="line-number">834</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">bp</span>], <span class="hljs-built_in">al</span> <span class="hljs-comment">; ASCII code</span>
</td></tr>
<tr><td class="line-number">835</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">bp</span>+<span class="hljs-number">1</span>], <span class="hljs-number">bh</span> <span class="hljs-comment">; Scan code</span>
</td></tr>
<tr><td class="line-number">836</td><td class="line-text">
</td></tr>
<tr><td class="line-number">837</td><td class="line-text">	<span class="hljs-comment">; ESC keystroke is in the buffer now</span>
</td></tr>
<tr><td class="line-number">838</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">839</td><td class="line-text">	<span class="hljs-keyword">call</span>	kb_adjust_buf <span class="hljs-comment">; Wrap the tail around the head if the buffer gets too large</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">840</td><td class="line-text">
</td></tr>
<tr><td class="line-number">841</td><td class="line-text">  no_add_buf:
</td></tr>
<tr><td class="line-number">842</td><td class="line-text">
</td></tr>
<tr><td class="line-number">843</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">844</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-number">0x64</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">845</td><td class="line-text">
</td></tr>
<tr><td class="line-number">846</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">847</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">848</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">849</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">850</td><td class="line-text">
</td></tr>
<tr><td class="line-number">851</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">852</td><td class="line-text">
</td></tr>
<tr><td class="line-number">853</td><td class="line-text"><span class="hljs-comment">; ************************* INT Ah handler - timer (8086tiny internal)</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">854</td><td class="line-text">
</td></tr>
<tr><td class="line-number">855</td><td class="line-text">inta:
</td></tr>
<tr><td class="line-number">856</td><td class="line-text">	<span class="hljs-comment">; 8086tiny called interrupt 0xA frequently, at a rate dependent on the speed of your computer.</span>
</td></tr>
<tr><td class="line-number">857</td><td class="line-text">	<span class="hljs-comment">; This interrupt handler scales down the call rate and calls INT 8 at 18.2 times per second,</span>
</td></tr>
<tr><td class="line-number">858</td><td class="line-text">	<span class="hljs-comment">; as per a real PC.</span>
</td></tr>
<tr><td class="line-number">859</td><td class="line-text">
</td></tr>
<tr><td class="line-number">860</td><td class="line-text">	<span class="hljs-comment">; See if there is an ESC waiting from a previous INT 7h. If so, put it in the keyboard buffer</span>
</td></tr>
<tr><td class="line-number">861</td><td class="line-text">	<span class="hljs-comment">; (because by now - 1/18.2 secs on - we know it can't be part of an escape key sequence).</span>
</td></tr>
<tr><td class="line-number">862</td><td class="line-text">	<span class="hljs-comment">; Also handle CGA refresh register. Also release any keys that are still marked as down.</span>
</td></tr>
<tr><td class="line-number">863</td><td class="line-text">
</td></tr>
<tr><td class="line-number">864</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">865</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">866</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">867</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">868</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">869</td><td class="line-text">
</td></tr>
<tr><td class="line-number">870</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">871</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">872</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">873</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">874</td><td class="line-text">
</td></tr>
<tr><td class="line-number">875</td><td class="line-text">	<span class="hljs-keyword">call</span>	vmem_driver_entry	<span class="hljs-comment">; CGA text mode driver - documented later</span>
</td></tr>
<tr><td class="line-number">876</td><td class="line-text">
</td></tr>
<tr><td class="line-number">877</td><td class="line-text">	<span class="hljs-comment">; Increment 32-bit BIOS timer tick counter, once every 18.2 ms</span>
</td></tr>
<tr><td class="line-number">878</td><td class="line-text">
</td></tr>
<tr><td class="line-number">879</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">880</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">881</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, timetable
</td></tr>
<tr><td class="line-number">882</td><td class="line-text">	extended_get_rtc
</td></tr>
<tr><td class="line-number">883</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">884</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:tm_msec]
</td></tr>
<tr><td class="line-number">885</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:last_int8_msec]
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">886</td><td class="line-text">
</td></tr>
<tr><td class="line-number">887</td><td class="line-text">  make_ctr_positive:
</td></tr>
<tr><td class="line-number">888</td><td class="line-text">
</td></tr>
<tr><td class="line-number">889</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">890</td><td class="line-text">	<span class="hljs-keyword">jge</span>	no_add_1000
</td></tr>
<tr><td class="line-number">891</td><td class="line-text">
</td></tr>
<tr><td class="line-number">892</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">1000</span>
</td></tr>
<tr><td class="line-number">893</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	make_ctr_positive
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">894</td><td class="line-text">
</td></tr>
<tr><td class="line-number">895</td><td class="line-text">  no_add_1000:
</td></tr>
<tr><td class="line-number">896</td><td class="line-text">
</td></tr>
<tr><td class="line-number">897</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">898</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">899</td><td class="line-text">
</td></tr>
<tr><td class="line-number">900</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">901</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">1193</span>
</td></tr>
<tr><td class="line-number">902</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">903</td><td class="line-text">
</td></tr>
<tr><td class="line-number">904</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, [<span class="hljs-built_in">es</span>:timer0_freq-bios_data]
</td></tr>
<tr><td class="line-number">905</td><td class="line-text">
</td></tr>
<tr><td class="line-number">906</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; 0 actually means FFFF</span>
</td></tr>
<tr><td class="line-number">907</td><td class="line-text">	<span class="hljs-keyword">jne</span>	no_adjust_10000
</td></tr>
<tr><td class="line-number">908</td><td class="line-text">
</td></tr>
<tr><td class="line-number">909</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xffff</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">910</td><td class="line-text">
</td></tr>
<tr><td class="line-number">911</td><td class="line-text">  no_adjust_10000:
</td></tr>
<tr><td class="line-number">912</td><td class="line-text">
</td></tr>
<tr><td class="line-number">913</td><td class="line-text">	<span class="hljs-keyword">div</span>	<span class="hljs-built_in">bx</span> <span class="hljs-comment">; AX now contains number of timer ticks since last int 8 (DX is remainder)</span>
</td></tr>
<tr><td class="line-number">914</td><td class="line-text">
</td></tr>
<tr><td class="line-number">915</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">916</td><td class="line-text">	<span class="hljs-keyword">je</span>	i8_end
</td></tr>
<tr><td class="line-number">917</td><td class="line-text">
</td></tr>
<tr><td class="line-number">918</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">0x6C</span>], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">919</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">0x6E</span>], <span class="hljs-number">0</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">920</td><td class="line-text">
</td></tr>
<tr><td class="line-number">921</td><td class="line-text">inta_call_int8:
</td></tr>
<tr><td class="line-number">922</td><td class="line-text">
</td></tr>
<tr><td class="line-number">923</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>	<span class="hljs-comment">; Workaround for CPM-86 - INT 1C destroys AX!!</span>
</td></tr>
<tr><td class="line-number">924</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">8</span>
</td></tr>
<tr><td class="line-number">925</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">926</td><td class="line-text">
</td></tr>
<tr><td class="line-number">927</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">928</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">929</td><td class="line-text">	<span class="hljs-keyword">jne</span>	inta_call_int8
</td></tr>
<tr><td class="line-number">930</td><td class="line-text">
</td></tr>
<tr><td class="line-number">931</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:tm_msec]
</td></tr>
<tr><td class="line-number">932</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:last_int8_msec], <span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">933</td><td class="line-text">
</td></tr>
<tr><td class="line-number">934</td><td class="line-text">skip_timer_increment:
</td></tr>
<tr><td class="line-number">935</td><td class="line-text">
</td></tr>
<tr><td class="line-number">936</td><td class="line-text">	<span class="hljs-comment">; If last key was from SDL, don't simulate key up events (SDL will do it for us)</span>
</td></tr>
<tr><td class="line-number">937</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:last_key_sdl], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">938</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i8_end
</td></tr>
<tr><td class="line-number">939</td><td class="line-text">
</td></tr>
<tr><td class="line-number">940</td><td class="line-text">	<span class="hljs-comment">; See if we have any keys down. If so, release them</span>
</td></tr>
<tr><td class="line-number">941</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:key_now_down-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">942</td><td class="line-text">	<span class="hljs-keyword">je</span>	i8_no_key_down
</td></tr>
<tr><td class="line-number">943</td><td class="line-text">
</td></tr>
<tr><td class="line-number">944</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:key_now_down-bios_data]
</td></tr>
<tr><td class="line-number">945</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:key_now_down-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">946</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x80</span>
</td></tr>
<tr><td class="line-number">947</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">948</td><td class="line-text">
</td></tr>
<tr><td class="line-number">949</td><td class="line-text">  i8_no_key_down:
</td></tr>
<tr><td class="line-number">950</td><td class="line-text">
</td></tr>
<tr><td class="line-number">951</td><td class="line-text">	<span class="hljs-comment">; See if we have a waiting ESC flag</span>
</td></tr>
<tr><td class="line-number">952</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">953</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i8_end
</td></tr>
<tr><td class="line-number">954</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">955</td><td class="line-text">	<span class="hljs-comment">; Did we have one last two cycles as well?</span>
</td></tr>
<tr><td class="line-number">956</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag_last-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">957</td><td class="line-text">	<span class="hljs-keyword">je</span>	i8_stuff_esc
</td></tr>
<tr><td class="line-number">958</td><td class="line-text">
</td></tr>
<tr><td class="line-number">959</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag_last-bios_data]
</td></tr>
<tr><td class="line-number">960</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i8_end
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">961</td><td class="line-text">
</td></tr>
<tr><td class="line-number">962</td><td class="line-text">i8_stuff_esc:
</td></tr>
<tr><td class="line-number">963</td><td class="line-text">
</td></tr>
<tr><td class="line-number">964</td><td class="line-text">	<span class="hljs-comment">; Yes, clear the ESC flag and put it in the keyboard buffer</span>
</td></tr>
<tr><td class="line-number">965</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">966</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:escape_flag_last-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">967</td><td class="line-text">
</td></tr>
<tr><td class="line-number">968</td><td class="line-text">	<span class="hljs-comment">; mov	bp, [es:kbbuf_tail-bios_data]</span>
</td></tr>
<tr><td class="line-number">969</td><td class="line-text">	<span class="hljs-comment">; mov	byte [es:bp], 0x1b ; ESC ASCII code</span>
</td></tr>
<tr><td class="line-number">970</td><td class="line-text">	<span class="hljs-comment">; mov	byte [es:bp+1], 0x01 ; ESC scan code</span>
</td></tr>
<tr><td class="line-number">971</td><td class="line-text">
</td></tr>
<tr><td class="line-number">972</td><td class="line-text">	<span class="hljs-comment">; ESC keystroke is in the buffer now</span>
</td></tr>
<tr><td class="line-number">973</td><td class="line-text">	<span class="hljs-comment">; add	word [es:kbbuf_tail-bios_data], 2</span>
</td></tr>
<tr><td class="line-number">974</td><td class="line-text">	<span class="hljs-comment">; call	kb_adjust_buf ; Wrap the tail around the head if the buffer gets too large</span>
</td></tr>
<tr><td class="line-number">975</td><td class="line-text">
</td></tr>
<tr><td class="line-number">976</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:this_keystroke-bios_data], <span class="hljs-number">0x1b</span>
</td></tr>
<tr><td class="line-number">977</td><td class="line-text">
</td></tr>
<tr><td class="line-number">978</td><td class="line-text">	<span class="hljs-comment">; Push out ESC keypress/release</span>
</td></tr>
<tr><td class="line-number">979</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">980</td><td class="line-text">	<span class="hljs-keyword">call</span>	keypress_release
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">981</td><td class="line-text">
</td></tr>
<tr><td class="line-number">982</td><td class="line-text">i8_end:	
</td></tr>
<tr><td class="line-number">983</td><td class="line-text">
</td></tr>
<tr><td class="line-number">984</td><td class="line-text">	<span class="hljs-comment">; A Hercules graphics adapter flips bit 7 of I/O port 3BA on refresh</span>
</td></tr>
<tr><td class="line-number">985</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3BA</span>
</td></tr>
<tr><td class="line-number">986</td><td class="line-text">	<span class="hljs-keyword">in</span> 	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">987</td><td class="line-text">	<span class="hljs-keyword">xor</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x80</span>
</td></tr>
<tr><td class="line-number">988</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">989</td><td class="line-text">
</td></tr>
<tr><td class="line-number">990</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">991</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">992</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">993</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">994</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">995</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">996</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">997</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">998</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">999</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1000</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1001</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">1002</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1003</td><td class="line-text"><span class="hljs-comment">; ************************* INT 8h handler - timer</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1004</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1005</td><td class="line-text">int8:
</td></tr>
<tr><td class="line-number">1006</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1007</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">0x1c</span>
</td></tr>
<tr><td class="line-number">1008</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">1009</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1010</td><td class="line-text"><span class="hljs-comment">; ************************* INT 10h handler - video services</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1011</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1012</td><td class="line-text">int10:
</td></tr>
<tr><td class="line-number">1013</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1014</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x00</span> <span class="hljs-comment">; Set video mode</span>
</td></tr>
<tr><td class="line-number">1015</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_set_vm
</td></tr>
<tr><td class="line-number">1016</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x01</span> <span class="hljs-comment">; Set cursor shape</span>
</td></tr>
<tr><td class="line-number">1017</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_set_cshape
</td></tr>
<tr><td class="line-number">1018</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x02</span> <span class="hljs-comment">; Set cursor position</span>
</td></tr>
<tr><td class="line-number">1019</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_set_cursor
</td></tr>
<tr><td class="line-number">1020</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x03</span> <span class="hljs-comment">; Get cursur position</span>
</td></tr>
<tr><td class="line-number">1021</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_get_cursor
</td></tr>
<tr><td class="line-number">1022</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x06</span> <span class="hljs-comment">; Scroll up window</span>
</td></tr>
<tr><td class="line-number">1023</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_scrollup
</td></tr>
<tr><td class="line-number">1024</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x07</span> <span class="hljs-comment">; Scroll down window</span>
</td></tr>
<tr><td class="line-number">1025</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_scrolldown
</td></tr>
<tr><td class="line-number">1026</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x08</span> <span class="hljs-comment">; Get character at cursor</span>
</td></tr>
<tr><td class="line-number">1027</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_charatcur
</td></tr>
<tr><td class="line-number">1028</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x09</span> <span class="hljs-comment">; Write char and attribute</span>
</td></tr>
<tr><td class="line-number">1029</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_write_char_attrib
</td></tr>
<tr><td class="line-number">1030</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x0e</span> <span class="hljs-comment">; Write character at cursor position</span>
</td></tr>
<tr><td class="line-number">1031</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_write_char
</td></tr>
<tr><td class="line-number">1032</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x0f</span> <span class="hljs-comment">; Get video mode</span>
</td></tr>
<tr><td class="line-number">1033</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_get_vm
</td></tr>
<tr><td class="line-number">1034</td><td class="line-text">	<span class="hljs-comment">; cmp	ah, 0x1a ; Feature check</span>
</td></tr>
<tr><td class="line-number">1035</td><td class="line-text">	<span class="hljs-comment">; je	int10_features</span>
</td></tr>
<tr><td class="line-number">1036</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1037</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1038</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1039</td><td class="line-text">  int10_set_vm:
</td></tr>
<tr><td class="line-number">1040</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1041</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1042</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1043</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1044</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1045</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1046</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">4</span> <span class="hljs-comment">; CGA mode 4</span>
</td></tr>
<tr><td class="line-number">1047</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_switch_to_cga_gfx
</td></tr>
<tr><td class="line-number">1048</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">5</span>
</td></tr>
<tr><td class="line-number">1049</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_switch_to_cga_gfx
</td></tr>
<tr><td class="line-number">1050</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">6</span>
</td></tr>
<tr><td class="line-number">1051</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_switch_to_cga_gfx
</td></tr>
<tr><td class="line-number">1052</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1053</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1054</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1055</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b8</span>
</td></tr>
<tr><td class="line-number">1056</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1057</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1058</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1059</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">1060</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; Hercules CRTC "horizontal displayed" register select</span>
</td></tr>
<tr><td class="line-number">1061</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1062</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">1063</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x2d</span>	<span class="hljs-comment">; 0x2D = 45 (* 16) = 720 pixels wide (GRAPHICS_X)</span>
</td></tr>
<tr><td class="line-number">1064</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1065</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">1066</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">6</span>		<span class="hljs-comment">; Hercules CRTC "vertical displayed" register select</span>
</td></tr>
<tr><td class="line-number">1067</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1068</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">1069</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x57</span>	<span class="hljs-comment">; 0x57 = 87 (* 4) = 348 pixels high (GRAPHICS_Y)</span>
</td></tr>
<tr><td class="line-number">1070</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1071</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1072</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1073</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1074</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1075</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">0xac</span>], <span class="hljs-number">0</span> <span class="hljs-comment">; Tell emulator we are in Hercules mode</span>
</td></tr>
<tr><td class="line-number">1076</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1077</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1078</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1079</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; If an app tries to set Hercules text mode 7, actually set mode 3 (we do not support mode 7's video memory buffer at B000:0)</span>
</td></tr>
<tr><td class="line-number">1080</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_set_vm_3
</td></tr>
<tr><td class="line-number">1081</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">2</span>		<span class="hljs-comment">; Same for text mode 2 (mono)</span>
</td></tr>
<tr><td class="line-number">1082</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_set_vm_3
</td></tr>
<tr><td class="line-number">1083</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1084</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	int10_set_vm_continue
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1085</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1086</td><td class="line-text">  int10_switch_to_cga_gfx:
</td></tr>
<tr><td class="line-number">1087</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1088</td><td class="line-text">	<span class="hljs-comment">; Switch to CGA-like graphics mode (with Hercules CRTC set for 640 x 400)</span>
</td></tr>
<tr><td class="line-number">1089</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1090</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1091</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1092</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1093</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:<span class="hljs-number">0x49</span>], <span class="hljs-built_in">al</span>	<span class="hljs-comment">; Current video mode</span>
</td></tr>
<tr><td class="line-number">1094</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:<span class="hljs-number">0xac</span>], <span class="hljs-number">1</span> <span class="hljs-comment">; Tell emulator we are in CGA mode</span>
</td></tr>
<tr><td class="line-number">1095</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1096</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">1097</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; Hercules CRTC "horizontal displayed" register select</span>
</td></tr>
<tr><td class="line-number">1098</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1099</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">1100</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x28</span>	<span class="hljs-comment">; 0x28 = 40 (* 16) = 640 pixels wide (GRAPHICS_X)</span>
</td></tr>
<tr><td class="line-number">1101</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1102</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b4</span>
</td></tr>
<tr><td class="line-number">1103</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">6</span>		<span class="hljs-comment">; Hercules CRTC "vertical displayed" register select</span>
</td></tr>
<tr><td class="line-number">1104</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1105</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b5</span>
</td></tr>
<tr><td class="line-number">1106</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x64</span>	<span class="hljs-comment">; 0x64 = 100 (* 4) = 400 pixels high (GRAPHICS_Y)</span>
</td></tr>
<tr><td class="line-number">1107</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1108</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1109</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b8</span>
</td></tr>
<tr><td class="line-number">1110</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x8a</span>
</td></tr>
<tr><td class="line-number">1111</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1112</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1113</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">7</span>	
</td></tr>
<tr><td class="line-number">1114</td><td class="line-text">	<span class="hljs-keyword">call</span>	clear_screen
</td></tr>
<tr><td class="line-number">1115</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1116</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x30</span>
</td></tr>
<tr><td class="line-number">1117</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	svmn_exit
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1118</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1119</td><td class="line-text">  int10_set_vm_3:
</td></tr>
<tr><td class="line-number">1120</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1121</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">3</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1122</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1123</td><td class="line-text">  int10_set_vm_continue:
</td></tr>
<tr><td class="line-number">1124</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1125</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1126</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1127</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1128</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:vidmode-bios_data], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1129</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1130</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; Black background, white foreground</span>
</td></tr>
<tr><td class="line-number">1131</td><td class="line-text">	<span class="hljs-keyword">call</span>	clear_screen	<span class="hljs-comment">; ANSI clear screen</span>
</td></tr>
<tr><td class="line-number">1132</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1133</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:vidmode-bios_data], <span class="hljs-number">6</span>
</td></tr>
<tr><td class="line-number">1134</td><td class="line-text">	<span class="hljs-keyword">je</span>	set6
</td></tr>
<tr><td class="line-number">1135</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x30</span>
</td></tr>
<tr><td class="line-number">1136</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	svmn
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1137</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1138</td><td class="line-text">  set6:
</td></tr>
<tr><td class="line-number">1139</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1140</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x3f</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1141</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1142</td><td class="line-text">  svmn:
</td></tr>
<tr><td class="line-number">1143</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1144</td><td class="line-text">	<span class="hljs-comment">; Take Hercules adapter out of graphics mode when resetting video mode via int 10</span>
</td></tr>
<tr><td class="line-number">1145</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1146</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3B8</span>
</td></tr>
<tr><td class="line-number">1147</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1148</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1149</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1150</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1151</td><td class="line-text">  svmn_exit:
</td></tr>
<tr><td class="line-number">1152</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1153</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1154</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1155</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1156</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1157</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1158</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1159</td><td class="line-text">  int10_set_cshape:
</td></tr>
<tr><td class="line-number">1160</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1161</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1162</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1163</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1164</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1165</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1166</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1167</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1168</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [cursor_visible-bios_data], <span class="hljs-number">1</span>	<span class="hljs-comment">; Show cursor</span>
</td></tr>
<tr><td class="line-number">1169</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1170</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">01100000b</span>
</td></tr>
<tr><td class="line-number">1171</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">00100000b</span>
</td></tr>
<tr><td class="line-number">1172</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cur_visible
</td></tr>
<tr><td class="line-number">1173</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1174</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [cursor_visible-bios_data], <span class="hljs-number">0</span>	<span class="hljs-comment">; Hide cursor</span>
</td></tr>
<tr><td class="line-number">1175</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_hide_cursor
</td></tr>
<tr><td class="line-number">1176</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cur_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1177</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1178</td><td class="line-text">    cur_visible:
</td></tr>
<tr><td class="line-number">1179</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1180</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_show_cursor
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1181</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1182</td><td class="line-text">    cur_done:
</td></tr>
<tr><td class="line-number">1183</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1184</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1185</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1186</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1187</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1188</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1189</td><td class="line-text">  int10_set_cursor:
</td></tr>
<tr><td class="line-number">1190</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1191</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1192</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1193</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1194</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1195</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1196</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1197</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[curpos_y-bios_data], <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">1198</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[crt_curpos_y-bios_data], <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">1199</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[curpos_x-bios_data], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">1200</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[crt_curpos_x-bios_data], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">1201</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1202</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">1203</td><td class="line-text">	<span class="hljs-keyword">jbe</span>	skip_set_cur_row_max
</td></tr>
<tr><td class="line-number">1204</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1205</td><td class="line-text">	<span class="hljs-comment">; If cursor is moved off the screen, then hide it</span>
</td></tr>
<tr><td class="line-number">1206</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_hide_cursor
</td></tr>
<tr><td class="line-number">1207</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	skip_set_cur_ansi
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1208</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1209</td><td class="line-text">    skip_set_cur_row_max:
</td></tr>
<tr><td class="line-number">1210</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1211</td><td class="line-text">     	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">79</span>
</td></tr>
<tr><td class="line-number">1212</td><td class="line-text">	<span class="hljs-keyword">jbe</span>	skip_set_cur_col_max
</td></tr>
<tr><td class="line-number">1213</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1214</td><td class="line-text">	<span class="hljs-comment">; If cursor is moved off the screen, then hide it</span>
</td></tr>
<tr><td class="line-number">1215</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_hide_cursor
</td></tr>
<tr><td class="line-number">1216</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	skip_set_cur_ansi
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1217</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1218</td><td class="line-text">    skip_set_cur_col_max:
</td></tr>
<tr><td class="line-number">1219</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1220</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1221</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1222</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1223</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1224</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">dh</span>		<span class="hljs-comment">; Row number</span>
</td></tr>
<tr><td class="line-number">1225</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1226</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1227</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1228</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1229</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>		<span class="hljs-comment">; Column number</span>
</td></tr>
<tr><td class="line-number">1230</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1231</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1232</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'H'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">1233</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1234</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1235</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [cursor_visible-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1236</td><td class="line-text">	<span class="hljs-keyword">jne</span>	skip_set_cur_ansi
</td></tr>
<tr><td class="line-number">1237</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_show_cursor
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1238</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1239</td><td class="line-text">    skip_set_cur_ansi:
</td></tr>
<tr><td class="line-number">1240</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1241</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1242</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1243</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1244</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1245</td><td class="line-text">  int10_get_cursor:
</td></tr>
<tr><td class="line-number">1246</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1247</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1248</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1249</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1250</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1251</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1252</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0x0607</span>
</td></tr>
<tr><td class="line-number">1253</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1254</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1255</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1256</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1257</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1258</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1259</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1260</td><td class="line-text">  int10_scrollup:
</td></tr>
<tr><td class="line-number">1261</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1262</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1263</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1264</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1265</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1266</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1267</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Convert from CGA to ANSI</span>
</td></tr>
<tr><td class="line-number">1268</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-number">12</span>
</td></tr>
<tr><td class="line-number">1269</td><td class="line-text">	<span class="hljs-keyword">ror</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1270</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">1271</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:<span class="hljs-built_in">bp</span>+colour_table]
</td></tr>
<tr><td class="line-number">1272</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">1273</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1274</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1275</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1276</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1277</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1278</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Background colour</span>
</td></tr>
<tr><td class="line-number">1279</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1280</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">1281</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1282</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1283</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1284</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1285</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1286</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1287</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1288</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Clear window</span>
</td></tr>
<tr><td class="line-number">1289</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial
</td></tr>
<tr><td class="line-number">1290</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1291</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Start of screen</span>
</td></tr>
<tr><td class="line-number">1292</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial
</td></tr>
<tr><td class="line-number">1293</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1294</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x4f</span> <span class="hljs-comment">; Clearing columns 0-79</span>
</td></tr>
<tr><td class="line-number">1295</td><td class="line-text">	<span class="hljs-keyword">jb</span>	cls_partial
</td></tr>
<tr><td class="line-number">1296</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1297</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">0x18</span> <span class="hljs-comment">; Clearing rows 0-24 (or more)</span>
</td></tr>
<tr><td class="line-number">1298</td><td class="line-text">	<span class="hljs-keyword">jb</span>	cls_partial
</td></tr>
<tr><td class="line-number">1299</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1300</td><td class="line-text">	<span class="hljs-keyword">call</span>	clear_screen
</td></tr>
<tr><td class="line-number">1301</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1302</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1303</td><td class="line-text">  cls_partial:
</td></tr>
<tr><td class="line-number">1304</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1305</td><td class="line-text">	<span class="hljs-keyword">push</span> 	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1306</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1307</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1308</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Number of rows to scroll are now in bl</span>
</td></tr>
<tr><td class="line-number">1309</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Clear whole window?</span>
</td></tr>
<tr><td class="line-number">1310</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial_up_whole
</td></tr>
<tr><td class="line-number">1311</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1312</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">25</span>		<span class="hljs-comment">; 25 rows</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1313</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1314</td><td class="line-text">  cls_partial_up_whole:
</td></tr>
<tr><td class="line-number">1315</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1316</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1317</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1318</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1319</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1320</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1321</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Start row 1? Maybe full screen</span>
</td></tr>
<tr><td class="line-number">1322</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_maybe_fs
</td></tr>
<tr><td class="line-number">1323</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_not_fs
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1324</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1325</td><td class="line-text">    cls_maybe_fs:
</td></tr>
<tr><td class="line-number">1326</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1327</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">24</span>		<span class="hljs-comment">; End row 25? Full screen for sure</span>
</td></tr>
<tr><td class="line-number">1328</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_fs
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1329</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1330</td><td class="line-text">    cls_not_fs:
</td></tr>
<tr><td class="line-number">1331</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1332</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ch</span>		<span class="hljs-comment">; Start row</span>
</td></tr>
<tr><td class="line-number">1333</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1334</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1335</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1336</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1337</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">dh</span>		<span class="hljs-comment">; End row</span>
</td></tr>
<tr><td class="line-number">1338</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1339</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1340</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1341</td><td class="line-text">    cls_fs:
</td></tr>
<tr><td class="line-number">1342</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1343</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'r'</span>		<span class="hljs-comment">; Set scrolling window</span>
</td></tr>
<tr><td class="line-number">1344</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1345</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1346</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1347</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1348</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1349</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1350</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1351</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1352</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_fs_multiline
</td></tr>
<tr><td class="line-number">1353</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1354</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'M'</span>
</td></tr>
<tr><td class="line-number">1355</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cs_fs_ml_out
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1356</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1357</td><td class="line-text">cls_fs_multiline:
</td></tr>
<tr><td class="line-number">1358</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1359</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Number of rows</span>
</td></tr>
<tr><td class="line-number">1360</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1361</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'S'</span>		<span class="hljs-comment">; Scroll up</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1362</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1363</td><td class="line-text">cs_fs_ml_out:
</td></tr>
<tr><td class="line-number">1364</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1365</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1366</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1367</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1368</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1369</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1370</td><td class="line-text">	<span class="hljs-comment">; Update "actual" cursor position with expected value - different ANSI terminals do different things</span>
</td></tr>
<tr><td class="line-number">1371</td><td class="line-text">	<span class="hljs-comment">; to the cursor position when you scroll</span>
</td></tr>
<tr><td class="line-number">1372</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1373</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1374</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1375</td><td class="line-text">	<span class="hljs-keyword">push</span> 	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1376</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1377</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1378</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1379</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1380</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1381</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">1382</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1383</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1384</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1385</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">10h</span>
</td></tr>
<tr><td class="line-number">1386</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1387</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1388</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1389</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1390</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1391</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1392</td><td class="line-text">int10_scroll_up_vmem_update:
</td></tr>
<tr><td class="line-number">1393</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1394</td><td class="line-text">	<span class="hljs-comment">; Now, we need to update video memory</span>
</td></tr>
<tr><td class="line-number">1395</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1396</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1397</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1398</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1399</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1400</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1401</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1402</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1403</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">1404</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">1405</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1406</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1407</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1408</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1409</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1410</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">1411</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1412</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1413</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1414</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1415</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">al</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1416</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1417</td><td class="line-text">    cls_vmem_scroll_up_next_line:
</td></tr>
<tr><td class="line-number">1418</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1419</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1420</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_vmem_scroll_up_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1421</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1422</td><td class="line-text">    cls_vmem_scroll_up_one:
</td></tr>
<tr><td class="line-number">1423</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1424</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1425</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1426</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1427</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1428</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ch</span>		<span class="hljs-comment">; Start row number is now in AX</span>
</td></tr>
<tr><td class="line-number">1429</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">80</span>
</td></tr>
<tr><td class="line-number">1430</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1431</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1432</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Character number is now in AX</span>
</td></tr>
<tr><td class="line-number">1433</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">1434</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Memory location is now in AX</span>
</td></tr>
<tr><td class="line-number">1435</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1436</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1437</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1438</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1439</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1440</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1441</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">2</span>*<span class="hljs-number">80</span>	<span class="hljs-comment">; In a moment we will copy CX words from DS:SI to ES:DI</span>
</td></tr>
<tr><td class="line-number">1442</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1443</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1444</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">1445</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1446</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1447</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1448</td><td class="line-text">	<span class="hljs-keyword">sbb</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; AX now contains the number of characters from the row to copy</span>
</td></tr>
<tr><td class="line-number">1449</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1450</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">1451</td><td class="line-text">	<span class="hljs-keyword">jae</span>	cls_vmem_scroll_up_one_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1452</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1453</td><td class="line-text">vmem_scroll_up_copy_next_row:
</td></tr>
<tr><td class="line-number">1454</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1455</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1456</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>		<span class="hljs-comment">; CX is now the length (in words) of the row to copy</span>
</td></tr>
<tr><td class="line-number">1457</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">1458</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsw</span>		<span class="hljs-comment">; Scroll the line up</span>
</td></tr>
<tr><td class="line-number">1459</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1460</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1461</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-number">ch</span>		<span class="hljs-comment">; Move onto the next row</span>
</td></tr>
<tr><td class="line-number">1462</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_vmem_scroll_up_one
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1463</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1464</td><td class="line-text">    cls_vmem_scroll_up_one_done:
</td></tr>
<tr><td class="line-number">1465</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1466</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1467</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>		<span class="hljs-comment">; CX is now the length (in words) of the row to copy</span>
</td></tr>
<tr><td class="line-number">1468</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">bh</span>		<span class="hljs-comment">; Attribute for new line</span>
</td></tr>
<tr><td class="line-number">1469</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Write 0 to video memory for new characters</span>
</td></tr>
<tr><td class="line-number">1470</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">1471</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">1472</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1473</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1474</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Scroll whole text block another line</span>
</td></tr>
<tr><td class="line-number">1475</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_vmem_scroll_up_next_line	
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1476</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1477</td><td class="line-text">    cls_vmem_scroll_up_done:
</td></tr>
<tr><td class="line-number">1478</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1479</td><td class="line-text">	<span class="hljs-comment">;mov	al, 0x1B	; Escape</span>
</td></tr>
<tr><td class="line-number">1480</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1481</td><td class="line-text">	<span class="hljs-comment">;mov	al, '['		; ANSI</span>
</td></tr>
<tr><td class="line-number">1482</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1483</td><td class="line-text">	<span class="hljs-comment">;mov	al, '0'		; Reset attributes</span>
</td></tr>
<tr><td class="line-number">1484</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1485</td><td class="line-text">	<span class="hljs-comment">;mov	al, 'm'</span>
</td></tr>
<tr><td class="line-number">1486</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1487</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1488</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">1489</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">1490</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1491</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1492</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1493</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1494</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1495</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1496</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1497</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1498</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1499</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1500</td><td class="line-text">  int10_scrolldown:
</td></tr>
<tr><td class="line-number">1501</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1502</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1503</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1504</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1505</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1506</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1507</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Convert from CGA to ANSI</span>
</td></tr>
<tr><td class="line-number">1508</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-number">12</span>
</td></tr>
<tr><td class="line-number">1509</td><td class="line-text">	<span class="hljs-keyword">ror</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1510</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">1511</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:<span class="hljs-built_in">bp</span>+colour_table]
</td></tr>
<tr><td class="line-number">1512</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">1513</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1514</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1515</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1516</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1517</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1518</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Background colour</span>
</td></tr>
<tr><td class="line-number">1519</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1520</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">1521</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1522</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1523</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1524</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1525</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1526</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1527</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1528</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Clear window</span>
</td></tr>
<tr><td class="line-number">1529</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial_down
</td></tr>
<tr><td class="line-number">1530</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1531</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Start of screen</span>
</td></tr>
<tr><td class="line-number">1532</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial_down
</td></tr>
<tr><td class="line-number">1533</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1534</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x4f</span> <span class="hljs-comment">; Clearing columns 0-79</span>
</td></tr>
<tr><td class="line-number">1535</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial_down
</td></tr>
<tr><td class="line-number">1536</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1537</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">0x18</span> <span class="hljs-comment">; Clearing rows 0-24 (or more)</span>
</td></tr>
<tr><td class="line-number">1538</td><td class="line-text">	<span class="hljs-keyword">jl</span>	cls_partial_down
</td></tr>
<tr><td class="line-number">1539</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1540</td><td class="line-text">	<span class="hljs-keyword">call</span>	clear_screen
</td></tr>
<tr><td class="line-number">1541</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1542</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1543</td><td class="line-text">  cls_partial_down:
</td></tr>
<tr><td class="line-number">1544</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1545</td><td class="line-text">	<span class="hljs-keyword">push</span> 	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1546</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1547</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1548</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1549</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Number of rows to scroll are now in bl</span>
</td></tr>
<tr><td class="line-number">1550</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1551</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Clear whole window?</span>
</td></tr>
<tr><td class="line-number">1552</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_partial_down_whole
</td></tr>
<tr><td class="line-number">1553</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1554</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">25</span>		<span class="hljs-comment">; 25 rows</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1555</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1556</td><td class="line-text">  cls_partial_down_whole:
</td></tr>
<tr><td class="line-number">1557</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1558</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1559</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1560</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1561</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1562</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1563</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Start row 1? Maybe full screen</span>
</td></tr>
<tr><td class="line-number">1564</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_maybe_fs_down
</td></tr>
<tr><td class="line-number">1565</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_not_fs_down
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1566</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1567</td><td class="line-text">    cls_maybe_fs_down:
</td></tr>
<tr><td class="line-number">1568</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1569</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">24</span>		<span class="hljs-comment">; End row 25? Full screen for sure</span>
</td></tr>
<tr><td class="line-number">1570</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_fs_down
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1571</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1572</td><td class="line-text">    cls_not_fs_down:
</td></tr>
<tr><td class="line-number">1573</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1574</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">ch</span>		<span class="hljs-comment">; Start row</span>
</td></tr>
<tr><td class="line-number">1575</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1576</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1577</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1578</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1579</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">dh</span>		<span class="hljs-comment">; End row</span>
</td></tr>
<tr><td class="line-number">1580</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1581</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1582</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1583</td><td class="line-text">    cls_fs_down:
</td></tr>
<tr><td class="line-number">1584</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1585</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'r'</span>		<span class="hljs-comment">; Set scrolling window</span>
</td></tr>
<tr><td class="line-number">1586</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1587</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1588</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1589</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1590</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1591</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1592</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1593</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1594</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cls_fs_down_multiline
</td></tr>
<tr><td class="line-number">1595</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1596</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'D'</span>
</td></tr>
<tr><td class="line-number">1597</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cs_fs_down_ml_out
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1598</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1599</td><td class="line-text">    cls_fs_down_multiline:
</td></tr>
<tr><td class="line-number">1600</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1601</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Number of rows</span>
</td></tr>
<tr><td class="line-number">1602</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1603</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'T'</span>		<span class="hljs-comment">; Scroll down</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1604</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1605</td><td class="line-text">    cs_fs_down_ml_out:
</td></tr>
<tr><td class="line-number">1606</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1607</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1608</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1609</td><td class="line-text">	<span class="hljs-comment">; Update "actual" cursor position with expected value - different ANSI terminals do different things</span>
</td></tr>
<tr><td class="line-number">1610</td><td class="line-text">	<span class="hljs-comment">; to the cursor position when you scroll</span>
</td></tr>
<tr><td class="line-number">1611</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1612</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1613</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1614</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1615</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1616</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1617</td><td class="line-text">	<span class="hljs-keyword">push</span> 	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1618</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1619</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1620</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1621</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1622</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1623</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">1624</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1625</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1626</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1627</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">10h</span>
</td></tr>
<tr><td class="line-number">1628</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1629</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1630</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1631</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1632</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1633</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1634</td><td class="line-text">int10_scroll_down_vmem_update:
</td></tr>
<tr><td class="line-number">1635</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1636</td><td class="line-text">	<span class="hljs-comment">; Now, we need to update video memory</span>
</td></tr>
<tr><td class="line-number">1637</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1638</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1639</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1640</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1641</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1642</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1643</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1644</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1645</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">1646</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">1647</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1648</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1649</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1650</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1651</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1652</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">1653</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1654</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1655</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1656</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1657</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">al</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1658</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1659</td><td class="line-text">    cls_vmem_scroll_down_next_line:
</td></tr>
<tr><td class="line-number">1660</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1661</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1662</td><td class="line-text">	<span class="hljs-keyword">je</span>	cls_vmem_scroll_down_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1663</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1664</td><td class="line-text">    cls_vmem_scroll_down_one:
</td></tr>
<tr><td class="line-number">1665</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1666</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1667</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1668</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1669</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1670</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">dh</span>		<span class="hljs-comment">; End row number is now in AX</span>
</td></tr>
<tr><td class="line-number">1671</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">80</span>
</td></tr>
<tr><td class="line-number">1672</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1673</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1674</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Character number is now in AX</span>
</td></tr>
<tr><td class="line-number">1675</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">1676</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Memory location (start of final row) is now in AX</span>
</td></tr>
<tr><td class="line-number">1677</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1678</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1679</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1680</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1681</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1682</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1683</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">2</span>*<span class="hljs-number">80</span>	<span class="hljs-comment">; In a moment we will copy CX words from DS:SI to ES:DI</span>
</td></tr>
<tr><td class="line-number">1684</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1685</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1686</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">1687</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1688</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1689</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">1690</td><td class="line-text">	<span class="hljs-keyword">sbb</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; AX now contains the number of characters from the row to copy</span>
</td></tr>
<tr><td class="line-number">1691</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1692</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">1693</td><td class="line-text">	<span class="hljs-keyword">jae</span>	cls_vmem_scroll_down_one_done
</td></tr>
<tr><td class="line-number">1694</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1695</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1696</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>		<span class="hljs-comment">; CX is now the length (in words) of the row to copy</span>
</td></tr>
<tr><td class="line-number">1697</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsw</span>		<span class="hljs-comment">; Scroll the line down</span>
</td></tr>
<tr><td class="line-number">1698</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1699</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1700</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-number">dh</span>		<span class="hljs-comment">; Move onto the next row</span>
</td></tr>
<tr><td class="line-number">1701</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_vmem_scroll_down_one
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1702</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1703</td><td class="line-text">    cls_vmem_scroll_down_one_done:
</td></tr>
<tr><td class="line-number">1704</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1705</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1706</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>		<span class="hljs-comment">; CX is now the length (in words) of the row to copy</span>
</td></tr>
<tr><td class="line-number">1707</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">bh</span>		<span class="hljs-comment">; Attribute for new line</span>
</td></tr>
<tr><td class="line-number">1708</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Write 0 to video memory for new characters</span>
</td></tr>
<tr><td class="line-number">1709</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">1710</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1711</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1712</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Scroll whole text block another line</span>
</td></tr>
<tr><td class="line-number">1713</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cls_vmem_scroll_down_next_line	
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1714</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1715</td><td class="line-text">    cls_vmem_scroll_down_done:
</td></tr>
<tr><td class="line-number">1716</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1717</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">1718</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">1719</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1720</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1721</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1722</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1723</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1724</td><td class="line-text">	<span class="hljs-comment">;mov	al, 0x1B	; Escape</span>
</td></tr>
<tr><td class="line-number">1725</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1726</td><td class="line-text">	<span class="hljs-comment">;mov	al, '['		; ANSI</span>
</td></tr>
<tr><td class="line-number">1727</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1728</td><td class="line-text">	<span class="hljs-comment">;mov	al, '0'		; Reset attributes</span>
</td></tr>
<tr><td class="line-number">1729</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1730</td><td class="line-text">	<span class="hljs-comment">;mov	al, 'm'</span>
</td></tr>
<tr><td class="line-number">1731</td><td class="line-text">	<span class="hljs-comment">;extended_putchar_al</span>
</td></tr>
<tr><td class="line-number">1732</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1733</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1734</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1735</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1736</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1737</td><td class="line-text">  int10_charatcur:
</td></tr>
<tr><td class="line-number">1738</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1739</td><td class="line-text">	<span class="hljs-comment">; This returns the character at the cursor. It is completely dysfunctional,</span>
</td></tr>
<tr><td class="line-number">1740</td><td class="line-text">	<span class="hljs-comment">; and only works at all if the character has previously been written following</span>
</td></tr>
<tr><td class="line-number">1741</td><td class="line-text">	<span class="hljs-comment">; an int 10/ah = 2 call to set the cursor position. Added just to support</span>
</td></tr>
<tr><td class="line-number">1742</td><td class="line-text">	<span class="hljs-comment">; GWBASIC.</span>
</td></tr>
<tr><td class="line-number">1743</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1744</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1745</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1746</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1747</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1748</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1749</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1750</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1751</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1752</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xc000</span>
</td></tr>
<tr><td class="line-number">1753</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1754</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1755</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">160</span>
</td></tr>
<tr><td class="line-number">1756</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1757</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1758</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1759</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1760</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1761</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1762</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1763</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1764</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1765</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1766</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">1767</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">bx</span>]
</td></tr>
<tr><td class="line-number">1768</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1769</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1770</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1771</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1772</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1773</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1774</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1775</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1776</td><td class="line-text">  i10_unsup:
</td></tr>
<tr><td class="line-number">1777</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1778</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1779</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1780</td><td class="line-text">  int10_write_char:
</td></tr>
<tr><td class="line-number">1781</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1782</td><td class="line-text">	<span class="hljs-comment">; First write the character to a buffer at C000:0. This is so that</span>
</td></tr>
<tr><td class="line-number">1783</td><td class="line-text">	<span class="hljs-comment">; we can later retrieve it using the get character at cursor function,</span>
</td></tr>
<tr><td class="line-number">1784</td><td class="line-text">	<span class="hljs-comment">; which GWBASIC uses.</span>
</td></tr>
<tr><td class="line-number">1785</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1786</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1787</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1788</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1789</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1790</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1791</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1792</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1793</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1794</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1795</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1796</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1797</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">1798</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1799</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1800</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1801</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1802</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xc000</span>
</td></tr>
<tr><td class="line-number">1803</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1804</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1805</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">160</span>
</td></tr>
<tr><td class="line-number">1806</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1807</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1808</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1809</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1810</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1811</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1812</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1813</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1814</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1815</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">bx</span>], <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1816</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1817</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1818</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1819</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1820</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1821</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1822</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	int10_write_char_skip_lines
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1823</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1824</td><td class="line-text">  int10_write_char_attrib:
</td></tr>
<tr><td class="line-number">1825</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1826</td><td class="line-text">	<span class="hljs-comment">; First write the character to a buffer at C000:0. This is so that</span>
</td></tr>
<tr><td class="line-number">1827</td><td class="line-text">	<span class="hljs-comment">; we can later retrieve it using the get character at cursor function,</span>
</td></tr>
<tr><td class="line-number">1828</td><td class="line-text">	<span class="hljs-comment">; which GWBASIC uses.</span>
</td></tr>
<tr><td class="line-number">1829</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1830</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1831</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1832</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1833</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1834</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1835</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1836</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1837</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1838</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1839</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1840</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1841</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">1842</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ch</span>, <span class="hljs-built_in">bl</span>
</td></tr>
<tr><td class="line-number">1843</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1844</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">1845</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1846</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1847</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xc000</span>
</td></tr>
<tr><td class="line-number">1848</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1849</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1850</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">160</span>
</td></tr>
<tr><td class="line-number">1851</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1852</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1853</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1854</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1855</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1856</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, [<span class="hljs-built_in">es</span>:curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1857</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1858</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1859</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1860</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">bx</span>], <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1861</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1862</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">ch</span>
</td></tr>
<tr><td class="line-number">1863</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1864</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">bl</span>
</td></tr>
<tr><td class="line-number">1865</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; Foreground colour now in bl</span>
</td></tr>
<tr><td class="line-number">1866</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1867</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Convert from CGA to ANSI</span>
</td></tr>
<tr><td class="line-number">1868</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">0xff</span>
</td></tr>
<tr><td class="line-number">1869</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:<span class="hljs-built_in">bp</span>+colour_table]
</td></tr>
<tr><td class="line-number">1870</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1871</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">8</span>		<span class="hljs-comment">; Bright attribute now in bh</span>
</td></tr>
<tr><td class="line-number">1872</td><td class="line-text"><span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">1873</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">1874</td><td class="line-text"><span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">1875</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1876</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1877</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1878</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1879</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1880</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">bh</span>		<span class="hljs-comment">; Bright attribute</span>
</td></tr>
<tr><td class="line-number">1881</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1882</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>
</td></tr>
<tr><td class="line-number">1883</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1884</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Foreground colour</span>
</td></tr>
<tr><td class="line-number">1885</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1886</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1887</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">ch</span>
</td></tr>
<tr><td class="line-number">1888</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1889</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">bl</span>
</td></tr>
<tr><td class="line-number">1890</td><td class="line-text"><span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">1891</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">1892</td><td class="line-text"><span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">1893</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; Background colour now in bl</span>
</td></tr>
<tr><td class="line-number">1894</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1895</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Convert from CGA to ANSI</span>
</td></tr>
<tr><td class="line-number">1896</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">0xff</span>
</td></tr>
<tr><td class="line-number">1897</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:<span class="hljs-built_in">bp</span>+colour_table]
</td></tr>
<tr><td class="line-number">1898</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1899</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">1900</td><td class="line-text">	<span class="hljs-comment">; rol	bh, 1</span>
</td></tr>
<tr><td class="line-number">1901</td><td class="line-text">	<span class="hljs-comment">; and	bh, 1		; Bright attribute now in bh (not used right now)</span>
</td></tr>
<tr><td class="line-number">1902</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1903</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>
</td></tr>
<tr><td class="line-number">1904</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1905</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Background colour</span>
</td></tr>
<tr><td class="line-number">1906</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">1907</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">1908</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1909</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">1910</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1911</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1912</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1913</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1914</td><td class="line-text">    out_another_char:
</td></tr>
<tr><td class="line-number">1915</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1916</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1917</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1918</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1919</td><td class="line-text">	<span class="hljs-keyword">jne</span>	out_another_char
</td></tr>
<tr><td class="line-number">1920</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1921</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">1922</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1923</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">1924</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1925</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'0'</span>		<span class="hljs-comment">; Reset attributes</span>
</td></tr>
<tr><td class="line-number">1926</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">1927</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>
</td></tr>
<tr><td class="line-number">1928</td><td class="line-text">	extended_putchar_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1929</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1930</td><td class="line-text">    int10_write_char_skip_lines:
</td></tr>
<tr><td class="line-number">1931</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1932</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1933</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1934</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1935</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1936</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1937</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x08</span>
</td></tr>
<tr><td class="line-number">1938</td><td class="line-text">	<span class="hljs-keyword">jne</span>	int10_write_char_attrib_inc_x
</td></tr>
<tr><td class="line-number">1939</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1940</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1941</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">byte</span> [crt_curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1942</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1943</td><td class="line-text">	<span class="hljs-keyword">jg</span>	int10_write_char_attrib_done
</td></tr>
<tr><td class="line-number">1944</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1945</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1946</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [crt_curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1947</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	int10_write_char_attrib_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1948</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1949</td><td class="line-text">    int10_write_char_attrib_inc_x:
</td></tr>
<tr><td class="line-number">1950</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1951</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x0A</span>	<span class="hljs-comment">; New line?</span>
</td></tr>
<tr><td class="line-number">1952</td><td class="line-text">	<span class="hljs-keyword">je</span>	int10_write_char_attrib_newline
</td></tr>
<tr><td class="line-number">1953</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1954</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x0D</span>	<span class="hljs-comment">; Carriage return?</span>
</td></tr>
<tr><td class="line-number">1955</td><td class="line-text">	<span class="hljs-keyword">jne</span>	int10_write_char_attrib_not_cr
</td></tr>
<tr><td class="line-number">1956</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1957</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1958</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [crt_curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1959</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	int10_write_char_attrib_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1960</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1961</td><td class="line-text">    int10_write_char_attrib_not_cr:
</td></tr>
<tr><td class="line-number">1962</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1963</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1964</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [crt_curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">1965</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data], <span class="hljs-number">80</span>
</td></tr>
<tr><td class="line-number">1966</td><td class="line-text">	<span class="hljs-keyword">jge</span>	int10_write_char_attrib_newline
</td></tr>
<tr><td class="line-number">1967</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	int10_write_char_attrib_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1968</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1969</td><td class="line-text">    int10_write_char_attrib_newline:
</td></tr>
<tr><td class="line-number">1970</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1971</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1972</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [crt_curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1973</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1974</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [crt_curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">1975</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1976</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [curpos_y-bios_data], <span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">1977</td><td class="line-text">	<span class="hljs-keyword">jb</span>	int10_write_char_attrib_done
</td></tr>
<tr><td class="line-number">1978</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [curpos_y-bios_data], <span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">1979</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [crt_curpos_y-bios_data], <span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">1980</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1981</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">1982</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">1983</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">1984</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x184f</span>
</td></tr>
<tr><td class="line-number">1985</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1986</td><td class="line-text">	<span class="hljs-keyword">pushf</span>
</td></tr>
<tr><td class="line-number">1987</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">1988</td><td class="line-text">	<span class="hljs-keyword">call</span>	int10_scroll_up_vmem_update
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">1989</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1990</td><td class="line-text">    int10_write_char_attrib_done:
</td></tr>
<tr><td class="line-number">1991</td><td class="line-text">
</td></tr>
<tr><td class="line-number">1992</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">1993</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">1994</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">1995</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">1996</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">1997</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">1998</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">1999</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2000</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2001</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2002</td><td class="line-text">  int10_get_vm:
</td></tr>
<tr><td class="line-number">2003</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2004</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2005</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2006</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">2007</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2008</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2009</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">80</span> <span class="hljs-comment">; Number of columns</span>
</td></tr>
<tr><td class="line-number">2010</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:vidmode-bios_data]
</td></tr>
<tr><td class="line-number">2011</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2012</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2013</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2014</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2015</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2016</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2017</td><td class="line-text">  int10_features:
</td></tr>
<tr><td class="line-number">2018</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2019</td><td class="line-text">	<span class="hljs-comment">; Signify we have CGA display</span>
</td></tr>
<tr><td class="line-number">2020</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2021</td><td class="line-text">	<span class="hljs-comment">; mov	al, 0x1a</span>
</td></tr>
<tr><td class="line-number">2022</td><td class="line-text">	<span class="hljs-comment">; mov	bx, 0x0202</span>
</td></tr>
<tr><td class="line-number">2023</td><td class="line-text">	<span class="hljs-comment">; iret</span>
</td></tr>
<tr><td class="line-number">2024</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2025</td><td class="line-text"><span class="hljs-comment">; ************************* INT 11h - get equipment list</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2026</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2027</td><td class="line-text">int11:	
</td></tr>
<tr><td class="line-number">2028</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:equip]
</td></tr>
<tr><td class="line-number">2029</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">2030</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2031</td><td class="line-text"><span class="hljs-comment">; ************************* INT 12h - return memory size</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2032</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2033</td><td class="line-text">int12:	
</td></tr>
<tr><td class="line-number">2034</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x280</span> <span class="hljs-comment">; 640K conventional memory</span>
</td></tr>
<tr><td class="line-number">2035</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">2036</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2037</td><td class="line-text"><span class="hljs-comment">; ************************* INT 13h handler - disk services</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2038</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2039</td><td class="line-text">int13:
</td></tr>
<tr><td class="line-number">2040</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x00</span> <span class="hljs-comment">; Reset disk</span>
</td></tr>
<tr><td class="line-number">2041</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_reset_disk
</td></tr>
<tr><td class="line-number">2042</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x01</span> <span class="hljs-comment">; Get last status</span>
</td></tr>
<tr><td class="line-number">2043</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_last_status
</td></tr>
<tr><td class="line-number">2044</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2045</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; Hard disk being queried?</span>
</td></tr>
<tr><td class="line-number">2046</td><td class="line-text">	<span class="hljs-keyword">jne</span>	i13_diskok
</td></tr>
<tr><td class="line-number">2047</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2048</td><td class="line-text">	<span class="hljs-comment">; Now, need to check an HD is installed</span>
</td></tr>
<tr><td class="line-number">2049</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:num_disks], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">2050</td><td class="line-text">	<span class="hljs-keyword">jge</span>	i13_diskok
</td></tr>
<tr><td class="line-number">2051</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2052</td><td class="line-text">	<span class="hljs-comment">; No HD, so return an error</span>
</td></tr>
<tr><td class="line-number">2053</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">15</span> <span class="hljs-comment">; Report no such drive</span>
</td></tr>
<tr><td class="line-number">2054</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2055</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2056</td><td class="line-text">  i13_diskok:
</td></tr>
<tr><td class="line-number">2057</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2058</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x02</span> <span class="hljs-comment">; Read disk</span>
</td></tr>
<tr><td class="line-number">2059</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_read_disk
</td></tr>
<tr><td class="line-number">2060</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x03</span> <span class="hljs-comment">; Write disk</span>
</td></tr>
<tr><td class="line-number">2061</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_write_disk
</td></tr>
<tr><td class="line-number">2062</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x04</span> <span class="hljs-comment">; Verify disk</span>
</td></tr>
<tr><td class="line-number">2063</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_verify
</td></tr>
<tr><td class="line-number">2064</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x05</span> <span class="hljs-comment">; Format track - does nothing here</span>
</td></tr>
<tr><td class="line-number">2065</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_format
</td></tr>
<tr><td class="line-number">2066</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x08</span> <span class="hljs-comment">; Get drive parameters (hard disk)</span>
</td></tr>
<tr><td class="line-number">2067</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_getparams
</td></tr>
<tr><td class="line-number">2068</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x0c</span> <span class="hljs-comment">; Seek (hard disk)</span>
</td></tr>
<tr><td class="line-number">2069</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_seek
</td></tr>
<tr><td class="line-number">2070</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x10</span> <span class="hljs-comment">; Check if drive ready (hard disk)</span>
</td></tr>
<tr><td class="line-number">2071</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_hdready
</td></tr>
<tr><td class="line-number">2072</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x15</span> <span class="hljs-comment">; Get disk type</span>
</td></tr>
<tr><td class="line-number">2073</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_getdisktype
</td></tr>
<tr><td class="line-number">2074</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x16</span> <span class="hljs-comment">; Detect disk change</span>
</td></tr>
<tr><td class="line-number">2075</td><td class="line-text">	<span class="hljs-keyword">je</span>	int13_diskchange
</td></tr>
<tr><td class="line-number">2076</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2077</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; Invalid function</span>
</td></tr>
<tr><td class="line-number">2078</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
</td></tr>
<tr><td class="line-number">2079</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2080</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2081</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2082</td><td class="line-text">  int13_reset_disk:
</td></tr>
<tr><td class="line-number">2083</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2084</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2085</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2086</td><td class="line-text">  int13_last_status:
</td></tr>
<tr><td class="line-number">2087</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2088</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, [<span class="hljs-built_in">cs</span>:disk_laststatus]
</td></tr>
<tr><td class="line-number">2089</td><td class="line-text">	<span class="hljs-keyword">je</span>	ls_no_error
</td></tr>
<tr><td class="line-number">2090</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2091</td><td class="line-text">	<span class="hljs-keyword">stc</span>
</td></tr>
<tr><td class="line-number">2092</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2093</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2094</td><td class="line-text">    ls_no_error:
</td></tr>
<tr><td class="line-number">2095</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2096</td><td class="line-text">	<span class="hljs-keyword">clc</span>
</td></tr>
<tr><td class="line-number">2097</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2098</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2099</td><td class="line-text">  int13_read_disk:
</td></tr>
<tr><td class="line-number">2100</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2101</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2102</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2103</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Floppy 0</span>
</td></tr>
<tr><td class="line-number">2104</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_flop_rd
</td></tr>
<tr><td class="line-number">2105</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; HD</span>
</td></tr>
<tr><td class="line-number">2106</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_hd_rd
</td></tr>
<tr><td class="line-number">2107</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2108</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2109</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2110</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2111</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2112</td><td class="line-text">    i_flop_rd:
</td></tr>
<tr><td class="line-number">2113</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2114</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2115</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2116</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2117</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cl</span>, [<span class="hljs-built_in">cs</span>:int1e_spt]
</td></tr>
<tr><td class="line-number">2118</td><td class="line-text">	<span class="hljs-keyword">ja</span>	rd_error
</td></tr>
<tr><td class="line-number">2119</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2120</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2121</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2122</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2123</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; Floppy disk file handle is stored at j[1] in emulator</span>
</td></tr>
<tr><td class="line-number">2124</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i_rd
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2125</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2126</td><td class="line-text">    i_hd_rd:
</td></tr>
<tr><td class="line-number">2127</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2128</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Hard disk file handle is stored at j[0] in emulator</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2129</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2130</td><td class="line-text">    i_rd: 
</td></tr>
<tr><td class="line-number">2131</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2132</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2133</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2134</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2135</td><td class="line-text">	<span class="hljs-comment">; Convert head/cylinder/sector number to byte offset in disk image</span>
</td></tr>
<tr><td class="line-number">2136</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2137</td><td class="line-text">	<span class="hljs-keyword">call</span>	chs_to_abs
</td></tr>
<tr><td class="line-number">2138</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2139</td><td class="line-text">	<span class="hljs-comment">; Now, SI:BP contains the absolute sector offset of the block. We then multiply by 512 to get the offset into the disk image</span>
</td></tr>
<tr><td class="line-number">2140</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2141</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2142</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">2143</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">9</span>
</td></tr>
<tr><td class="line-number">2144</td><td class="line-text">	extended_read_disk
</td></tr>
<tr><td class="line-number">2145</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">9</span>
</td></tr>
<tr><td class="line-number">2146</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">2147</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x02</span>	<span class="hljs-comment">; Put read code back</span>
</td></tr>
<tr><td class="line-number">2148</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2149</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2150</td><td class="line-text">	<span class="hljs-keyword">je</span>	rd_error
</td></tr>
<tr><td class="line-number">2151</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2152</td><td class="line-text">	<span class="hljs-comment">; Read was successful. Now, check if we have read the boot sector. If so, we want to update</span>
</td></tr>
<tr><td class="line-number">2153</td><td class="line-text">	<span class="hljs-comment">; our internal table of sectors/track to match the disk format</span>
</td></tr>
<tr><td class="line-number">2154</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2155</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; FDD?</span>
</td></tr>
<tr><td class="line-number">2156</td><td class="line-text">	<span class="hljs-keyword">jne</span>	rd_noerror
</td></tr>
<tr><td class="line-number">2157</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; First sector?</span>
</td></tr>
<tr><td class="line-number">2158</td><td class="line-text">	<span class="hljs-keyword">jne</span>	rd_noerror
</td></tr>
<tr><td class="line-number">2159</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2160</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2161</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2162</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">bx</span>+<span class="hljs-number">24</span>]	<span class="hljs-comment">; Number of SPT in floppy disk BPB</span>
</td></tr>
<tr><td class="line-number">2163</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2164</td><td class="line-text">	<span class="hljs-comment">; cmp	al, 0		; If disk is unformatted, do not update the table</span>
</td></tr>
<tr><td class="line-number">2165</td><td class="line-text">	<span class="hljs-comment">; jne	rd_update_spt</span>
</td></tr>
<tr><td class="line-number">2166</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">9</span>		<span class="hljs-comment">; 9 SPT, i.e. 720K disk, so update the table</span>
</td></tr>
<tr><td class="line-number">2167</td><td class="line-text">	<span class="hljs-keyword">je</span>	rd_update_spt
</td></tr>
<tr><td class="line-number">2168</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">18</span>
</td></tr>
<tr><td class="line-number">2169</td><td class="line-text">	<span class="hljs-keyword">je</span>	rd_update_spt	<span class="hljs-comment">; 18 SPT, i.e. 1.44MB disk, so update the table</span>
</td></tr>
<tr><td class="line-number">2170</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2171</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2172</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2173</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	rd_noerror
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2174</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2175</td><td class="line-text">    rd_update_spt:
</td></tr>
<tr><td class="line-number">2176</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2177</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:int1e_spt], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2178</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2179</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2180</td><td class="line-text">    rd_noerror:
</td></tr>
<tr><td class="line-number">2181</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2182</td><td class="line-text">	<span class="hljs-keyword">clc</span>
</td></tr>
<tr><td class="line-number">2183</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; No error</span>
</td></tr>
<tr><td class="line-number">2184</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	rd_finish
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2185</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2186</td><td class="line-text">    rd_error:
</td></tr>
<tr><td class="line-number">2187</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2188</td><td class="line-text">	<span class="hljs-keyword">stc</span>
</td></tr>
<tr><td class="line-number">2189</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">4</span> <span class="hljs-comment">; Sector not found</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2190</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2191</td><td class="line-text">    rd_finish:
</td></tr>
<tr><td class="line-number">2192</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2193</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2194</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2195</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2196</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2197</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">2198</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_carry
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2199</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2200</td><td class="line-text">  int13_write_disk:
</td></tr>
<tr><td class="line-number">2201</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2202</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2203</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2204</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Floppy 0</span>
</td></tr>
<tr><td class="line-number">2205</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_flop_wr
</td></tr>
<tr><td class="line-number">2206</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; HD</span>
</td></tr>
<tr><td class="line-number">2207</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_hd_wr
</td></tr>
<tr><td class="line-number">2208</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2209</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2210</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2211</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2212</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2213</td><td class="line-text">    i_flop_wr:
</td></tr>
<tr><td class="line-number">2214</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2215</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">1</span>		<span class="hljs-comment">; Floppy disk file handle is stored at j[1] in emulator</span>
</td></tr>
<tr><td class="line-number">2216</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	i_wr
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2217</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2218</td><td class="line-text">    i_hd_wr:
</td></tr>
<tr><td class="line-number">2219</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2220</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Hard disk file handle is stored at j[0] in emulator</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2221</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2222</td><td class="line-text">    i_wr:
</td></tr>
<tr><td class="line-number">2223</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2224</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2225</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2226</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2227</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">2228</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2229</td><td class="line-text">	<span class="hljs-comment">; Convert head/cylinder/sector number to byte offset in disk image</span>
</td></tr>
<tr><td class="line-number">2230</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2231</td><td class="line-text">	<span class="hljs-keyword">call</span>	chs_to_abs
</td></tr>
<tr><td class="line-number">2232</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2233</td><td class="line-text">	<span class="hljs-comment">; Signal an error if we are trying to write beyond the end of the disk</span>
</td></tr>
<tr><td class="line-number">2234</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">2235</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Hard disk?</span>
</td></tr>
<tr><td class="line-number">2236</td><td class="line-text">	<span class="hljs-keyword">jne</span>	wr_fine <span class="hljs-comment">; No - no need for disk sector valid check - <span class="hljs-doctag">NOTE:</span> original submission was JNAE which caused write problems on floppy disk</span>
</td></tr>
<tr><td class="line-number">2237</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2238</td><td class="line-text">	<span class="hljs-comment">; First, we add the number of sectors we are trying to write from the absolute</span>
</td></tr>
<tr><td class="line-number">2239</td><td class="line-text">	<span class="hljs-comment">; sector number returned by chs_to_abs. We need to have at least this many</span>
</td></tr>
<tr><td class="line-number">2240</td><td class="line-text">	<span class="hljs-comment">; sectors on the disk, otherwise return a sector not found error.</span>
</td></tr>
<tr><td class="line-number">2241</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2242</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2243</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2244</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2245</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2246</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2247</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2248</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2249</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">cs</span>:hd_secs_hi]
</td></tr>
<tr><td class="line-number">2250</td><td class="line-text">	<span class="hljs-keyword">ja</span>	wr_error
</td></tr>
<tr><td class="line-number">2251</td><td class="line-text">	<span class="hljs-keyword">jb</span>	wr_fine
</td></tr>
<tr><td class="line-number">2252</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, [<span class="hljs-built_in">cs</span>:hd_secs_lo]
</td></tr>
<tr><td class="line-number">2253</td><td class="line-text">	<span class="hljs-keyword">ja</span>	wr_error
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2254</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2255</td><td class="line-text">wr_fine:
</td></tr>
<tr><td class="line-number">2256</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2257</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2258</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">2259</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">9</span>
</td></tr>
<tr><td class="line-number">2260</td><td class="line-text">	extended_write_disk
</td></tr>
<tr><td class="line-number">2261</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">9</span>
</td></tr>
<tr><td class="line-number">2262</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">2263</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x03</span>	<span class="hljs-comment">; Put write code back</span>
</td></tr>
<tr><td class="line-number">2264</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2265</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2266</td><td class="line-text">	<span class="hljs-keyword">je</span>	wr_error
</td></tr>
<tr><td class="line-number">2267</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2268</td><td class="line-text">	<span class="hljs-keyword">clc</span>
</td></tr>
<tr><td class="line-number">2269</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; No error</span>
</td></tr>
<tr><td class="line-number">2270</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	wr_finish
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2271</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2272</td><td class="line-text">    wr_error:
</td></tr>
<tr><td class="line-number">2273</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2274</td><td class="line-text">	<span class="hljs-keyword">stc</span>
</td></tr>
<tr><td class="line-number">2275</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">4</span> <span class="hljs-comment">; Sector not found</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2276</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2277</td><td class="line-text">    wr_finish:
</td></tr>
<tr><td class="line-number">2278</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2279</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">2280</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2281</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2282</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">2283</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2284</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2285</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">2286</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_carry
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2287</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2288</td><td class="line-text">  int13_verify:
</td></tr>
<tr><td class="line-number">2289</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2290</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2291</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2292</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2293</td><td class="line-text">  int13_getparams:
</td></tr>
<tr><td class="line-number">2294</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2295</td><td class="line-text">	<span class="hljs-keyword">cmp</span> 	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2296</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_gp_fl
</td></tr>
<tr><td class="line-number">2297</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span>
</td></tr>
<tr><td class="line-number">2298</td><td class="line-text">	<span class="hljs-keyword">je</span>	i_gp_hd
</td></tr>
<tr><td class="line-number">2299</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2300</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">2301</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">2302</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2303</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2304</td><td class="line-text">    i_gp_fl:
</td></tr>
<tr><td class="line-number">2305</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2306</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2307</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2308</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, int1e	<span class="hljs-comment">; ES:DI now points to floppy parameters table (INT 1E)</span>
</td></tr>
<tr><td class="line-number">2309</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2310</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2311</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">2312</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">0x4f</span>
</td></tr>
<tr><td class="line-number">2313</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, [<span class="hljs-built_in">cs</span>:int1e_spt]
</td></tr>
<tr><td class="line-number">2314</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x0101</span>
</td></tr>
<tr><td class="line-number">2315</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2316</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2317</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2318</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2319</td><td class="line-text">    i_gp_hd:
</td></tr>
<tr><td class="line-number">2320</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2321</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2322</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2323</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2324</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, [<span class="hljs-built_in">cs</span>:hd_max_head]
</td></tr>
<tr><td class="line-number">2325</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [<span class="hljs-built_in">cs</span>:hd_max_track]
</td></tr>
<tr><td class="line-number">2326</td><td class="line-text">	<span class="hljs-keyword">ror</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2327</td><td class="line-text">	<span class="hljs-keyword">ror</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2328</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-number">ch</span>, [<span class="hljs-built_in">cs</span>:hd_max_sector]
</td></tr>
<tr><td class="line-number">2329</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-number">ch</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">2330</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2331</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2332</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2333</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2334</td><td class="line-text">  int13_seek:
</td></tr>
<tr><td class="line-number">2335</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2336</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2337</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2338</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2339</td><td class="line-text">  int13_hdready:
</td></tr>
<tr><td class="line-number">2340</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2341</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:num_disks], <span class="hljs-number">2</span>	<span class="hljs-comment">; HD present?</span>
</td></tr>
<tr><td class="line-number">2342</td><td class="line-text">	<span class="hljs-keyword">jne</span>	int13_hdready_nohd
</td></tr>
<tr><td class="line-number">2343</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span>		<span class="hljs-comment">; Checking first HD?</span>
</td></tr>
<tr><td class="line-number">2344</td><td class="line-text">	<span class="hljs-keyword">jne</span>	int13_hdready_nohd
</td></tr>
<tr><td class="line-number">2345</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2346</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2347</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2348</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2349</td><td class="line-text">    int13_hdready_nohd:
</td></tr>
<tr><td class="line-number">2350</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2351</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2352</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2353</td><td class="line-text">  int13_format:
</td></tr>
<tr><td class="line-number">2354</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2355</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2356</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2357</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2358</td><td class="line-text">  int13_getdisktype:
</td></tr>
<tr><td class="line-number">2359</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2360</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Floppy</span>
</td></tr>
<tr><td class="line-number">2361</td><td class="line-text">	<span class="hljs-keyword">je</span>	gdt_flop
</td></tr>
<tr><td class="line-number">2362</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0x80</span> <span class="hljs-comment">; HD</span>
</td></tr>
<tr><td class="line-number">2363</td><td class="line-text">	<span class="hljs-keyword">je</span>	gdt_hd
</td></tr>
<tr><td class="line-number">2364</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2365</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">15</span> <span class="hljs-comment">; Report no such drive</span>
</td></tr>
<tr><td class="line-number">2366</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:disk_laststatus], <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">2367</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2368</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2369</td><td class="line-text">    gdt_flop:
</td></tr>
<tr><td class="line-number">2370</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2371</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2372</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2373</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2374</td><td class="line-text">    gdt_hd:
</td></tr>
<tr><td class="line-number">2375</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2376</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">2377</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [<span class="hljs-built_in">cs</span>:hd_secs_hi]
</td></tr>
<tr><td class="line-number">2378</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, [<span class="hljs-built_in">cs</span>:hd_secs_lo]
</td></tr>
<tr><td class="line-number">2379</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2380</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2381</td><td class="line-text">  int13_diskchange:
</td></tr>
<tr><td class="line-number">2382</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2383</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Disk not changed</span>
</td></tr>
<tr><td class="line-number">2384</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
</td></tr>
<tr><td class="line-number">2385</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2386</td><td class="line-text"><span class="hljs-comment">; ************************* INT 14h - serial port functions</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2387</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2388</td><td class="line-text">int14:
</td></tr>
<tr><td class="line-number">2389</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2390</td><td class="line-text">	<span class="hljs-keyword">je</span>	int14_init
</td></tr>
<tr><td class="line-number">2391</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2392</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2393</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2394</td><td class="line-text">  int14_init:
</td></tr>
<tr><td class="line-number">2395</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2396</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2397</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
</td></tr>
<tr><td class="line-number">2398</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2399</td><td class="line-text"><span class="hljs-comment">; ************************* INT 15h - get system configuration</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2400</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2401</td><td class="line-text">int15:	<span class="hljs-comment">; Here we do not support any of the functions, and just return</span>
</td></tr>
<tr><td class="line-number">2402</td><td class="line-text">	<span class="hljs-comment">; a function not supported code - like the original IBM PC/XT does.</span>
</td></tr>
<tr><td class="line-number">2403</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2404</td><td class="line-text">	<span class="hljs-comment">; cmp	ah, 0xc0</span>
</td></tr>
<tr><td class="line-number">2405</td><td class="line-text">	<span class="hljs-comment">; je	int15_sysconfig</span>
</td></tr>
<tr><td class="line-number">2406</td><td class="line-text">	<span class="hljs-comment">; cmp	ah, 0x41</span>
</td></tr>
<tr><td class="line-number">2407</td><td class="line-text">	<span class="hljs-comment">; je	int15_waitevent</span>
</td></tr>
<tr><td class="line-number">2408</td><td class="line-text">	<span class="hljs-comment">; cmp	ah, 0x4f</span>
</td></tr>
<tr><td class="line-number">2409</td><td class="line-text">	<span class="hljs-comment">; je	int15_intercept</span>
</td></tr>
<tr><td class="line-number">2410</td><td class="line-text">	<span class="hljs-comment">; cmp	ah, 0x88</span>
</td></tr>
<tr><td class="line-number">2411</td><td class="line-text">	<span class="hljs-comment">; je	int15_getextmem</span>
</td></tr>
<tr><td class="line-number">2412</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2413</td><td class="line-text"><span class="hljs-comment">; Otherwise, function not supported</span>
</td></tr>
<tr><td class="line-number">2414</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2415</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x86</span>
</td></tr>
<tr><td class="line-number">2416</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2417</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
</td></tr>
<tr><td class="line-number">2418</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2419</td><td class="line-text"><span class="hljs-comment">;  int15_sysconfig: ; Return address of system configuration table in ROM</span>
</td></tr>
<tr><td class="line-number">2420</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2421</td><td class="line-text"><span class="hljs-comment">;	mov	bx, 0xf000</span>
</td></tr>
<tr><td class="line-number">2422</td><td class="line-text"><span class="hljs-comment">;	mov	es, bx</span>
</td></tr>
<tr><td class="line-number">2423</td><td class="line-text"><span class="hljs-comment">;	mov	bx, rom_config</span>
</td></tr>
<tr><td class="line-number">2424</td><td class="line-text"><span class="hljs-comment">;	mov	ah, 0</span>
</td></tr>
<tr><td class="line-number">2425</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2426</td><td class="line-text"><span class="hljs-comment">;	jmp	reach_stack_clc</span>
</td></tr>
<tr><td class="line-number">2427</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2428</td><td class="line-text"><span class="hljs-comment">;  int15_waitevent: ; Events not supported</span>
</td></tr>
<tr><td class="line-number">2429</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2430</td><td class="line-text"><span class="hljs-comment">;	mov	ah, 0x86</span>
</td></tr>
<tr><td class="line-number">2431</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2432</td><td class="line-text"><span class="hljs-comment">;	jmp	reach_stack_stc</span>
</td></tr>
<tr><td class="line-number">2433</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2434</td><td class="line-text"><span class="hljs-comment">;  int15_intercept: ; Keyboard intercept</span>
</td></tr>
<tr><td class="line-number">2435</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2436</td><td class="line-text"><span class="hljs-comment">;	jmp	reach_stack_stc</span>
</td></tr>
<tr><td class="line-number">2437</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2438</td><td class="line-text"><span class="hljs-comment">;  int15_getextmem: ; Extended memory not supported</span>
</td></tr>
<tr><td class="line-number">2439</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2440</td><td class="line-text"><span class="hljs-comment">;	mov	ah,0x86</span>
</td></tr>
<tr><td class="line-number">2441</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">2442</td><td class="line-text"><span class="hljs-comment">;	jmp	reach_stack_stc</span>
</td></tr>
<tr><td class="line-number">2443</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2444</td><td class="line-text"><span class="hljs-comment">; ************************* INT 16h handler - keyboard</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2445</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2446</td><td class="line-text">int16:
</td></tr>
<tr><td class="line-number">2447</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x00</span> <span class="hljs-comment">; Get keystroke (remove from buffer)</span>
</td></tr>
<tr><td class="line-number">2448</td><td class="line-text">	<span class="hljs-keyword">je</span>	kb_getkey
</td></tr>
<tr><td class="line-number">2449</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x01</span> <span class="hljs-comment">; Check for keystroke (do not remove from buffer)</span>
</td></tr>
<tr><td class="line-number">2450</td><td class="line-text">	<span class="hljs-keyword">je</span>	kb_checkkey
</td></tr>
<tr><td class="line-number">2451</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x02</span> <span class="hljs-comment">; Check shift flags</span>
</td></tr>
<tr><td class="line-number">2452</td><td class="line-text">	<span class="hljs-keyword">je</span>	kb_shiftflags
</td></tr>
<tr><td class="line-number">2453</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x12</span> <span class="hljs-comment">; Check shift flags</span>
</td></tr>
<tr><td class="line-number">2454</td><td class="line-text">	<span class="hljs-keyword">je</span>	kb_extshiftflags
</td></tr>
<tr><td class="line-number">2455</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2456</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2457</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2458</td><td class="line-text">  kb_getkey:
</td></tr>
<tr><td class="line-number">2459</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">2460</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2461</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2462</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2463</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2464</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2465</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">2466</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2467</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2468</td><td class="line-text">    kb_gkblock:
</td></tr>
<tr><td class="line-number">2469</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2470</td><td class="line-text">	<span class="hljs-keyword">cli</span>
</td></tr>
<tr><td class="line-number">2471</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2472</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data]
</td></tr>
<tr><td class="line-number">2473</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, [<span class="hljs-built_in">es</span>:kbbuf_head-bios_data]
</td></tr>
<tr><td class="line-number">2474</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">bx</span>]
</td></tr>
<tr><td class="line-number">2475</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2476</td><td class="line-text">	<span class="hljs-keyword">sti</span>
</td></tr>
<tr><td class="line-number">2477</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2478</td><td class="line-text">	<span class="hljs-comment">; Wait until there is a key in the buffer</span>
</td></tr>
<tr><td class="line-number">2479</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2480</td><td class="line-text">	<span class="hljs-keyword">je</span>	kb_gkblock
</td></tr>
<tr><td class="line-number">2481</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2482</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">es</span>:kbbuf_head-bios_data], <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">2483</td><td class="line-text">	<span class="hljs-keyword">call</span>	kb_adjust_buf
</td></tr>
<tr><td class="line-number">2484</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2485</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">2486</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">2487</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2488</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2489</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2490</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2491</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>	
</td></tr>
<tr><td class="line-number">2492</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2493</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2494</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2495</td><td class="line-text">  kb_checkkey:
</td></tr>
<tr><td class="line-number">2496</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2497</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2498</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2499</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2500</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2501</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2502</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">2503</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2504</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2505</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data]
</td></tr>
<tr><td class="line-number">2506</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, [<span class="hljs-built_in">es</span>:kbbuf_head-bios_data]
</td></tr>
<tr><td class="line-number">2507</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">bx</span>]
</td></tr>
<tr><td class="line-number">2508</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2509</td><td class="line-text">	<span class="hljs-keyword">sti</span>
</td></tr>
<tr><td class="line-number">2510</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2511</td><td class="line-text">	<span class="hljs-comment">; Check if there is a key in the buffer. ZF is set if there is none.</span>
</td></tr>
<tr><td class="line-number">2512</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2513</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2514</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">dh</span>
</td></tr>
<tr><td class="line-number">2515</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">2516</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2517</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2518</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2519</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2520</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2521</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2522</td><td class="line-text">	<span class="hljs-keyword">retf</span>	<span class="hljs-number">2</span>	<span class="hljs-comment">; NEED TO FIX THIS!!</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2523</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2524</td><td class="line-text">    kb_shiftflags:
</td></tr>
<tr><td class="line-number">2525</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2526</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2527</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2528</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2529</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">2530</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2531</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2532</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:keyflags1-bios_data]
</td></tr>
<tr><td class="line-number">2533</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2534</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2535</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2536</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2537</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2538</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2539</td><td class="line-text">    kb_extshiftflags:
</td></tr>
<tr><td class="line-number">2540</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2541</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2542</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2543</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2544</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">2545</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2546</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2547</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:keyflags1-bios_data]
</td></tr>
<tr><td class="line-number">2548</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2549</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2550</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2551</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2552</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2553</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">2554</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2555</td><td class="line-text"><span class="hljs-comment">; ************************* INT 17h handler - printer</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2556</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2557</td><td class="line-text">int17:
</td></tr>
<tr><td class="line-number">2558</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x01</span>
</td></tr>
<tr><td class="line-number">2559</td><td class="line-text">	<span class="hljs-keyword">je</span>	int17_initprint <span class="hljs-comment">; Initialise printer</span>
</td></tr>
<tr><td class="line-number">2560</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2561</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2562</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2563</td><td class="line-text">  int17_initprint:
</td></tr>
<tr><td class="line-number">2564</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2565</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; No printer</span>
</td></tr>
<tr><td class="line-number">2566</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_stc
</td></tr>
<tr><td class="line-number">2567</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2568</td><td class="line-text"><span class="hljs-comment">; ************************* INT 19h = reboot</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2569</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2570</td><td class="line-text">int19:
</td></tr>
<tr><td class="line-number">2571</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	boot
</td></tr>
<tr><td class="line-number">2572</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2573</td><td class="line-text"><span class="hljs-comment">; ************************* INT 1Ah - clock</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2574</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2575</td><td class="line-text">int1a:
</td></tr>
<tr><td class="line-number">2576</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2577</td><td class="line-text">	<span class="hljs-keyword">je</span>	int1a_getsystime <span class="hljs-comment">; Get ticks since midnight (used for RTC time)</span>
</td></tr>
<tr><td class="line-number">2578</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">2579</td><td class="line-text">	<span class="hljs-keyword">je</span>	int1a_gettime <span class="hljs-comment">; Get RTC time (not actually used by DOS)</span>
</td></tr>
<tr><td class="line-number">2580</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">2581</td><td class="line-text">	<span class="hljs-keyword">je</span>	int1a_getdate <span class="hljs-comment">; Get RTC date</span>
</td></tr>
<tr><td class="line-number">2582</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x0f</span>
</td></tr>
<tr><td class="line-number">2583</td><td class="line-text">	<span class="hljs-keyword">je</span>	int1a_init    <span class="hljs-comment">; Initialise RTC</span>
</td></tr>
<tr><td class="line-number">2584</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2585</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2586</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2587</td><td class="line-text">  int1a_getsystime:
</td></tr>
<tr><td class="line-number">2588</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2589</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2590</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2591</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2592</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2593</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2594</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2595</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2596</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2597</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2598</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2599</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, timetable
</td></tr>
<tr><td class="line-number">2600</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2601</td><td class="line-text">	extended_get_rtc
</td></tr>
<tr><td class="line-number">2602</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2603</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">182</span>  <span class="hljs-comment">; Clock ticks in 10 seconds</span>
</td></tr>
<tr><td class="line-number">2604</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">word</span> [tm_msec]
</td></tr>
<tr><td class="line-number">2605</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">10000</span>
</td></tr>
<tr><td class="line-number">2606</td><td class="line-text">	<span class="hljs-keyword">div</span>	<span class="hljs-built_in">bx</span> <span class="hljs-comment">; AX now contains clock ticks in milliseconds counter</span>
</td></tr>
<tr><td class="line-number">2607</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[tm_msec], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2608</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2609</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">182</span>  <span class="hljs-comment">; Clock ticks in 10 seconds</span>
</td></tr>
<tr><td class="line-number">2610</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">word</span> [tm_sec]
</td></tr>
<tr><td class="line-number">2611</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">2612</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2613</td><td class="line-text">	<span class="hljs-keyword">div</span>	<span class="hljs-built_in">bx</span> <span class="hljs-comment">; AX now contains clock ticks in seconds counter</span>
</td></tr>
<tr><td class="line-number">2614</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[tm_sec], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2615</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2616</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">1092</span> <span class="hljs-comment">; Clock ticks in a minute</span>
</td></tr>
<tr><td class="line-number">2617</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">word</span> [tm_min] <span class="hljs-comment">; AX now contains clock ticks in minutes counter</span>
</td></tr>
<tr><td class="line-number">2618</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[tm_min], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2619</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">2620</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">65520</span> <span class="hljs-comment">; Clock ticks in an hour</span>
</td></tr>
<tr><td class="line-number">2621</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">word</span> [tm_hour] <span class="hljs-comment">; DX:AX now contains clock ticks in hours counter</span>
</td></tr>
<tr><td class="line-number">2622</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2623</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, [tm_msec] <span class="hljs-comment">; Add milliseconds in to AX</span>
</td></tr>
<tr><td class="line-number">2624</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Carry into DX if necessary</span>
</td></tr>
<tr><td class="line-number">2625</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, [tm_sec] <span class="hljs-comment">; Add seconds in to AX</span>
</td></tr>
<tr><td class="line-number">2626</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Carry into DX if necessary</span>
</td></tr>
<tr><td class="line-number">2627</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, [tm_min] <span class="hljs-comment">; Add minutes in to AX</span>
</td></tr>
<tr><td class="line-number">2628</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; Carry into DX if necessary</span>
</td></tr>
<tr><td class="line-number">2629</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2630</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2631</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2632</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2633</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2634</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2635</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2636</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2637</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2638</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2639</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2640</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2641</td><td class="line-text">	<span class="hljs-keyword">iret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2642</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2643</td><td class="line-text">  int1a_gettime:
</td></tr>
<tr><td class="line-number">2644</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2645</td><td class="line-text">	<span class="hljs-comment">; Return the system time in BCD format. DOS doesn't use this, but we need to return</span>
</td></tr>
<tr><td class="line-number">2646</td><td class="line-text">	<span class="hljs-comment">; something or the system thinks there is no RTC.</span>
</td></tr>
<tr><td class="line-number">2647</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2648</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2649</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2650</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2651</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2652</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2653</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2654</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2655</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2656</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2657</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2658</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, timetable
</td></tr>
<tr><td class="line-number">2659</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2660</td><td class="line-text">	extended_get_rtc
</td></tr>
<tr><td class="line-number">2661</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2662</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2663</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_hour]
</td></tr>
<tr><td class="line-number">2664</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2665</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Hour in BCD is in BH</span>
</td></tr>
<tr><td class="line-number">2666</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2667</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2668</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_min]
</td></tr>
<tr><td class="line-number">2669</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2670</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Minute in BCD is in BL</span>
</td></tr>
<tr><td class="line-number">2671</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2672</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2673</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_sec]
</td></tr>
<tr><td class="line-number">2674</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2675</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Second in BCD is in DH</span>
</td></tr>
<tr><td class="line-number">2676</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2677</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">0</span>		<span class="hljs-comment">; Daylight saving flag = 0 always</span>
</td></tr>
<tr><td class="line-number">2678</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2679</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Hour:minute now in CH:CL</span>
</td></tr>
<tr><td class="line-number">2680</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2681</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2682</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2683</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2684</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2685</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2686</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2687</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2688</td><td class="line-text">  int1a_getdate:
</td></tr>
<tr><td class="line-number">2689</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2690</td><td class="line-text">	<span class="hljs-comment">; Return the system date in BCD format.</span>
</td></tr>
<tr><td class="line-number">2691</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2692</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2693</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2694</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2695</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2696</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2697</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2698</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">2699</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2700</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2701</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2702</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, timetable
</td></tr>
<tr><td class="line-number">2703</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2704</td><td class="line-text">	extended_get_rtc
</td></tr>
<tr><td class="line-number">2705</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2706</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x1900</span>
</td></tr>
<tr><td class="line-number">2707</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_year]
</td></tr>
<tr><td class="line-number">2708</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2709</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2710</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2711</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2712</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">2713</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_mon]
</td></tr>
<tr><td class="line-number">2714</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2715</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2716</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2717</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2718</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, [tm_mday]
</td></tr>
<tr><td class="line-number">2719</td><td class="line-text">	<span class="hljs-keyword">call</span>	hex_to_bcd
</td></tr>
<tr><td class="line-number">2720</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2721</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2722</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2723</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2724</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2725</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">2726</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">2727</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2728</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2729</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2730</td><td class="line-text">  int1a_init:
</td></tr>
<tr><td class="line-number">2731</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2732</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
</td></tr>
<tr><td class="line-number">2733</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2734</td><td class="line-text"><span class="hljs-comment">; ************************* INT 1Ch - the other timer interrupt</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2735</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2736</td><td class="line-text">int1c:
</td></tr>
<tr><td class="line-number">2737</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2738</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">2739</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2740</td><td class="line-text"><span class="hljs-comment">; ************************* INT 1Eh - diskette parameter table</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2741</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2742</td><td class="line-text">int1e:
</td></tr>
<tr><td class="line-number">2743</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2744</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0xdf</span> <span class="hljs-comment">; Step rate 2ms, head unload time 240ms</span>
</td></tr>
<tr><td class="line-number">2745</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x02</span> <span class="hljs-comment">; Head load time 4 ms, non-DMA mode 0</span>
</td></tr>
<tr><td class="line-number">2746</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x25</span> <span class="hljs-comment">; Byte delay until motor turned off</span>
</td></tr>
<tr><td class="line-number">2747</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x02</span> <span class="hljs-comment">; 512 bytes per sector</span>
</td></tr>
<tr><td class="line-number">2748</td><td class="line-text">int1e_spt	<span class="hljs-built_in">db</span> <span class="hljs-number">18</span>	<span class="hljs-comment">; 18 sectors per track (1.44MB)</span>
</td></tr>
<tr><td class="line-number">2749</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x1B</span> <span class="hljs-comment">; Gap between sectors for 3.5" floppy</span>
</td></tr>
<tr><td class="line-number">2750</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0xFF</span> <span class="hljs-comment">; Data length (ignored)</span>
</td></tr>
<tr><td class="line-number">2751</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x54</span> <span class="hljs-comment">; Gap length when formatting</span>
</td></tr>
<tr><td class="line-number">2752</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0xF6</span> <span class="hljs-comment">; Format filler byte</span>
</td></tr>
<tr><td class="line-number">2753</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x0F</span> <span class="hljs-comment">; Head settle time (1 ms)</span>
</td></tr>
<tr><td class="line-number">2754</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0x08</span> <span class="hljs-comment">; Motor start time in 1/8 seconds</span>
</td></tr>
<tr><td class="line-number">2755</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2756</td><td class="line-text"><span class="hljs-comment">; ************************* INT 41h - hard disk parameter table</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2757</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2758</td><td class="line-text">int41:
</td></tr>
<tr><td class="line-number">2759</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2760</td><td class="line-text">int41_max_cyls	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2761</td><td class="line-text">int41_max_heads	<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2762</td><td class="line-text">		<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2763</td><td class="line-text">		<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2764</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2765</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">11000000b</span>
</td></tr>
<tr><td class="line-number">2766</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2767</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2768</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2769</td><td class="line-text">		<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2770</td><td class="line-text">int41_max_sect	<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2771</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2772</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2773</td><td class="line-text"><span class="hljs-comment">; ************************* ROM configuration table</span>
</td></tr>
<tr><td class="line-number">2774</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2775</td><td class="line-text">rom_config	<span class="hljs-built_in">dw</span> <span class="hljs-number">16</span>		<span class="hljs-comment">; 16 bytes following</span>
</td></tr>
<tr><td class="line-number">2776</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0xfe</span>		<span class="hljs-comment">; Model</span>
</td></tr>
<tr><td class="line-number">2777</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-string">'A'</span>		<span class="hljs-comment">; Submodel</span>
</td></tr>
<tr><td class="line-number">2778</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-string">'C'</span>		<span class="hljs-comment">; BIOS revision</span>
</td></tr>
<tr><td class="line-number">2779</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0b00100000</span>   <span class="hljs-comment">; Feature 1</span>
</td></tr>
<tr><td class="line-number">2780</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0b00000000</span>   <span class="hljs-comment">; Feature 2</span>
</td></tr>
<tr><td class="line-number">2781</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0b00000000</span>   <span class="hljs-comment">; Feature 3</span>
</td></tr>
<tr><td class="line-number">2782</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0b00000000</span>   <span class="hljs-comment">; Feature 4</span>
</td></tr>
<tr><td class="line-number">2783</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0b00000000</span>   <span class="hljs-comment">; Feature 5</span>
</td></tr>
<tr><td class="line-number">2784</td><td class="line-text">		<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2785</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2786</td><td class="line-text"><span class="hljs-comment">; Internal state variables</span>
</td></tr>
<tr><td class="line-number">2787</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2788</td><td class="line-text">num_disks	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Number of disks present</span>
</td></tr>
<tr><td class="line-number">2789</td><td class="line-text">hd_secs_hi	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Total sectors on HD (high word)</span>
</td></tr>
<tr><td class="line-number">2790</td><td class="line-text">hd_secs_lo	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Total sectors on HD (low word)</span>
</td></tr>
<tr><td class="line-number">2791</td><td class="line-text">hd_max_sector	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Max sector number on HD</span>
</td></tr>
<tr><td class="line-number">2792</td><td class="line-text">hd_max_track	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Max track number on HD</span>
</td></tr>
<tr><td class="line-number">2793</td><td class="line-text">hd_max_head	<span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>	<span class="hljs-comment">; Max head number on HD</span>
</td></tr>
<tr><td class="line-number">2794</td><td class="line-text">drive_tracks_temp <span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2795</td><td class="line-text">drive_sectors_temp <span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2796</td><td class="line-text">drive_heads_temp  <span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2797</td><td class="line-text">drive_num_temp    <span class="hljs-built_in">dw</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2798</td><td class="line-text">boot_state	<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2799</td><td class="line-text">cga_refresh_reg	<span class="hljs-built_in">db</span> <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2800</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2801</td><td class="line-text"><span class="hljs-comment">; Default interrupt handlers</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2802</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2803</td><td class="line-text">int0:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2804</td><td class="line-text">int1:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2805</td><td class="line-text">int2:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2806</td><td class="line-text">int3:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2807</td><td class="line-text">int4:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2808</td><td class="line-text">int5:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2809</td><td class="line-text">int6:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2810</td><td class="line-text">intb:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2811</td><td class="line-text">intc:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2812</td><td class="line-text">intd:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2813</td><td class="line-text">inte:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2814</td><td class="line-text">intf:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2815</td><td class="line-text">int18:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2816</td><td class="line-text">int1b:
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2817</td><td class="line-text">int1d:
</td></tr>
<tr><td class="line-number">2818</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2819</td><td class="line-text"><span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">2820</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2821</td><td class="line-text"><span class="hljs-comment">; ************ Function call library ************</span>
</td></tr>
<tr><td class="line-number">2822</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2823</td><td class="line-text"><span class="hljs-comment">; Hex to BCD routine. Input is AX in hex (can be 0), and adds CX in hex to it, forming a BCD output in AX.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2824</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2825</td><td class="line-text">hex_to_bcd:
</td></tr>
<tr><td class="line-number">2826</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2827</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2828</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2829</td><td class="line-text">	<span class="hljs-keyword">jcxz</span>	h2bfin
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2830</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2831</td><td class="line-text">  h2bloop:
</td></tr>
<tr><td class="line-number">2832</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2833</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2834</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2835</td><td class="line-text">	<span class="hljs-comment">; First process the low nibble of AL</span>
</td></tr>
<tr><td class="line-number">2836</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2837</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x0f</span>
</td></tr>
<tr><td class="line-number">2838</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x0a</span>
</td></tr>
<tr><td class="line-number">2839</td><td class="line-text">	<span class="hljs-keyword">jne</span>	c1
</td></tr>
<tr><td class="line-number">2840</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0006</span>
</td></tr>
<tr><td class="line-number">2841</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2842</td><td class="line-text">	<span class="hljs-comment">; Then the high nibble of AL</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2843</td><td class="line-text">  c1:
</td></tr>
<tr><td class="line-number">2844</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">2845</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0xf0</span>
</td></tr>
<tr><td class="line-number">2846</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0xa0</span>
</td></tr>
<tr><td class="line-number">2847</td><td class="line-text">	<span class="hljs-keyword">jne</span>	c2
</td></tr>
<tr><td class="line-number">2848</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0060</span>
</td></tr>
<tr><td class="line-number">2849</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2850</td><td class="line-text">	<span class="hljs-comment">; Then the low nibble of AH</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2851</td><td class="line-text">  c2:	
</td></tr>
<tr><td class="line-number">2852</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">ah</span>
</td></tr>
<tr><td class="line-number">2853</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x0f</span>
</td></tr>
<tr><td class="line-number">2854</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">0x0a</span>
</td></tr>
<tr><td class="line-number">2855</td><td class="line-text">	<span class="hljs-keyword">jne</span>	c3
</td></tr>
<tr><td class="line-number">2856</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0600</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2857</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2858</td><td class="line-text">  c3:	
</td></tr>
<tr><td class="line-number">2859</td><td class="line-text">	<span class="hljs-keyword">loop</span>	h2bloop
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2860</td><td class="line-text">  h2bfin:
</td></tr>
<tr><td class="line-number">2861</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2862</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">2863</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2864</td><td class="line-text"><span class="hljs-comment">; Takes a number in AL (from 0 to 99), and outputs the value in decimal using extended_putchar_al.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2865</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2866</td><td class="line-text">puts_decimal_al:
</td></tr>
<tr><td class="line-number">2867</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2868</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2869</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">2870</td><td class="line-text">	<span class="hljs-keyword">aam</span>
</td></tr>
<tr><td class="line-number">2871</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x3030</span>	<span class="hljs-comment">; '00'</span>
</td></tr>
<tr><td class="line-number">2872</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">2873</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">0x30</span>
</td></tr>
<tr><td class="line-number">2874</td><td class="line-text">	<span class="hljs-keyword">je</span>	pda_2nd		<span class="hljs-comment">; First digit is zero, so print only 2nd digit</span>
</td></tr>
<tr><td class="line-number">2875</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2876</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-number">ah</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; First digit is now in AL</span>
</td></tr>
<tr><td class="line-number">2877</td><td class="line-text">	extended_putchar_al	<span class="hljs-comment">; Print first digit</span>
</td></tr>
<tr><td class="line-number">2878</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-number">ah</span>, <span class="hljs-built_in">al</span>		<span class="hljs-comment">; Second digit is now in AL</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2879</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2880</td><td class="line-text">  pda_2nd:
</td></tr>
<tr><td class="line-number">2881</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2882</td><td class="line-text">	extended_putchar_al	<span class="hljs-comment">; Print second digit</span>
</td></tr>
<tr><td class="line-number">2883</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2884</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2885</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">2886</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2887</td><td class="line-text"><span class="hljs-comment">; Keyboard adjust buffer head and tail. If either head or the tail are at the end of the buffer, reset them</span>
</td></tr>
<tr><td class="line-number">2888</td><td class="line-text"><span class="hljs-comment">; back to the start, since it is a circular buffer.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2889</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2890</td><td class="line-text">kb_adjust_buf:
</td></tr>
<tr><td class="line-number">2891</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2892</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2893</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2894</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2895</td><td class="line-text">	<span class="hljs-comment">; Check to see if the head is at the end of the buffer (or beyond). If so, bring it back</span>
</td></tr>
<tr><td class="line-number">2896</td><td class="line-text">	<span class="hljs-comment">; to the start</span>
</td></tr>
<tr><td class="line-number">2897</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2898</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">es</span>:kbbuf_end_ptr-bios_data]
</td></tr>
<tr><td class="line-number">2899</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	[<span class="hljs-built_in">es</span>:kbbuf_head-bios_data], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2900</td><td class="line-text">	<span class="hljs-keyword">jnge</span>	kb_adjust_tail
</td></tr>
<tr><td class="line-number">2901</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2902</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, [<span class="hljs-built_in">es</span>:kbbuf_start_ptr-bios_data]
</td></tr>
<tr><td class="line-number">2903</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:kbbuf_head-bios_data], <span class="hljs-built_in">bx</span>	
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2904</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2905</td><td class="line-text">  kb_adjust_tail:
</td></tr>
<tr><td class="line-number">2906</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2907</td><td class="line-text">	<span class="hljs-comment">; Check to see if the tail is at the end of the buffer (or beyond). If so, bring it back</span>
</td></tr>
<tr><td class="line-number">2908</td><td class="line-text">	<span class="hljs-comment">; to the start</span>
</td></tr>
<tr><td class="line-number">2909</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2910</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">es</span>:kbbuf_end_ptr-bios_data]
</td></tr>
<tr><td class="line-number">2911</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	[<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data], <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2912</td><td class="line-text">	<span class="hljs-keyword">jnge</span>	kb_adjust_done
</td></tr>
<tr><td class="line-number">2913</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2914</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, [<span class="hljs-built_in">es</span>:kbbuf_start_ptr-bios_data]
</td></tr>
<tr><td class="line-number">2915</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:kbbuf_tail-bios_data], <span class="hljs-built_in">bx</span>	
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2916</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2917</td><td class="line-text">  kb_adjust_done:
</td></tr>
<tr><td class="line-number">2918</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2919</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2920</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2921</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">2922</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2923</td><td class="line-text"><span class="hljs-comment">; Convert CHS disk position (in CH, CL and DH) to absolute sector number in BP:SI</span>
</td></tr>
<tr><td class="line-number">2924</td><td class="line-text"><span class="hljs-comment">; Floppy disks have 512 bytes per sector, 9/18 sectors per track, 2 heads. DH is head number (1 or 0), CH bits 5..0 is</span>
</td></tr>
<tr><td class="line-number">2925</td><td class="line-text"><span class="hljs-comment">; sector number, CL7..6 + CH7..0 is 10-bit cylinder/track number. Hard disks have 512 bytes per sector, but a variable</span>
</td></tr>
<tr><td class="line-number">2926</td><td class="line-text"><span class="hljs-comment">; number of tracks and heads.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2927</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2928</td><td class="line-text">chs_to_abs:
</td></tr>
<tr><td class="line-number">2929</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2930</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>	
</td></tr>
<tr><td class="line-number">2931</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2932</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2933</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2934</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2935</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:drive_num_temp], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">2936</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2937</td><td class="line-text">	<span class="hljs-comment">; First, we extract the track number from CH and CL.</span>
</td></tr>
<tr><td class="line-number">2938</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2939</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2940</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">2941</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-number">6</span>
</td></tr>
<tr><td class="line-number">2942</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-number">bh</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">2943</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">ch</span>
</td></tr>
<tr><td class="line-number">2944</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2945</td><td class="line-text">	<span class="hljs-comment">; Multiply track number (now in BX) by the number of heads</span>
</td></tr>
<tr><td class="line-number">2946</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2947</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:drive_num_temp], <span class="hljs-number">1</span> <span class="hljs-comment">; Floppy disk?</span>
</td></tr>
<tr><td class="line-number">2948</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2949</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2950</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2951</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2952</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2953</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2954</td><td class="line-text">	<span class="hljs-keyword">jne</span>	chs_hd
</td></tr>
<tr><td class="line-number">2955</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2956</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; Multiply by 2 (number of heads on FD)</span>
</td></tr>
<tr><td class="line-number">2957</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2958</td><td class="line-text">	<span class="hljs-keyword">xor</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2959</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">cs</span>:int1e_spt]
</td></tr>
<tr><td class="line-number">2960</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:drive_sectors_temp], <span class="hljs-built_in">ax</span> <span class="hljs-comment">; Retrieve sectors per track from INT 1E table</span>
</td></tr>
<tr><td class="line-number">2961</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2962</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2963</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	chs_continue
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2964</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2965</td><td class="line-text">chs_hd:
</td></tr>
<tr><td class="line-number">2966</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2967</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, [<span class="hljs-built_in">cs</span>:hd_max_head]
</td></tr>
<tr><td class="line-number">2968</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2969</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:drive_heads_temp], <span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">2970</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2971</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">cs</span>:drive_heads_temp] <span class="hljs-comment">; HD, so multiply by computed head count</span>
</td></tr>
<tr><td class="line-number">2972</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2973</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, [<span class="hljs-built_in">cs</span>:hd_max_sector] <span class="hljs-comment">; We previously calculated maximum HD track, so number of tracks is 1 more</span>
</td></tr>
<tr><td class="line-number">2974</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:drive_sectors_temp], <span class="hljs-built_in">bp</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">2975</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2976</td><td class="line-text">chs_continue:
</td></tr>
<tr><td class="line-number">2977</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2978</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2979</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2980</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2981</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2982</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-number">dh</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">2983</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2984</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">2985</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2986</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, [<span class="hljs-built_in">cs</span>:drive_sectors_temp]
</td></tr>
<tr><td class="line-number">2987</td><td class="line-text">	<span class="hljs-keyword">mul</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">2988</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2989</td><td class="line-text">	<span class="hljs-comment">; Now we extract the sector number (from 1 to 63) - for some reason they start from 1</span>
</td></tr>
<tr><td class="line-number">2990</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2991</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2992</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ch</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2993</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-number">0x3F</span>
</td></tr>
<tr><td class="line-number">2994</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">2995</td><td class="line-text">
</td></tr>
<tr><td class="line-number">2996</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">2997</td><td class="line-text">	<span class="hljs-keyword">adc</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">2998</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">2999</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3000</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3001</td><td class="line-text">	<span class="hljs-comment">; Now, SI:BP contains offset into disk image file (FD or HD)</span>
</td></tr>
<tr><td class="line-number">3002</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3003</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3004</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3005</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3006</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3007</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3008</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3009</td><td class="line-text"><span class="hljs-comment">; Clear screen using ANSI codes. Also clear video memory with attribute in BH</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3010</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3011</td><td class="line-text">clear_screen:
</td></tr>
<tr><td class="line-number">3012</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3013</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3014</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3015</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3016</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3017</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3018</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3019</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'r'</span>		<span class="hljs-comment">; Set scrolling window</span>
</td></tr>
<tr><td class="line-number">3020</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3021</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3022</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3023</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3024</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3025</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3026</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'0'</span>		<span class="hljs-comment">; Reset attributes</span>
</td></tr>
<tr><td class="line-number">3027</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3028</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Reset attributes</span>
</td></tr>
<tr><td class="line-number">3029</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3030</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3031</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3032</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3033</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">3034</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3035</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3036</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3037</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">bx</span>		<span class="hljs-comment">; Convert from CGA to ANSI</span>
</td></tr>
<tr><td class="line-number">3038</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cl</span>, <span class="hljs-number">12</span>
</td></tr>
<tr><td class="line-number">3039</td><td class="line-text">	<span class="hljs-keyword">ror</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">cl</span>
</td></tr>
<tr><td class="line-number">3040</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">3041</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:<span class="hljs-built_in">bp</span>+colour_table]
</td></tr>
<tr><td class="line-number">3042</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">3043</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3044</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3045</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3046</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3047</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3048</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Background colour</span>
</td></tr>
<tr><td class="line-number">3049</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3050</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">3051</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3052</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3053</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3054</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3055</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3056</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:crt_curpos_x-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3057</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:curpos_y-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3058</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:crt_curpos_y-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3059</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3060</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3061</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3062</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">3063</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3064</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3065</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3066</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3067</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3068</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3069</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3070</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'2'</span>		<span class="hljs-comment">; Clear screen</span>
</td></tr>
<tr><td class="line-number">3071</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3072</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'J'</span>
</td></tr>
<tr><td class="line-number">3073</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3074</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3075</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3076</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3077</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3078</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3079</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'1'</span>		<span class="hljs-comment">; Cursor row 1</span>
</td></tr>
<tr><td class="line-number">3080</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3081</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>
</td></tr>
<tr><td class="line-number">3082</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3083</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'1'</span>		<span class="hljs-comment">; Cursor column 1</span>
</td></tr>
<tr><td class="line-number">3084</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3085</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'H'</span>		<span class="hljs-comment">; Set cursor</span>
</td></tr>
<tr><td class="line-number">3086</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3087</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3088</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3089</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3090</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3091</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3092</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3093</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">3094</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3095</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3096</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3097</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">ah</span>, <span class="hljs-number">bh</span>
</td></tr>
<tr><td class="line-number">3098</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span>*<span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">3099</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">3100</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3101</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3102</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0xc800</span>
</td></tr>
<tr><td class="line-number">3103</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3104</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3105</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span>*<span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">3106</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">3107</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3108</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3109</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0xc000</span>
</td></tr>
<tr><td class="line-number">3110</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3111</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3112</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span>*<span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">3113</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">stosw</span>
</td></tr>
<tr><td class="line-number">3114</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3115</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3116</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3117</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3118</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3119</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3120</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3121</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3122</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3123</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3124</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3125</td><td class="line-text"><span class="hljs-comment">; Pushes a key press, followed by a key release, event to I/O port 0x60 and calls</span>
</td></tr>
<tr><td class="line-number">3126</td><td class="line-text"><span class="hljs-comment">; INT 9.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3127</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3128</td><td class="line-text">keypress_release:
</td></tr>
<tr><td class="line-number">3129</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3130</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3131</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3132</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:key_now_down-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3133</td><td class="line-text">	<span class="hljs-keyword">je</span>	kpr_no_prev_release
</td></tr>
<tr><td class="line-number">3134</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3135</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:key_now_down-bios_data]
</td></tr>
<tr><td class="line-number">3136</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x80</span>
</td></tr>
<tr><td class="line-number">3137</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">3138</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3139</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3140</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3141</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3142</td><td class="line-text">  kpr_no_prev_release:
</td></tr>
<tr><td class="line-number">3143</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3144</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">es</span>:key_now_down-bios_data], <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3145</td><td class="line-text">	<span class="hljs-keyword">call</span>	io_key_available
</td></tr>
<tr><td class="line-number">3146</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3147</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3148</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3149</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3150</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3151</td><td class="line-text"><span class="hljs-comment">; Sets key available flag on I/O port 0x64, outputs key scan code in AL to I/O port 0x60, and calls INT 9</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3152</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3153</td><td class="line-text">io_key_available:
</td></tr>
<tr><td class="line-number">3154</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3155</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3156</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3157</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-number">0x64</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3158</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ax</span>
</td></tr>
<tr><td class="line-number">3159</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3160</td><td class="line-text">	<span class="hljs-keyword">out</span>	<span class="hljs-number">0x60</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3161</td><td class="line-text">	<span class="hljs-keyword">int</span>	<span class="hljs-number">9</span>
</td></tr>
<tr><td class="line-number">3162</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3163</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3164</td><td class="line-text"><span class="hljs-comment">; Reaches up into the stack before the end of an interrupt handler, and sets the carry flag</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3165</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3166</td><td class="line-text">reach_stack_stc:
</td></tr>
<tr><td class="line-number">3167</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3168</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">sp</span>
</td></tr>
<tr><td class="line-number">3169</td><td class="line-text">	<span class="hljs-keyword">or</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">bp</span>+<span class="hljs-number">4</span>], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3170</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">sp</span>
</td></tr>
<tr><td class="line-number">3171</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">3172</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3173</td><td class="line-text"><span class="hljs-comment">; Reaches up into the stack before the end of an interrupt handler, and clears the carry flag</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3174</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3175</td><td class="line-text">reach_stack_clc:
</td></tr>
<tr><td class="line-number">3176</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3177</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">sp</span>
</td></tr>
<tr><td class="line-number">3178</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">word</span> [<span class="hljs-built_in">bp</span>+<span class="hljs-number">4</span>], <span class="hljs-number">0xfffe</span>
</td></tr>
<tr><td class="line-number">3179</td><td class="line-text">	<span class="hljs-keyword">xchg</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-built_in">sp</span>
</td></tr>
<tr><td class="line-number">3180</td><td class="line-text">	<span class="hljs-keyword">iret</span>
</td></tr>
<tr><td class="line-number">3181</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3182</td><td class="line-text"><span class="hljs-comment">; Reaches up into the stack before the end of an interrupt handler, and returns with the current</span>
</td></tr>
<tr><td class="line-number">3183</td><td class="line-text"><span class="hljs-comment">; setting of the carry flag</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3184</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3185</td><td class="line-text">reach_stack_carry:
</td></tr>
<tr><td class="line-number">3186</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3187</td><td class="line-text">	<span class="hljs-keyword">jc</span>	reach_stack_stc
</td></tr>
<tr><td class="line-number">3188</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	reach_stack_clc
</td></tr>
<tr><td class="line-number">3189</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3190</td><td class="line-text"><span class="hljs-comment">; This is the VMEM driver, to support direct video memory access in 80x25 colour CGA mode.</span>
</td></tr>
<tr><td class="line-number">3191</td><td class="line-text"><span class="hljs-comment">; It scans through CGA video memory at address B800:0, and if there is anything there (i.e.</span>
</td></tr>
<tr><td class="line-number">3192</td><td class="line-text"><span class="hljs-comment">; applications are doing direct video memory writes), converts the buffer to a sequence of</span>
</td></tr>
<tr><td class="line-number">3193</td><td class="line-text"><span class="hljs-comment">; ANSI terminal codes to render the screen output.</span>
</td></tr>
<tr><td class="line-number">3194</td><td class="line-text"><span class="hljs-comment">;</span>
</td></tr>
<tr><td class="line-number">3195</td><td class="line-text"><span class="hljs-comment">; <span class="hljs-doctag">Note:</span> this destroys all registers. It is the responsibility of the caller to save/restore</span>
</td></tr>
<tr><td class="line-number">3196</td><td class="line-text"><span class="hljs-comment">; them.</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3197</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3198</td><td class="line-text">vmem_driver_entry:
</td></tr>
<tr><td class="line-number">3199</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">3200</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:in_update], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3201</td><td class="line-text">	<span class="hljs-keyword">je</span>	just_finish		<span class="hljs-comment">; If we are already in the middle of an update, skip. Needed for re-entrancy</span>
</td></tr>
<tr><td class="line-number">3202</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3203</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:int8_ctr]
</td></tr>
<tr><td class="line-number">3204</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:int8_ctr], <span class="hljs-number">8</span>	<span class="hljs-comment">; Only do this once every 8 timer ticks</span>
</td></tr>
<tr><td class="line-number">3205</td><td class="line-text">	<span class="hljs-keyword">jne</span>	just_finish
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3206</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3207</td><td class="line-text">gmode_test:
</td></tr>
<tr><td class="line-number">3208</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3209</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:int8_ctr], <span class="hljs-number">0</span>	
</td></tr>
<tr><td class="line-number">3210</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dx</span>, <span class="hljs-number">0x3b8</span>		<span class="hljs-comment">; Do not update if in Hercules graphics mode</span>
</td></tr>
<tr><td class="line-number">3211</td><td class="line-text">	<span class="hljs-keyword">in</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3212</td><td class="line-text">	<span class="hljs-keyword">test</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">3213</td><td class="line-text">	<span class="hljs-keyword">jz</span>	vram_zero_check
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3214</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3215</td><td class="line-text">just_finish:
</td></tr>
<tr><td class="line-number">3216</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3217</td><td class="line-text">	<span class="hljs-keyword">ret</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3218</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3219</td><td class="line-text">vram_zero_check:			<span class="hljs-comment">; Check if video memory is blank - if so, do nothing</span>
</td></tr>
<tr><td class="line-number">3220</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">3221</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:in_update], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3222</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3223</td><td class="line-text">	<span class="hljs-keyword">sti</span>
</td></tr>
<tr><td class="line-number">3224</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3225</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3226</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3227</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3228</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, [vmem_offset-bios_data] <span class="hljs-comment">; Adjust for CRTC video memory offset register</span>
</td></tr>
<tr><td class="line-number">3229</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3230</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3231</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3232</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">3233</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3234</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0x7d0</span>
</td></tr>
<tr><td class="line-number">3235</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-number">0x0700</span>
</td></tr>
<tr><td class="line-number">3236</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3237</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3238</td><td class="line-text">	<span class="hljs-keyword">repz</span>	<span class="hljs-keyword">scasw</span>
</td></tr>
<tr><td class="line-number">3239</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3240</td><td class="line-text">	<span class="hljs-keyword">je</span>	vmem_done	<span class="hljs-comment">; Nothing has been written to video RAM - no need to update</span>
</td></tr>
<tr><td class="line-number">3241</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3242</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">1</span> <span class="hljs-comment">; Cleared screen so always need to update</span>
</td></tr>
<tr><td class="line-number">3243</td><td class="line-text">	<span class="hljs-keyword">je</span>	vram_update
</td></tr>
<tr><td class="line-number">3244</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3245</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xc800</span>
</td></tr>
<tr><td class="line-number">3246</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3247</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3248</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">0x7d0</span>
</td></tr>
<tr><td class="line-number">3249</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3250</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3251</td><td class="line-text">	<span class="hljs-keyword">repz</span>	<span class="hljs-keyword">cmpsw</span>
</td></tr>
<tr><td class="line-number">3252</td><td class="line-text">	<span class="hljs-keyword">jne</span>	vram_update		<span class="hljs-comment">; Video RAM is changed - need to update</span>
</td></tr>
<tr><td class="line-number">3253</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3254</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3255</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3256</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, [crt_curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">3257</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, [crt_curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">3258</td><td class="line-text">	
</td></tr>
<tr><td class="line-number">3259</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">bh</span>, [<span class="hljs-built_in">cs</span>:crt_curpos_y_last]
</td></tr>
<tr><td class="line-number">3260</td><td class="line-text">	<span class="hljs-keyword">jne</span>	restore_cursor <span class="hljs-comment">; Cursor position changed (but nothing else) so update just that</span>
</td></tr>
<tr><td class="line-number">3261</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, [<span class="hljs-built_in">cs</span>:crt_curpos_x_last]
</td></tr>
<tr><td class="line-number">3262</td><td class="line-text">	<span class="hljs-keyword">jne</span>	restore_cursor
</td></tr>
<tr><td class="line-number">3263</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3264</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	vmem_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3265</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3266</td><td class="line-text">vram_update:
</td></tr>
<tr><td class="line-number">3267</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3268</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3269</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3270</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3271</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">3272</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">3273</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3274</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [int_curpos_x], <span class="hljs-number">0xff</span>
</td></tr>
<tr><td class="line-number">3275</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [int_curpos_y], <span class="hljs-number">0xff</span>
</td></tr>
<tr><td class="line-number">3276</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3277</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:cursor_visible-bios_data], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3278</td><td class="line-text">	<span class="hljs-keyword">je</span>	dont_hide_cursor
</td></tr>
<tr><td class="line-number">3279</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3280</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_hide_cursor
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3281</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3282</td><td class="line-text">dont_hide_cursor:
</td></tr>
<tr><td class="line-number">3283</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3284</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [last_attrib], <span class="hljs-number">0xff</span>
</td></tr>
<tr><td class="line-number">3285</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3286</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3287</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3288</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3289</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">es</span>:vmem_offset-bios_data] <span class="hljs-comment">; Adjust for CRTC video memory offset register</span>
</td></tr>
<tr><td class="line-number">3290</td><td class="line-text">	<span class="hljs-keyword">shl</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3291</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">2</span>		<span class="hljs-comment">; Combined offset</span>
</td></tr>
<tr><td class="line-number">3292</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3293</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">3294</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3295</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3296</td><td class="line-text">	<span class="hljs-comment">; Set up the initial cursor coordinates. Since the first thing we do is increment the cursor</span>
</td></tr>
<tr><td class="line-number">3297</td><td class="line-text">	<span class="hljs-comment">; position, this initial position is actually off the screen</span>
</td></tr>
<tr><td class="line-number">3298</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3299</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bp</span>, -<span class="hljs-number">1</span>		<span class="hljs-comment">; Row number</span>
</td></tr>
<tr><td class="line-number">3300</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">79</span>		<span class="hljs-comment">; Column number</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3301</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3302</td><td class="line-text">disp_loop:
</td></tr>
<tr><td class="line-number">3303</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3304</td><td class="line-text">	<span class="hljs-comment">; Advance to next column</span>
</td></tr>
<tr><td class="line-number">3305</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3306</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">3307</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3308</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">80</span>
</td></tr>
<tr><td class="line-number">3309</td><td class="line-text">	<span class="hljs-keyword">jne</span>	cont
</td></tr>
<tr><td class="line-number">3310</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3311</td><td class="line-text">	<span class="hljs-comment">; Column is 80, so set to 0 and advance a line</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3312</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3313</td><td class="line-text">loop_next_line:
</td></tr>
<tr><td class="line-number">3314</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3315</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3316</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">3317</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3318</td><td class="line-text">	<span class="hljs-comment">; Bottom of the screen reached already? If so, we're done</span>
</td></tr>
<tr><td class="line-number">3319</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3320</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bp</span>, <span class="hljs-number">25</span>
</td></tr>
<tr><td class="line-number">3321</td><td class="line-text">	<span class="hljs-keyword">je</span>	restore_attrib
</td></tr>
<tr><td class="line-number">3322</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3323</td><td class="line-text">	<span class="hljs-comment">; See if this line has changed in video RAM</span>
</td></tr>
<tr><td class="line-number">3324</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3325</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3326</td><td class="line-text">	<span class="hljs-keyword">je</span>	cont
</td></tr>
<tr><td class="line-number">3327</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3328</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3329</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3330</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3331</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xb800</span>
</td></tr>
<tr><td class="line-number">3332</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3333</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0xc800</span>
</td></tr>
<tr><td class="line-number">3334</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3335</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3336</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3337</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3338</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3339</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3340</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">es</span>:vmem_offset-bios_data] <span class="hljs-comment">; Adjust for CRTC video memory offset register</span>
</td></tr>
<tr><td class="line-number">3341</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">es</span>:vmem_offset-bios_data]
</td></tr>
<tr><td class="line-number">3342</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3343</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3344</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span> <span class="hljs-comment">; One row's worth of characters</span>
</td></tr>
<tr><td class="line-number">3345</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3346</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3347</td><td class="line-text">	<span class="hljs-keyword">repz</span>	<span class="hljs-keyword">cmpsw</span>
</td></tr>
<tr><td class="line-number">3348</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3349</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3350</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3351</td><td class="line-text">	<span class="hljs-keyword">je</span>	vmem_next_line <span class="hljs-comment">; This line is unchanged in video RAM, so do not update</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3352</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3353</td><td class="line-text">vmem_copy_buf:
</td></tr>
<tr><td class="line-number">3354</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3355</td><td class="line-text">	<span class="hljs-comment">; Copy the changed line to our double buffer at C800:0</span>
</td></tr>
<tr><td class="line-number">3356</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3357</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3358</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3359</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3360</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3361</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3362</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3363</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">es</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3364</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3365</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">es</span>:vmem_offset-bios_data] <span class="hljs-comment">; Adjust for CRTC video memory offset register</span>
</td></tr>
<tr><td class="line-number">3366</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">di</span>, [<span class="hljs-built_in">es</span>:vmem_offset-bios_data]
</td></tr>
<tr><td class="line-number">3367</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>
</td></tr>
<tr><td class="line-number">3368</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3369</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">cx</span>, <span class="hljs-number">80</span> <span class="hljs-comment">; One row's worth of characters</span>
</td></tr>
<tr><td class="line-number">3370</td><td class="line-text">	<span class="hljs-keyword">cld</span>
</td></tr>
<tr><td class="line-number">3371</td><td class="line-text">	<span class="hljs-keyword">rep</span>	<span class="hljs-keyword">movsw</span>
</td></tr>
<tr><td class="line-number">3372</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3373</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">di</span>
</td></tr>
<tr><td class="line-number">3374</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3375</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3376</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3377</td><td class="line-text">	<span class="hljs-comment">; We want to start the update at the first character which differs - so calculate its position.</span>
</td></tr>
<tr><td class="line-number">3378</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3379</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">79</span>
</td></tr>
<tr><td class="line-number">3380</td><td class="line-text">	<span class="hljs-keyword">sub</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">cx</span>
</td></tr>
<tr><td class="line-number">3381</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3382</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3383</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">di</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3384</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">si</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3385</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3386</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">3387</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">es</span>	<span class="hljs-comment">; Set ES back to B800</span>
</td></tr>
<tr><td class="line-number">3388</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3389</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	cont
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3390</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3391</td><td class="line-text">vmem_next_line:
</td></tr>
<tr><td class="line-number">3392</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3393</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">di</span>, <span class="hljs-number">160</span>
</td></tr>
<tr><td class="line-number">3394</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	loop_next_line <span class="hljs-comment">; Line is unchanged in video RAM</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3395</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3396</td><td class="line-text">cont:
</td></tr>
<tr><td class="line-number">3397</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">cs</span>
</td></tr>
<tr><td class="line-number">3398</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">ds</span>
</td></tr>
<tr><td class="line-number">3399</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3400</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">di</span>], <span class="hljs-number">0</span>		<span class="hljs-comment">; Ignore null characters in video memory</span>
</td></tr>
<tr><td class="line-number">3401</td><td class="line-text">	<span class="hljs-keyword">je</span>	disp_loop
</td></tr>
<tr><td class="line-number">3402</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3403</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ax</span>, <span class="hljs-built_in">bp</span>
</td></tr>
<tr><td class="line-number">3404</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-built_in">si</span>
</td></tr>
<tr><td class="line-number">3405</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">dh</span>, <span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3406</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-built_in">bl</span>
</td></tr>
<tr><td class="line-number">3407</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3408</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">dh</span>, [int_curpos_y]	<span class="hljs-comment">; Same row as the last time?</span>
</td></tr>
<tr><td class="line-number">3409</td><td class="line-text">	<span class="hljs-keyword">jne</span>	ansi_set_cur_pos
</td></tr>
<tr><td class="line-number">3410</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3411</td><td class="line-text">	<span class="hljs-keyword">dec</span>	<span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3412</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, [int_curpos_x]	<span class="hljs-comment">; One column to the right since the last time?</span>
</td></tr>
<tr><td class="line-number">3413</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3414</td><td class="line-text">	<span class="hljs-keyword">je</span>	skip_set_cur_pos
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3415</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3416</td><td class="line-text">ansi_set_cur_pos:
</td></tr>
<tr><td class="line-number">3417</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3418</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3419</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3420</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3421</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3422</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">dh</span>		<span class="hljs-comment">; Row number</span>
</td></tr>
<tr><td class="line-number">3423</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3424</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3425</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3426</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3427</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>		<span class="hljs-comment">; Column number</span>
</td></tr>
<tr><td class="line-number">3428</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3429</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3430</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'H'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">3431</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3432</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3433</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[int_curpos_y], <span class="hljs-number">dh</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3434</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3435</td><td class="line-text">skip_set_cur_pos:
</td></tr>
<tr><td class="line-number">3436</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3437</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[int_curpos_x], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3438</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3439</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">dl</span>, [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">di</span>+<span class="hljs-number">1</span>]
</td></tr>
<tr><td class="line-number">3440</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">dl</span>, [last_attrib]
</td></tr>
<tr><td class="line-number">3441</td><td class="line-text">	<span class="hljs-keyword">je</span>	skip_attrib
</td></tr>
<tr><td class="line-number">3442</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3443</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[last_attrib], <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3444</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3445</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3446</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3447</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3448</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3449</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3450</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3451</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">8</span>		<span class="hljs-comment">; Bright attribute now in AL</span>
</td></tr>
<tr><td class="line-number">3452</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">3453</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">3454</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">3455</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3456</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3457</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>
</td></tr>
<tr><td class="line-number">3458</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3459</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3460</td><td class="line-text">	<span class="hljs-keyword">push</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3461</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3462</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; Foreground colour now in DL</span>
</td></tr>
<tr><td class="line-number">3463</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, colour_table
</td></tr>
<tr><td class="line-number">3464</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3465</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">3466</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3467</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3468</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>
</td></tr>
<tr><td class="line-number">3469</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3470</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3471</td><td class="line-text">	<span class="hljs-keyword">pop</span>	<span class="hljs-built_in">dx</span>
</td></tr>
<tr><td class="line-number">3472</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3473</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">186</span>
</td></tr>
<tr><td class="line-number">3474</td><td class="line-text">	<span class="hljs-keyword">shr</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">3475</td><td class="line-text">	<span class="hljs-meta">cpu</span>	<span class="hljs-number">8086</span>
</td></tr>
<tr><td class="line-number">3476</td><td class="line-text">	<span class="hljs-keyword">and</span>	<span class="hljs-built_in">dl</span>, <span class="hljs-number">7</span>		<span class="hljs-comment">; Background colour now in DL</span>
</td></tr>
<tr><td class="line-number">3477</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3478</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">dl</span>
</td></tr>
<tr><td class="line-number">3479</td><td class="line-text">	<span class="hljs-keyword">xlat</span>
</td></tr>
<tr><td class="line-number">3480</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3481</td><td class="line-text">	<span class="hljs-keyword">add</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">3482</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3483</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>		<span class="hljs-comment">; Set cursor attribute command</span>
</td></tr>
<tr><td class="line-number">3484</td><td class="line-text">	extended_putchar_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3485</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3486</td><td class="line-text">skip_attrib:
</td></tr>
<tr><td class="line-number">3487</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3488</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, [<span class="hljs-built_in">es</span>:<span class="hljs-built_in">di</span>]
</td></tr>
<tr><td class="line-number">3489</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3490</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">32</span>		<span class="hljs-comment">; Non-printable ASCII? (&lt; 32 decimal)</span>
</td></tr>
<tr><td class="line-number">3491</td><td class="line-text">	<span class="hljs-keyword">jae</span>	just_show_it
</td></tr>
<tr><td class="line-number">3492</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3493</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, low_ascii_conv
</td></tr>
<tr><td class="line-number">3494</td><td class="line-text">	<span class="hljs-built_in">cs</span>	<span class="hljs-keyword">xlat</span>		<span class="hljs-comment">; Convert to printable representation (mostly spaces)</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3495</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3496</td><td class="line-text">just_show_it:
</td></tr>
<tr><td class="line-number">3497</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3498</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3499</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3500</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	disp_loop
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3501</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3502</td><td class="line-text">restore_attrib:
</td></tr>
<tr><td class="line-number">3503</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3504</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; Escape</span>
</td></tr>
<tr><td class="line-number">3505</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3506</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3507</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3508</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'0'</span>		<span class="hljs-comment">; Reset attributes</span>
</td></tr>
<tr><td class="line-number">3509</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3510</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'m'</span>
</td></tr>
<tr><td class="line-number">3511</td><td class="line-text">	extended_putchar_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3512</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3513</td><td class="line-text">restore_cursor:
</td></tr>
<tr><td class="line-number">3514</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3515</td><td class="line-text">	<span class="hljs-comment">; On a real PC, the 6845 CRT cursor position registers take place over the BIOS</span>
</td></tr>
<tr><td class="line-number">3516</td><td class="line-text">	<span class="hljs-comment">; Data Area ones. So, if the cursor is not off the screen, set it to the CRT</span>
</td></tr>
<tr><td class="line-number">3517</td><td class="line-text">	<span class="hljs-comment">; position.</span>
</td></tr>
<tr><td class="line-number">3518</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3519</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bx</span>, <span class="hljs-number">0x40</span>
</td></tr>
<tr><td class="line-number">3520</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">ds</span>, <span class="hljs-built_in">bx</span>
</td></tr>
<tr><td class="line-number">3521</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3522</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-number">bh</span>, [crt_curpos_y-bios_data]
</td></tr>
<tr><td class="line-number">3523</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">bl</span>, [crt_curpos_x-bios_data]
</td></tr>
<tr><td class="line-number">3524</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:crt_curpos_y_last], <span class="hljs-number">bh</span>
</td></tr>
<tr><td class="line-number">3525</td><td class="line-text">	<span class="hljs-keyword">mov</span>	[<span class="hljs-built_in">cs</span>:crt_curpos_x_last], <span class="hljs-built_in">bl</span>
</td></tr>
<tr><td class="line-number">3526</td><td class="line-text">		
</td></tr>
<tr><td class="line-number">3527</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-number">bh</span>, <span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">3528</td><td class="line-text">	<span class="hljs-keyword">ja</span>	vmem_end_hidden_cursor
</td></tr>
<tr><td class="line-number">3529</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">bl</span>, <span class="hljs-number">79</span>
</td></tr>
<tr><td class="line-number">3530</td><td class="line-text">	<span class="hljs-keyword">ja</span>	vmem_end_hidden_cursor
</td></tr>
<tr><td class="line-number">3531</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3532</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>	<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3533</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3534</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3535</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3536</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">bh</span>		<span class="hljs-comment">; Row number</span>
</td></tr>
<tr><td class="line-number">3537</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3538</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3539</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">';'</span>		<span class="hljs-comment">; ANSI</span>
</td></tr>
<tr><td class="line-number">3540</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3541</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>		<span class="hljs-comment">; Column number</span>
</td></tr>
<tr><td class="line-number">3542</td><td class="line-text">	<span class="hljs-keyword">inc</span>	<span class="hljs-built_in">al</span>
</td></tr>
<tr><td class="line-number">3543</td><td class="line-text">	<span class="hljs-keyword">call</span>	puts_decimal_al
</td></tr>
<tr><td class="line-number">3544</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'H'</span>		<span class="hljs-comment">; Set cursor position command</span>
</td></tr>
<tr><td class="line-number">3545</td><td class="line-text">	extended_putchar_al
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3546</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3547</td><td class="line-text">restore_cursor_visible:
</td></tr>
<tr><td class="line-number">3548</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3549</td><td class="line-text">	<span class="hljs-keyword">cmp</span>	<span class="hljs-built_in">byte</span> [cursor_visible-bios_data], <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3550</td><td class="line-text">	<span class="hljs-keyword">jne</span>	vmem_end_hidden_cursor
</td></tr>
<tr><td class="line-number">3551</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3552</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_show_cursor
</td></tr>
<tr><td class="line-number">3553</td><td class="line-text">	<span class="hljs-keyword">jmp</span>	vmem_done
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3554</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3555</td><td class="line-text">vmem_end_hidden_cursor:
</td></tr>
<tr><td class="line-number">3556</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3557</td><td class="line-text">	<span class="hljs-keyword">call</span>	ansi_hide_cursor
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3558</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3559</td><td class="line-text">vmem_done:
</td></tr>
<tr><td class="line-number">3560</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3561</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:vram_dirty], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3562</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">byte</span> [<span class="hljs-built_in">cs</span>:in_update], <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3563</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3564</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3565</td><td class="line-text"><span class="hljs-comment">; Show cursor using ANSI codes</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3566</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3567</td><td class="line-text">ansi_show_cursor:
</td></tr>
<tr><td class="line-number">3568</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3569</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>
</td></tr>
<tr><td class="line-number">3570</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3571</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>
</td></tr>
<tr><td class="line-number">3572</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3573</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'?'</span>
</td></tr>
<tr><td class="line-number">3574</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3575</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'2'</span>
</td></tr>
<tr><td class="line-number">3576</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3577</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'5'</span>
</td></tr>
<tr><td class="line-number">3578</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3579</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'h'</span>
</td></tr>
<tr><td class="line-number">3580</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3581</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3582</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3583</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3584</td><td class="line-text"><span class="hljs-comment">; Hide cursor using ANSI codes</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3585</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3586</td><td class="line-text">ansi_hide_cursor:
</td></tr>
<tr><td class="line-number">3587</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3588</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-number">0x1B</span>
</td></tr>
<tr><td class="line-number">3589</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3590</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'['</span>
</td></tr>
<tr><td class="line-number">3591</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3592</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'?'</span>
</td></tr>
<tr><td class="line-number">3593</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3594</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'2'</span>
</td></tr>
<tr><td class="line-number">3595</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3596</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'5'</span>
</td></tr>
<tr><td class="line-number">3597</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3598</td><td class="line-text">	<span class="hljs-keyword">mov</span>	<span class="hljs-built_in">al</span>, <span class="hljs-string">'l'</span>
</td></tr>
<tr><td class="line-number">3599</td><td class="line-text">	extended_putchar_al
</td></tr>
<tr><td class="line-number">3600</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3601</td><td class="line-text">	<span class="hljs-keyword">ret</span>
</td></tr>
<tr><td class="line-number">3602</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3603</td><td class="line-text"><span class="hljs-comment">; ****************************************************************************************</span>
</td></tr>
<tr><td class="line-number">3604</td><td class="line-text"><span class="hljs-comment">; That's it for the code. Now, the data tables follow.</span>
</td></tr>
<tr><td class="line-number">3605</td><td class="line-text"><span class="hljs-comment">; ****************************************************************************************</span>
</td></tr>
<tr><td class="line-number">3606</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3607</td><td class="line-text"><span class="hljs-comment">; Standard PC-compatible BIOS data area - to copy to 40:0</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3608</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3609</td><td class="line-text">bios_data:
</td></tr>
<tr><td class="line-number">3610</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3611</td><td class="line-text">com1addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3612</td><td class="line-text">com2addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3613</td><td class="line-text">com3addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3614</td><td class="line-text">com4addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3615</td><td class="line-text">lpt1addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3616</td><td class="line-text">lpt2addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3617</td><td class="line-text">lpt3addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3618</td><td class="line-text">lpt4addr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3619</td><td class="line-text">equip		<span class="hljs-built_in">dw</span>	<span class="hljs-number">0b0000000000100001</span>
</td></tr>
<tr><td class="line-number">3620</td><td class="line-text"><span class="hljs-comment">;equip		dw	0b0000000100100001</span>
</td></tr>
<tr><td class="line-number">3621</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3622</td><td class="line-text">memsize		<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x280</span>
</td></tr>
<tr><td class="line-number">3623</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3624</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3625</td><td class="line-text">keyflags1	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3626</td><td class="line-text">keyflags2	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3627</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3628</td><td class="line-text">kbbuf_head	<span class="hljs-built_in">dw</span>	kbbuf-bios_data
</td></tr>
<tr><td class="line-number">3629</td><td class="line-text">kbbuf_tail	<span class="hljs-built_in">dw</span>	kbbuf-bios_data
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3630</td><td class="line-text">kbbuf: <span class="hljs-built_in">times</span> <span class="hljs-number">32</span>	<span class="hljs-built_in">db</span>	<span class="hljs-string">'X'</span>
</td></tr>
<tr><td class="line-number">3631</td><td class="line-text">drivecal	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3632</td><td class="line-text">diskmotor	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3633</td><td class="line-text">motorshutoff	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x07</span>
</td></tr>
<tr><td class="line-number">3634</td><td class="line-text">disk_laststatus	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3635</td><td class="line-text"><span class="hljs-built_in">times</span> <span class="hljs-number">7</span>		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3636</td><td class="line-text">vidmode		<span class="hljs-built_in">db</span>	<span class="hljs-number">0x03</span>
</td></tr>
<tr><td class="line-number">3637</td><td class="line-text">vid_cols	<span class="hljs-built_in">dw</span>	<span class="hljs-number">80</span>
</td></tr>
<tr><td class="line-number">3638</td><td class="line-text">page_size	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x1000</span>
</td></tr>
<tr><td class="line-number">3639</td><td class="line-text">		<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3640</td><td class="line-text">curpos_x	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3641</td><td class="line-text">curpos_y	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3642</td><td class="line-text"><span class="hljs-built_in">times</span> <span class="hljs-number">7</span>		<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3643</td><td class="line-text">cur_v_end	<span class="hljs-built_in">db</span>	<span class="hljs-number">7</span>
</td></tr>
<tr><td class="line-number">3644</td><td class="line-text">cur_v_start	<span class="hljs-built_in">db</span>	<span class="hljs-number">6</span>
</td></tr>
<tr><td class="line-number">3645</td><td class="line-text">disp_page	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3646</td><td class="line-text">crtport		<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x3d4</span>
</td></tr>
<tr><td class="line-number">3647</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">10</span>
</td></tr>
<tr><td class="line-number">3648</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3649</td><td class="line-text"><span class="hljs-built_in">times</span> <span class="hljs-number">5</span>		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3650</td><td class="line-text">clk_dtimer	<span class="hljs-built_in">dd</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3651</td><td class="line-text">clk_rollover	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3652</td><td class="line-text">ctrl_break	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3653</td><td class="line-text">soft_rst_flg	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x1234</span>
</td></tr>
<tr><td class="line-number">3654</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3655</td><td class="line-text">num_hd		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3656</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3657</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3658</td><td class="line-text">		<span class="hljs-built_in">dd</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3659</td><td class="line-text">		<span class="hljs-built_in">dd</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3660</td><td class="line-text">kbbuf_start_ptr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x001e</span>
</td></tr>
<tr><td class="line-number">3661</td><td class="line-text">kbbuf_end_ptr	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0x003e</span>
</td></tr>
<tr><td class="line-number">3662</td><td class="line-text">vid_rows	<span class="hljs-built_in">db</span>	<span class="hljs-number">25</span>         <span class="hljs-comment">; at 40:84</span>
</td></tr>
<tr><td class="line-number">3663</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3664</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3665</td><td class="line-text">vidmode_opt	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span> <span class="hljs-comment">; 0x70</span>
</td></tr>
<tr><td class="line-number">3666</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span> <span class="hljs-comment">; 0x89</span>
</td></tr>
<tr><td class="line-number">3667</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span> <span class="hljs-comment">; 0x51</span>
</td></tr>
<tr><td class="line-number">3668</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span> <span class="hljs-comment">; 0x0c</span>
</td></tr>
<tr><td class="line-number">3669</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3670</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3671</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3672</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3673</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3674</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3675</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3676</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3677</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3678</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3679</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3680</td><td class="line-text">kb_mode		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3681</td><td class="line-text">kb_led		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3682</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3683</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3684</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3685</td><td class="line-text">		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3686</td><td class="line-text">boot_device	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3687</td><td class="line-text">crt_curpos_x	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3688</td><td class="line-text">crt_curpos_y	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3689</td><td class="line-text">key_now_down	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3690</td><td class="line-text">next_key_fn	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3691</td><td class="line-text">cursor_visible	<span class="hljs-built_in">db</span>	<span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3692</td><td class="line-text">escape_flag_last	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3693</td><td class="line-text">next_key_alt	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3694</td><td class="line-text">escape_flag	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3695</td><td class="line-text">notranslate_flg	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3696</td><td class="line-text">this_keystroke	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3697</td><td class="line-text">this_keystroke_ext		<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3698</td><td class="line-text">timer0_freq	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0xffff</span> <span class="hljs-comment">; PIT channel 0 (55ms)</span>
</td></tr>
<tr><td class="line-number">3699</td><td class="line-text">timer2_freq	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>      <span class="hljs-comment">; PIT channel 2</span>
</td></tr>
<tr><td class="line-number">3700</td><td class="line-text">cga_vmode	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3701</td><td class="line-text">vmem_offset	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>      <span class="hljs-comment">; Video RAM offset</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3702</td><td class="line-text">ending:		<span class="hljs-built_in">times</span> (<span class="hljs-number">0xff</span>-($-com1addr)) <span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3703</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3704</td><td class="line-text"><span class="hljs-comment">; Keyboard scan code tables</span>
</td></tr>
<tr><td class="line-number">3705</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3706</td><td class="line-text">a2scan_tbl      <span class="hljs-built_in">db</span>	<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x0E</span>
</td></tr>
<tr><td class="line-number">3707</td><td class="line-text">a2shift_tbl     <span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3708</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3709</td><td class="line-text"><span class="hljs-comment">; Interrupt vector table - to copy to 0:0</span>
</td></tr>
<tr><td class="line-number">3710</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3711</td><td class="line-text">int_table	<span class="hljs-built_in">dw</span> int0
</td></tr>
<tr><td class="line-number">3712</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3713</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-keyword">int1</span>
</td></tr>
<tr><td class="line-number">3714</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3715</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int2
</td></tr>
<tr><td class="line-number">3716</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3717</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-keyword">int3</span>
</td></tr>
<tr><td class="line-number">3718</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3719</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int4
</td></tr>
<tr><td class="line-number">3720</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3721</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int5
</td></tr>
<tr><td class="line-number">3722</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3723</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int6
</td></tr>
<tr><td class="line-number">3724</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3725</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int7
</td></tr>
<tr><td class="line-number">3726</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3727</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int8
</td></tr>
<tr><td class="line-number">3728</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3729</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int9
</td></tr>
<tr><td class="line-number">3730</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3731</td><td class="line-text">          	<span class="hljs-built_in">dw</span> inta
</td></tr>
<tr><td class="line-number">3732</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3733</td><td class="line-text">          	<span class="hljs-built_in">dw</span> intb
</td></tr>
<tr><td class="line-number">3734</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3735</td><td class="line-text">          	<span class="hljs-built_in">dw</span> intc
</td></tr>
<tr><td class="line-number">3736</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3737</td><td class="line-text">          	<span class="hljs-built_in">dw</span> intd
</td></tr>
<tr><td class="line-number">3738</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3739</td><td class="line-text">          	<span class="hljs-built_in">dw</span> inte
</td></tr>
<tr><td class="line-number">3740</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3741</td><td class="line-text">          	<span class="hljs-built_in">dw</span> intf
</td></tr>
<tr><td class="line-number">3742</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3743</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int10
</td></tr>
<tr><td class="line-number">3744</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3745</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int11
</td></tr>
<tr><td class="line-number">3746</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3747</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int12
</td></tr>
<tr><td class="line-number">3748</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3749</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int13
</td></tr>
<tr><td class="line-number">3750</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3751</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int14
</td></tr>
<tr><td class="line-number">3752</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3753</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int15
</td></tr>
<tr><td class="line-number">3754</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3755</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int16
</td></tr>
<tr><td class="line-number">3756</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3757</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int17
</td></tr>
<tr><td class="line-number">3758</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3759</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int18
</td></tr>
<tr><td class="line-number">3760</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3761</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int19
</td></tr>
<tr><td class="line-number">3762</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3763</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int1a
</td></tr>
<tr><td class="line-number">3764</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3765</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int1b
</td></tr>
<tr><td class="line-number">3766</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3767</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int1c
</td></tr>
<tr><td class="line-number">3768</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3769</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int1d
</td></tr>
<tr><td class="line-number">3770</td><td class="line-text">          	<span class="hljs-built_in">dw</span> <span class="hljs-number">0xf000</span>
</td></tr>
<tr><td class="line-number">3771</td><td class="line-text">          	<span class="hljs-built_in">dw</span> int1e
</td></tr>
<tr><td class="line-number">3772</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3773</td><td class="line-text">itbl_size	<span class="hljs-built_in">dw</span> $-int_table
</td></tr>
<tr><td class="line-number">3774</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3775</td><td class="line-text"><span class="hljs-comment">; Conversion from CGA video memory colours to ANSI colours</span>
</td></tr>
<tr><td class="line-number">3776</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3777</td><td class="line-text">colour_table	<span class="hljs-built_in">db</span>	<span class="hljs-number">30</span>, <span class="hljs-number">34</span>, <span class="hljs-number">32</span>, <span class="hljs-number">36</span>, <span class="hljs-number">31</span>, <span class="hljs-number">35</span>, <span class="hljs-number">33</span>, <span class="hljs-number">37</span>
</td></tr>
<tr><td class="line-number">3778</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3779</td><td class="line-text"><span class="hljs-comment">; Conversion from non-printable low ASCII to printable</span>
</td></tr>
<tr><td class="line-number">3780</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3781</td><td class="line-text">low_ascii_conv	<span class="hljs-built_in">db</span>	<span class="hljs-string">' '</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-number">250</span>, <span class="hljs-string">'&gt;&lt;|!|$'</span>, <span class="hljs-number">250</span>, <span class="hljs-string">'|^v&gt;&lt;--^v'</span>
</td></tr>
<tr><td class="line-number">3782</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3783</td><td class="line-text"><span class="hljs-comment">; Conversion from UNIX cursor keys/SDL keycodes to scancodes</span>
</td></tr>
<tr><td class="line-number">3784</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3785</td><td class="line-text">unix_cursor_xlt	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x48</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x4b</span>
</td></tr>
<tr><td class="line-number">3786</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3787</td><td class="line-text"><span class="hljs-comment">; Conversion from SDL keycodes to Home/End/PgUp/PgDn scancodes</span>
</td></tr>
<tr><td class="line-number">3788</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3789</td><td class="line-text">pgup_pgdn_xlt	<span class="hljs-built_in">db</span>	<span class="hljs-number">0x47</span>, <span class="hljs-number">0x4f</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x51</span>
</td></tr>
<tr><td class="line-number">3790</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3791</td><td class="line-text"><span class="hljs-comment">; Internal variables for VMEM driver</span>
</td></tr>
<tr><td class="line-number">3792</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3793</td><td class="line-text">int8_ctr	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3794</td><td class="line-text">in_update	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3795</td><td class="line-text">vram_dirty	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3796</td><td class="line-text">last_attrib	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3797</td><td class="line-text">int_curpos_x	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3798</td><td class="line-text">int_curpos_y	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3799</td><td class="line-text">crt_curpos_x_last	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3800</td><td class="line-text">crt_curpos_y_last	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3801</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3802</td><td class="line-text"><span class="hljs-comment">; INT 8 millisecond counter</span>
</td></tr>
<tr><td class="line-number">3803</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3804</td><td class="line-text">last_int8_msec	<span class="hljs-built_in">dw</span>	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3805</td><td class="line-text">last_key_sdl	<span class="hljs-built_in">db</span> 	<span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3806</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3807</td><td class="line-text"><span class="hljs-comment">; Now follow the tables for instruction decode helping</span>
</td></tr>
<tr><td class="line-number">3808</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3809</td><td class="line-text"><span class="hljs-comment">; R/M mode tables</span>
</td></tr>
<tr><td class="line-number">3810</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3811</td><td class="line-text">rm_mode0_reg1	<span class="hljs-built_in">db</span>	<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">3812</td><td class="line-text">rm_mode012_reg2	<span class="hljs-built_in">db</span>	<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>
</td></tr>
<tr><td class="line-number">3813</td><td class="line-text">rm_mode0_disp	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3814</td><td class="line-text">rm_mode0_dfseg	<span class="hljs-built_in">db</span>	<span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>
</td></tr>
<tr><td class="line-number">3815</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3816</td><td class="line-text">rm_mode12_reg1	<span class="hljs-built_in">db</span>	<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>
</td></tr>
<tr><td class="line-number">3817</td><td class="line-text">rm_mode12_disp	<span class="hljs-built_in">db</span>	<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3818</td><td class="line-text">rm_mode12_dfseg	<span class="hljs-built_in">db</span>	<span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>
</td></tr>
<tr><td class="line-number">3819</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3820</td><td class="line-text"><span class="hljs-comment">; Opcode decode tables</span>
</td></tr>
<tr><td class="line-number">3821</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3822</td><td class="line-text">xlat_ids	<span class="hljs-built_in">db</span>	<span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">25</span>, <span class="hljs-number">26</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">25</span>, <span class="hljs-number">48</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">25</span>, <span class="hljs-number">26</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">25</span>, <span class="hljs-number">26</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">27</span>, <span class="hljs-number">28</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">27</span>, <span class="hljs-number">28</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">27</span>, <span class="hljs-number">29</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">27</span>, <span class="hljs-number">29</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">51</span>, <span class="hljs-number">54</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">55</span>, <span class="hljs-number">55</span>, <span class="hljs-number">55</span>, <span class="hljs-number">55</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">52</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">24</span>, <span class="hljs-number">24</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">30</span>, <span class="hljs-number">31</span>, <span class="hljs-number">32</span>, <span class="hljs-number">53</span>, <span class="hljs-number">33</span>, <span class="hljs-number">34</span>, <span class="hljs-number">35</span>, <span class="hljs-number">36</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">17</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">18</span>, <span class="hljs-number">47</span>, <span class="hljs-number">47</span>, <span class="hljs-number">17</span>, <span class="hljs-number">17</span>, <span class="hljs-number">17</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">19</span>, <span class="hljs-number">19</span>, <span class="hljs-number">37</span>, <span class="hljs-number">37</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">49</span>, <span class="hljs-number">50</span>, <span class="hljs-number">19</span>, <span class="hljs-number">19</span>, <span class="hljs-number">38</span>, <span class="hljs-number">39</span>, <span class="hljs-number">40</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">41</span>, <span class="hljs-number">42</span>, <span class="hljs-number">43</span>, <span class="hljs-number">44</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">53</span>, <span class="hljs-number">13</span>, <span class="hljs-number">13</span>, <span class="hljs-number">13</span>, <span class="hljs-number">13</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">22</span>, <span class="hljs-number">14</span>, <span class="hljs-number">14</span>, <span class="hljs-number">14</span>, <span class="hljs-number">14</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">22</span>, <span class="hljs-number">53</span>, <span class="hljs-number">0</span>, <span class="hljs-number">23</span>, <span class="hljs-number">23</span>, <span class="hljs-number">53</span>, <span class="hljs-number">45</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">46</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>
</td></tr>
<tr><td class="line-number">3823</td><td class="line-text">ex_data  	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">36</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">22</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">48</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">40</span>, <span class="hljs-number">11</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">43</span>, <span class="hljs-number">43</span>, <span class="hljs-number">43</span>, <span class="hljs-number">43</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">40</span>, <span class="hljs-number">21</span>, <span class="hljs-number">21</span>, <span class="hljs-number">80</span>, <span class="hljs-number">81</span>, <span class="hljs-number">92</span>, <span class="hljs-number">93</span>, <span class="hljs-number">94</span>, <span class="hljs-number">95</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3824</td><td class="line-text">std_flags	<span class="hljs-built_in">db</span>	<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3825</td><td class="line-text">base_size	<span class="hljs-built_in">db</span>	<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>
</td></tr>
<tr><td class="line-number">3826</td><td class="line-text">i_w_adder	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
</td></tr>
<tr><td class="line-number">3827</td><td class="line-text">i_mod_adder	<span class="hljs-built_in">db</span>	<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3828</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3829</td><td class="line-text">flags_mult	<span class="hljs-built_in">db</span>	<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>
</td></tr>
<tr><td class="line-number">3830</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3831</td><td class="line-text">jxx_dec_a	<span class="hljs-built_in">db</span>	<span class="hljs-number">48</span>, <span class="hljs-number">40</span>, <span class="hljs-number">43</span>, <span class="hljs-number">40</span>, <span class="hljs-number">44</span>, <span class="hljs-number">41</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>
</td></tr>
<tr><td class="line-number">3832</td><td class="line-text">jxx_dec_b	<span class="hljs-built_in">db</span>	<span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">43</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">43</span>
</td></tr>
<tr><td class="line-number">3833</td><td class="line-text">jxx_dec_c	<span class="hljs-built_in">db</span>	<span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">44</span>, <span class="hljs-number">44</span>
</td></tr>
<tr><td class="line-number">3834</td><td class="line-text">jxx_dec_d	<span class="hljs-built_in">db</span>	<span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">49</span>, <span class="hljs-number">48</span>, <span class="hljs-number">48</span>
</td></tr>
<tr><td class="line-number">3835</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3836</td><td class="line-text">parity		<span class="hljs-built_in">db</span>	<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>
</td></tr>
<tr><td class="line-number">3837</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3838</td><td class="line-text"><span class="hljs-comment">; This is the format of the 36-byte tm structure, returned by the emulator's RTC query call</span>
<span class="hljs-symbol"></span></td></tr>
<tr><td class="line-number">3839</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3840</td><td class="line-text">timetable:
</td></tr>
<tr><td class="line-number">3841</td><td class="line-text">
</td></tr>
<tr><td class="line-number">3842</td><td class="line-text">tm_sec		<span class="hljs-built_in">equ</span> $
</td></tr>
<tr><td class="line-number">3843</td><td class="line-text">tm_min		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">4</span>
</td></tr>
<tr><td class="line-number">3844</td><td class="line-text">tm_hour		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">8</span>
</td></tr>
<tr><td class="line-number">3845</td><td class="line-text">tm_mday		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">12</span>
</td></tr>
<tr><td class="line-number">3846</td><td class="line-text">tm_mon		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">16</span>
</td></tr>
<tr><td class="line-number">3847</td><td class="line-text">tm_year		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">20</span>
</td></tr>
<tr><td class="line-number">3848</td><td class="line-text">tm_wday		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">24</span>
</td></tr>
<tr><td class="line-number">3849</td><td class="line-text">tm_yday		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">28</span>
</td></tr>
<tr><td class="line-number">3850</td><td class="line-text">tm_dst		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">32</span>
</td></tr>
<tr><td class="line-number">3851</td><td class="line-text">tm_msec		<span class="hljs-built_in">equ</span> $+<span class="hljs-number">36</span></td></tr></tbody></table></body></html>
