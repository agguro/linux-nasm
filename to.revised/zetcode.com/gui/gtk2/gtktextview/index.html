<!DOCTYPE html> 
<html lang="en">
<head>
<title>GtkTextView widget</title>
<link rel="stylesheet" href="/cfg/style.css" type="text/css">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="GUI, GtkTextView widget, GTK+ library, C">
<meta name="description" content="This part of the GTK+ tutorial, presents the GtkTextView widget.
We apply text tags to the textual data, count number of lines and columns, and search for text.">
<meta name="author" content="Jan Bodnar">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5536206-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body>

<header>

<div>
<a href="/" title="Home">ZetCode</a>
</div>

<nav>
    <a title="All tutorials" href="/all/">All</a>
    <a title="Spring Boot tutorials" href="/all/#springboot">Spring Boot</a>
    <a title="Python tutorials" href="/all/#python">Python</a>
    <a title="C# tutorials" href="/all/#csharp">C#</a>
    <a title="Java tutorials" href="/all/#java">Java</a>
    <a title="JavaScript tutorials" href="/all/#js">JavaScript</a>
    <a title="Subscribe to ZetCode news" href="http://zetcode.us13.list-manage.com/subscribe?u=9def9ccd4c70dbbaf691f90fc&id=6556210f80">Subscribe</a>
</nav>

</header>

<div class="container">

<div class="ltow">
    
<div id="ebooks">

<h2 class="blu">Ebooks</h2>

<ul>
<li><a href="/ebooks/advancedpyqt5/">PyQt5 ebook</a></li>
<li><a href="/ebooks/tkinter/">Tkinter ebook</a></li>
<li><a href="/ebooks/sqlitepython/">SQLite Python</a></li>
<li><a href="/ebooks/advancedwxpython/">wxPython ebook</a></li>
<li><a href="/ebooks/windowsapi/">Windows API ebook</a></li>
<li><a href="/ebooks/advancedjavaswing/">Java Swing ebook</a></li>
<li><a href="/ebooks/javagames/">Java games ebook</a></li>
<li><a href="/ebooks/mysqljava/">MySQL Java ebook</a></li>
</ul>

</div>

</div>


<div class="content">


<nav>
<a href="..">Contents</a>
<a href="../gtktreeview/">Previous</a>
<a href="../customwidget/">Next</a>
</nav>


<h1>GtkTextView widget</h1>

<p class="last_mod">
last modified July 16, 2020 
</p>


<p>
In this part of the GTK+ programming tutorial, we work with the <code>GtkTextView</code> widget. 
</p>

<div class="ad-top square-fix-ad">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- square-fixed-2020 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-9706709751191532"
     data-ad-slot="6775384732"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<p>
<code>GtkTextView</code> widget is used for displaying and editing multiline 
text. <code>GtkTextView</code> widget has also the MVC design. The 
<code>GtkTextView</code> represents the view component and the <code>GtkTextBuffer</code> 
represents the model component. <code>GtkTextBuffer</code> is used to manipulate 
textual data. <code>GtkTextTag</code> is an attribute that 
can be applied to the text. <code>GtkTextIter</code> represents 
a position between two characters in the text. All manipulation with the 
text is done using text iterators. 
</p>


<h2>Simple example</h2>

<p>
In our first example, we show some of the <code>GtkTextView's</code> functionality. 
We show how to apply various text tags to the text data.
</p>

<div class="codehead">simpletextview.c</div>
<pre class="code">
#include &lt;gtk/gtk.h&gt;

int main(int argc, char *argv[]) {
    
  GtkWidget *window;
  GtkWidget *view;
  GtkWidget *vbox;
  
  GtkTextBuffer *buffer;
  GtkTextIter start, end;
  GtkTextIter iter;

  gtk_init(&amp;argc, &amp;argv);

  window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
  gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);
  gtk_window_set_default_size(GTK_WINDOW(window), 300, 200);
  gtk_window_set_title(GTK_WINDOW(window), "GtkTextView");

  vbox = gtk_vbox_new(FALSE, 0);
  view = gtk_text_view_new();
  gtk_box_pack_start(GTK_BOX(vbox), view, TRUE, TRUE, 0);

  buffer = gtk_text_view_get_buffer(GTK_TEXT_VIEW(view));

  gtk_text_buffer_create_tag(buffer, "gap",
        "pixels_above_lines", 30, NULL);

  gtk_text_buffer_create_tag(buffer, "lmarg", 
      "left_margin", 5, NULL);
  gtk_text_buffer_create_tag(buffer, "blue_fg", 
      "foreground", "blue", NULL); 
  gtk_text_buffer_create_tag(buffer, "gray_bg", 
      "background", "gray", NULL); 
  gtk_text_buffer_create_tag(buffer, "italic", 
      "style", PANGO_STYLE_ITALIC, NULL);
  gtk_text_buffer_create_tag(buffer, "bold", 
      "weight", PANGO_WEIGHT_BOLD, NULL);

  gtk_text_buffer_get_iter_at_offset(buffer, &amp;iter, 0);

  gtk_text_buffer_insert(buffer, &amp;iter, "Plain text\n", -1);
  gtk_text_buffer_insert_with_tags_by_name(buffer, &amp;iter, 
        "Colored Text\n", -1, "blue_fg", "lmarg",  NULL);
  gtk_text_buffer_insert_with_tags_by_name (buffer, &amp;iter, 
        "Text with colored background\n", -1, "lmarg", "gray_bg", NULL);

  gtk_text_buffer_insert_with_tags_by_name (buffer, &amp;iter, 
        "Text in italics\n", -1, "italic", "lmarg",  NULL);

  gtk_text_buffer_insert_with_tags_by_name (buffer, &amp;iter, 
        "Bold text\n", -1, "bold", "lmarg",  NULL);

  gtk_container_add(GTK_CONTAINER(window), vbox);

  g_signal_connect(G_OBJECT(window), "destroy",
        G_CALLBACK(gtk_main_quit), NULL);

  gtk_widget_show_all(window);

  gtk_main();

  return 0;
}
</pre>

<p>
The example shows some text with different <code>GtkTextTags</code> applied.
</p>

<pre class="explanation">
view = gtk_text_view_new();
</pre>

<p>
The <code>gtk_text_view_new()</code> function creates a new <code>GtkTextView</code> widget. 
</p>

<pre class="explanation">
gtk_text_buffer_create_tag(buffer, "blue_fg", 
    "foreground", "blue", NULL); 
</pre>

<p>
The <code>gtk_text_buffer_create_tag()</code> function creates a tag and adds it to the 
tag table for the buffer. The second parameter is the tag name. The tag changes the colour of the text to blue. 
</p>

<pre class="explanation">
gtk_text_buffer_insert_with_tags_by_name(buffer, &amp;iter, 
      "Colored Text\n", -1, "blue_fg", "lmarg",  NULL);
</pre>

<p>
The <code>gtk_text_buffer_insert_with_tags_by_name()</code> function
inserts text with <code>blue_fg</code> and <code>lmarg</code> text tags. 
The tags are recognized by their names.
</p>

<figure>
<img src="/img/gui/cgtk/simpletextview.png" alt="GtkTextView">
<figcaption>Figure: GtkTextView</figcaption>
</figure>

<div class="ad-mid square-fix-ad">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- square-fixed-2020 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-9706709751191532"
     data-ad-slot="6775384732"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<h2>Lines and columns</h2>

<p>
The following example displays the current line and column 
of the text cursor.  
</p>

<div class="codehead">linescols.c</div>
<pre class="code">
#include &lt;gtk/gtk.h&gt;

update_statusbar(GtkTextBuffer *buffer,
                  GtkStatusbar  *statusbar) {
  gchar *msg;
  gint row, col;
  GtkTextIter iter;
  
  gtk_statusbar_pop(statusbar, 0); 

  gtk_text_buffer_get_iter_at_mark(buffer,
      &amp;iter, gtk_text_buffer_get_insert(buffer));

  row = gtk_text_iter_get_line(&amp;iter);
  col = gtk_text_iter_get_line_offset(&amp;iter);

  msg = g_strdup_printf("Col: %d Ln: %d", col+1, row+1);

  gtk_statusbar_push(statusbar, 0, msg);

  g_free(msg);
}

void mark_set_callback(GtkTextBuffer *buffer, 
    const GtkTextIter *new_location, GtkTextMark *mark, gpointer data) {
                       
  update_statusbar(buffer, GTK_STATUSBAR(data));
}

int main(int argc, char *argv[]) {

  GtkWidget *window;
  GtkWidget *vbox;
  
  GtkWidget *toolbar;
  GtkWidget *view;
  GtkWidget *statusbar;
  GtkToolItem *exit;
  GtkTextBuffer *buffer;

  gtk_init(&amp;argc, &amp;argv);

  window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
  gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);
  gtk_window_set_default_size(GTK_WINDOW(window), 350, 300);
  gtk_window_set_title(GTK_WINDOW(window), "Lines &amp; columns");

  vbox = gtk_vbox_new(FALSE, 0);
  gtk_container_add(GTK_CONTAINER(window), vbox);

  toolbar = gtk_toolbar_new();
  gtk_toolbar_set_style(GTK_TOOLBAR(toolbar), GTK_TOOLBAR_ICONS);

  exit = gtk_tool_button_new_from_stock(GTK_STOCK_QUIT);
  gtk_toolbar_insert(GTK_TOOLBAR(toolbar), exit, -1);

  gtk_box_pack_start(GTK_BOX(vbox), toolbar, FALSE, FALSE, 5);

  view = gtk_text_view_new();
  gtk_text_view_set_wrap_mode(GTK_TEXT_VIEW(view), GTK_WRAP_WORD);
  gtk_box_pack_start(GTK_BOX(vbox), view, TRUE, TRUE, 0);
  gtk_widget_grab_focus(view);

  buffer = gtk_text_view_get_buffer(GTK_TEXT_VIEW(view));

  statusbar = gtk_statusbar_new();
  gtk_box_pack_start(GTK_BOX(vbox), statusbar, FALSE, FALSE, 0);

  g_signal_connect(G_OBJECT(exit), "clicked", 
        G_CALLBACK(gtk_main_quit), NULL);

  g_signal_connect(buffer, "changed",
        G_CALLBACK(update_statusbar), statusbar);

  g_signal_connect_object(buffer, "mark_set", 
        G_CALLBACK(mark_set_callback), statusbar, 0);

  g_signal_connect_swapped(G_OBJECT(window), "destroy",
        G_CALLBACK(gtk_main_quit), NULL);

  gtk_widget_show_all(window);

  update_statusbar(buffer, GTK_STATUSBAR(statusbar));

  gtk_main();

  return 0;
}
</pre>

<p>
In this code example, we show the current position of the text cursor in the statusbar. 
</p>

<pre class="explanation">
g_signal_connect(buffer, "changed",
      G_CALLBACK(update_statusbar), statusbar);
</pre>

<p>
When we change the text, we call the <code>update_statusbar()</code> handler.
</p>

<pre class="explanation">
g_signal_connect_object(buffer, "mark_set", 
      G_CALLBACK(mark_set_callback), statusbar, 0);
</pre>

<p>
The <code>mark_set</code> signal is emitted when the cursor moves. 
</p>

<pre class="explanation">
gtk_statusbar_pop(statusbar, 0); 
</pre>

<p>
This code line clears the message with context ID 0 from the statusbar.
</p>

<pre class="explanation">
gtk_text_buffer_get_iter_at_mark(buffer,
    &amp;iter, gtk_text_buffer_get_insert(buffer));

row = gtk_text_iter_get_line(&amp;iter);
col = gtk_text_iter_get_line_offset(&amp;iter);
</pre>

<p>
These lines determine the current line and column.  
</p>

<pre class="explanation">
msg = g_strdup_printf("Col %d Ln %d", col+1, row+1);
</pre>

<p>
The <code>g_strdup_printf()</code> is used to build the text to be displayed 
on the statusbar. 
</p>

<pre class="explanation">
gtk_statusbar_push(statusbar, 0, msg);
</pre>

<p>
We show the text on the statusbar with the <code>gtk_statusbar_push()</code> function.
</p>

<figure>
<img src="/img/gui/cgtk/linescols.png" alt="Lines and columns">
<figcaption>Figure: Lines and columns</figcaption>
</figure>


<h2>Search &amp; highlight</h2>

<p>
In the next example, we do some searching in the <code>GtkTextBuffer</code>; 
we highlight some text patterns in the text buffer. 
</p>

<div class="codehead">search.c</div>
<pre class="code">
#include &lt;gtk/gtk.h&gt;
#include &lt;gdk/gdkkeysyms.h&gt;

gboolean key_pressed(GtkWidget *window,
    GdkEventKey* event, GtkTextBuffer *buffer) {

  GtkTextIter start_sel, end_sel;
  GtkTextIter start_find, end_find;
  GtkTextIter start_match, end_match;
  gboolean selected;    
  gchar *text;            
  
  if ((event->type == GDK_KEY_PRESS) &amp;&amp; 
     (event->state &amp; GDK_CONTROL_MASK)) {

    switch (event->keyval) {
        
      case GDK_m :
        selected = gtk_text_buffer_get_selection_bounds(buffer, 
            &amp;start_sel, &amp;end_sel);
      if (selected) {
        gtk_text_buffer_get_start_iter(buffer, &amp;start_find);
        gtk_text_buffer_get_end_iter(buffer, &amp;end_find);

        gtk_text_buffer_remove_tag_by_name(buffer, "gray_bg", 
            &amp;start_find, &amp;end_find);  
        text = (gchar *) gtk_text_buffer_get_text(buffer, &amp;start_sel,
            &amp;end_sel, FALSE);

        while (gtk_text_iter_forward_search(&amp;start_find, text, 
                GTK_TEXT_SEARCH_TEXT_ONLY | 
                GTK_TEXT_SEARCH_VISIBLE_ONLY, 
                &amp;start_match, &amp;end_match, NULL)) {

          gtk_text_buffer_apply_tag_by_name(buffer, "gray_bg", 
              &amp;start_match, &amp;end_match);
          gint offset = gtk_text_iter_get_offset(&amp;end_match);
          gtk_text_buffer_get_iter_at_offset(buffer, 
              &amp;start_find, offset);
        }

        g_free(text);
      }

      break;

      case GDK_r:
        gtk_text_buffer_get_start_iter(buffer, &amp;start_find);
        gtk_text_buffer_get_end_iter(buffer, &amp;end_find);
      
        gtk_text_buffer_remove_tag_by_name(buffer, "gray_bg", 
            &amp;start_find, &amp;end_find);  
      break;
    }
  }

  return FALSE;
}

int main(int argc, gchar *argv[]) {

  GtkWidget *window;
  GtkWidget *view;
  GtkWidget *vbox;
  
  GtkTextBuffer *buffer;
  GtkTextIter start, end;
  GtkTextIter iter;

  gtk_init(&amp;argc, &amp;argv);

  window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
  gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);
  gtk_window_set_default_size(GTK_WINDOW(window), 350, 300);
  gtk_window_set_title(GTK_WINDOW(window), "Search &amp; highlight");
  GTK_WINDOW(window)->allow_shrink = TRUE;

  vbox = gtk_vbox_new(FALSE, 0);
  view = gtk_text_view_new();
  gtk_widget_add_events(view, GDK_BUTTON_PRESS_MASK);
  gtk_box_pack_start(GTK_BOX(vbox), view, TRUE, TRUE, 0);

  buffer = gtk_text_view_get_buffer(GTK_TEXT_VIEW(view));
  gtk_text_buffer_create_tag(buffer, "gray_bg", 
      "background", "lightgray", NULL); 
  gtk_container_add(GTK_CONTAINER(window), vbox);

  g_signal_connect(G_OBJECT(window), "destroy",
        G_CALLBACK(gtk_main_quit), NULL);

  g_signal_connect(G_OBJECT(window), "key-press-event",
        G_CALLBACK(key_pressed), buffer);

  gtk_widget_show_all(window);

  gtk_main();

  return 0;
}
</pre>

<p>
In our code example we use keyboard shortcuts. The <kbd>Ctrl</kbd>+<kbd>M</kbd> shortcut highlights 
the all occurrences of the currently selected text. The <kbd>Ctrl</kbd>+<kbd>R</kbd> removes the 
highlights from the text.  
</p>

<pre class="explanation">
gtk_text_buffer_create_tag(buffer, "gray_bg", 
    "background", "lightgray", NULL); 
</pre>

<p>
This is the <code>GtkTextTag</code> that we use in our example. The tag makes 
the background of the text gray. 
</p>

<pre class="explanation">
selected = gtk_text_buffer_get_selection_bounds(buffer, 
    &amp;start_sel, &amp;end_sel);
</pre>

<p>
With the <code>gtk_text_buffer_get_selection_bounds()</code> function, we get 
the start and end positions of the selected text. 
</p>

<pre class="explanation">
gtk_text_buffer_get_start_iter(buffer, &amp;start_find);
gtk_text_buffer_get_end_iter(buffer, &amp;end_find);
</pre>

<p>
We get the first and the last position in the text buffer. 
</p>

<pre class="explanation">
gtk_text_buffer_remove_tag_by_name(buffer, "gray_bg", 
    &amp;start_find, &amp;end_find);  
</pre>

<p>
With the <code>gtk_text_buffer_remove_tag_by_name()</code> funcion, we remove 
any previous text tag. 
</p>

<pre class="explanation">
text = (gchar *) gtk_text_buffer_get_text(buffer, &amp;start_sel,
    &amp;end_sel, FALSE);
</pre>

<p>
We obtain the selected text. It is the text we are going to search for. 
</p>

<pre class="explanation">
while (gtk_text_iter_forward_search(&amp;start_find, text, 
        GTK_TEXT_SEARCH_TEXT_ONLY | 
        GTK_TEXT_SEARCH_VISIBLE_ONLY, 
        &amp;start_match, &amp;end_match, NULL)) {

    gtk_text_buffer_apply_tag_by_name(buffer, "gray_bg", 
        &amp;start_match, &amp;end_match);
    gint offset = gtk_text_iter_get_offset(&amp;end_match);
    gtk_text_buffer_get_iter_at_offset(buffer, 
        &amp;start_find, offset);
}
</pre>

<p>
This code searches for all occurences of the selected text. If we find any match, we
apply the text tag. After the match, the ending point of the word becomes the starting point
for the next search.
</p>

<figure>
<img src="/img/gui/cgtk/searchhighlight.png" alt="Search &amp; Highlight">
<figcaption>Figure: Search &amp; Highlight</figcaption>
</figure>

<p>
In this chapter we covered the <code>GtkTextView</code> widget. 
</p>

<div class="ad-bot square-fix-ad">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- square-fixed-2020 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-9706709751191532"
     data-ad-slot="6775384732"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<nav>
<a href="..">Contents</a> 
<a href="../gtktreeview/">Previous</a>
<a href="../customwidget/">Next</a>
</nav>



</div> <!-- content -->

<div class="rtow">

<div class="vert-ad">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- vertical-2020 -->
<ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-9706709751191532"
        data-ad-slot="5880603481"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
<script>
        (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<div class="square-fix-ad ad-rtow">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- square-fixed-2020 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-9706709751191532"
     data-ad-slot="6775384732"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

</div> <!-- rtow -->

</div> <!-- container -->

<footer>

<nav>
<a title="Home page" href="/">Home</a> 
<a title="Follow on Facebook" href="https://www.facebook.com/zetcode7/">Facebook</a>
<a title="Follow on Twitter" href="https://twitter.com/janbodnar">Twitter</a>
<a title="Visit Github" href="https://github.com/janbodnar">Github</a>
<a title="Subscribe to ZetCode news" href="http://zetcode.us13.list-manage.com/subscribe?u=9def9ccd4c70dbbaf691f90fc&id=6556210f80">Subscribe</a>
<a title="Privacy policy" href="/privacy">Privacy</a> 
</nav>

<div>
<span>&copy; 2007 - 2021 Jan Bodnar</span>
<span>admin(at)zetcode.com</span>
</div>

</footer>

</body>
</html>

