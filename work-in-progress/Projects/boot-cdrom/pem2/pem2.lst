     1                                  ORG     0
     2                                  BITS    16
     3                                  
     4 00000000 B8024F                       mov       ax, 0x4F02
     5 00000003 BB0701                       mov       bx, 0x107              ; <-1280x1024 256 = 107h colors
     6 00000006 CD10                         int       0x10
     7 00000008 BE[1100]                      mov     si, msg1
     8 0000000B B304                          mov     bl, 0x04        ; red
     9 0000000D E81200                        call    WriteStringWithAttributeMode19
    10 00000010 CB                      retf
    11                                        
    12                                  ; ---------------------------
    13 00000011 50454D322074657374-     msg1: db      'PEM2 test demo', 13, 10, 0
    13 0000001A 2064656D6F0D0A00   
    14                                  ; ---------------------------
    15                                  ; IN (bl,ds:si) OUT ()
    16                                  WriteStringWithAttributeMode19:
    17 00000022 60                            pusha
    18 00000023 B700                          mov     bh, 0           ; Display page 0
    19 00000025 89DD                          mov     bp, bx
    20 00000027 EB5E                          jmp    .d
    21 00000029 3C09                    .a:   cmp     al, 9
    22 0000002B 7461                          je      .Tab
    23 0000002D 3C0D                          cmp     al, 13
    24 0000002F 7708                          ja      .b
    25 00000031 B97FDA                        mov     cx, 1101_1010_0111_1111b
    26 00000034 0FA3C1                        bt      cx, ax
    27 00000037 734A                          jnc     .c              ; 7,8,10,13 don't need the color
    28                                  
    29 00000039 89EB                    .b:   mov     bx, bp
    30 0000003B 88DA                          mov     dl, bl
    31 0000003D C0EA04                        shr     dl, 4           ; Get background color (high nibble)
    32 00000040 80E30F                        and     bl, 15          ; Get foreground color (low nibble)
    33 00000043 30D3                          xor     bl, dl
    34 00000045 B40E                          mov     ah, 0Eh
    35 00000047 CD10                          int     10h             ; BIOS.Teletype
    36 00000049 B403                          mov     ah, 03h
    37 0000004B CD10                          int     10h             ; BIOS.GetCursor -> CX DX
    38 0000004D FECA                          dec     dl              ; Column is [0,39]
    39 0000004F 7904                          jns     .1
    40 00000051 B227                          mov     dl, 39
    41 00000053 FECE                          dec     dh
    42 00000055 0FB6CA                  .1:   movzx   cx, dl          ; Column -> X
    43 00000058 C1E103                        shl     cx, 3
    44 0000005B 0FB6D6                        movzx   dx, dh          ; Row -> Y
    45 0000005E C1E203                        shl     dx, 3
    46                                  
    47 00000061 89EB                          mov     bx, bp
    48 00000063 C0EB04                        shr     bl, 4           ; Get background color (high nibble)
    49 00000066 B40D                    .2:   mov     ah, 0Dh         ; BIOS.ReadPixel
    50 00000068 CD10                          int     10h             ; -> AL
    51 0000006A 30D8                          xor     al, bl
    52 0000006C B40C                          mov     ah, 0Ch         ; BIOS.WritePixel
    53 0000006E CD10                          int     10h
    54 00000070 41                            inc     cx              ; X++
    55 00000071 F7C10700                      test    cx, 7
    56 00000075 75EF                          jnz     .2
    57 00000077 83E908                        sub     cx, 8
    58 0000007A 42                            inc     dx              ; Y++
    59 0000007B F7C20700                      test    dx, 7
    60 0000007F 75E5                          jnz     .2
    61 00000081 EB04                          jmp     .d
    62                                  
    63 00000083 B40E                    .c:   mov     ah, 0Eh
    64 00000085 CD10                          int     10h             ; BIOS.Teletype
    65 00000087 AC                      .d:   lodsb
    66 00000088 84C0                          test    al, al
    67 0000008A 759D                          jnz     .a
    68 0000008C 61                            popa
    69 0000008D C3                            ret
    70 0000008E B90100                  .Tab: mov     cx, 1           ; Start displaying colored space(s)
    71 00000091 89EB                          mov     bx, bp
    72 00000093 C0EB04                        shr     bl, 4           ; Get background color
    73 00000096 B8DB0E                        mov     ax, 0EDBh       ; ASCII DBh is full block character
    74 00000099 CD10                          int     10h             ; BIOS.Teletype
    75 0000009B B403                          mov     ah, 03h
    76 0000009D CD10                          int     10h             ; BIOS.GetCursor -> CX DX
    77 0000009F F6C207                        test    dl, 7
    78 000000A2 75EA                          jnz     .Tab            ; Column not yet multiple of 8
    79 000000A4 EBE1                          jmp    .d
    80                                  ; ----------------------------
