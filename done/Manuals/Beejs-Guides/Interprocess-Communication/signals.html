<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Beej's Guide to Interprocess Communication</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Mono&display=swap" rel="stylesheet"> 

  <!-- BG custom styling -->
  <style type="text/css">
  /* Fix for line numbers not visible */
  pre.numberSource code > span {
      left: -1em;
  }
  pre.numberSource {
      margin-left: initial;
  }

  /* Put some space after the section numbers */
  span.toc-section-number::after {
      content: "\a0\a0\a0";  /* non-breaking whitespace */
  }

  /* Hide underlines on code number links */
  pre > code.sourceCode > span > a:first-child::before {
      text-decoration: none;
  }

  /* Color the source blocks */
  div.sourceCode {
      background-color: #f0f0f0;
  }

  /* Fix iOS big text rendering issue */
  pre > code.sourceCode > span {
      display: initial;
  }


  /* Color the inline code */
  code:not(.sourceCode) {
      background: #f0f0f0;
      padding-left: 0.2em;
      padding-right: 0.2em;
      border-radius: 0.2em;
  }

  /* Keep code tags from wrapping in tables */
  tbody code {
      white-space: nowrap;
  }

  td {
      vertical-align: top;
  }

  body {
      font-size: 12pt;
      max-width: 43em;
  }

  figure {
      text-align: center;
  }
  </style>
  <!-- BG custom styling for the wide body variant -->
  <!-- Gets appended after bg-css.html -->

  <style type="text/css">
  body {
      max-width: inherit;
  }
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div style="text-align:center"><span><a href="fork.html">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="pipes.html">Next</a></span></div><hr>
<h1 data-number="3" id="signals"><span class="header-section-number">3</span> Signals</h1>
<p>There is a sometimes useful method for one process to bug another: signals. Basically, one process can “raise” a signal and have it delivered to another process. The destination process’s signal handler (just a function) is invoked and the process can handle it.</p>
<p>The devil’s in the details, of course, and in actuality what you are permitted to do safely inside your signal handler is rather limited. Nevertheless, signals provide a useful service.</p>
<p>For example, one process might want to stop another one, and this can be done by sending the signal <code>SIGSTOP</code> to that process. To continue, the process has to receive signal <code>SIGCONT</code>. How does the process know to do this when it receives a certain signal? Well, many signals are predefined and the process has a default signal handler to deal with it.</p>
<p>A default handler? Yes. Take <code>SIGINT</code> for example. This is the interrupt signal that a process receives when the user hits <code>^C</code>. The default signal handler for <code>SIGINT</code> causes the process to exit! Sound familiar? Well, as you can imagine, you can override the <code>SIGINT</code> to do whatever you want (or nothing at all!) You could have your process <code>printf()</code> “Interrupt?! No way, Jose!” and go about its merry business.</p>
<p>So now you know that you can have your process respond to just about any signal in just about any way you want. Naturally, there are exceptions because otherwise it would be too easy to understand. Take the ever popular <code>SIGKILL</code>, signal #9. Have you ever typed “<code>kill -9 _nnnn_</code>” to kill a runaway process? You were sending it <code>SIGKILL</code>. Now you might also remember that no process can get out of a “<code>kill -9</code>”, and you would be correct. <code>SIGKILL</code> is one of the signals you <code>can't</code> add your own signal handler for. The aforementioned <code>SIGSTOP</code> is also in this category.</p>
<p>(Aside: you often use the Unix “<code>kill</code>” command without specifying a signal to send…so what signal is it? The answer: <code>SIGTERM</code>. You can write your own handler for <code>SIGTERM</code> so your process won’t respond to a regular “<code>kill</code>”, and the user must then use “<code>kill -9</code>” to destroy the process.)</p>
<p>Are all the signals predefined? What if you want to send a signal that has significance that only you understand to a process? There are two signals that aren’t reserved: <code>SIGUSR1</code> and <code>SIGUSER2</code>. You are free to use these for whatever you want and handle them in whatever way you choose. (For example, my cd player program might respond to <code>SIGUSR1</code> by advancing to the next track. In this way, I could control it from the command line by typing “<code>kill -SIGUSR1</code>nnnn``”.)</p>
<h2 data-number="3.1" id="catching-signals-for-fun-and-profit"><span class="header-section-number">3.1</span> Catching Signals for Fun and Profit!</h2>
<p>As you can guess the Unix “kill” command is one way to send signals to a process. By sheer unbelievable coincidence, there is a system call called <code>kill()</code> which does the same thing. It takes for its argument a signal number (as defined in <code>signal.h</code>) and a process ID. Also, there is a library routine called <code>raise()</code> which can be used to raise a signal within the same process.</p>
<p>The burning question remains: how do you catch a speeding <code>SIGTERM</code>? You need to call <code>sigaction()</code> and tell it all the gritty details about which signal you want to catch and which function you want to call to handle it.</p>
<p>Here’s the <code>sigaction()</code> breakdown:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="signals.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sigaction<span class="op">(</span><span class="dt">int</span> sig<span class="op">,</span> <span class="dt">const</span> <span class="kw">struct</span> sigaction <span class="op">*</span>act<span class="op">,</span></span>
<span id="cb4-2"><a href="signals.html#cb4-2" aria-hidden="true" tabindex="-1"></a>              <span class="kw">struct</span> sigaction <span class="op">*</span>oact<span class="op">);&lt;/</span>code<span class="op">&gt;</span></span></code></pre></div>
<p>The first parameter, <code>sig</code> is which signal to catch. This can be (probably “should” be) a symbolic name from <code>signal.h</code> along the lines of <code>SIGINT</code>. That’s the easy bit.</p>
<p>The next field, <code>act</code> is a pointer to a <code>struct sigaction</code> which has a bunch of fields that you can fill in to control the behavior of the signal handler. (A pointer to the signal handler function itself included in the <code>struct</code>.)</p>
<p>Lastly <code>oact</code> can be <code>NULL</code>, but if not, it returns the <em>old</em> signal handler information that was in place before. This is useful if you want to restore the previous signal handler at a later time.</p>
<p>We’ll focus on these three fields in the <code>struct sigaction</code>:</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="header">
<th>Signal</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sa_handler</code></td>
<td>The signal handler function (or <code>SIG_IGN</code> to ignore the signal)</td>
</tr>
<tr class="even">
<td><code>sa_mask</code></td>
<td>A set of signals to block while this one is being handled</td>
</tr>
<tr class="odd">
<td><code>sa_flags</code></td>
<td>Flags to modify the behavior of the handler, or <code>0</code></td>
</tr>
</tbody>
</table>
<p>What about that <code>sa_mask</code> field? When you’re handling a signal, you might want to block other signals from being delivered, and you can do this by adding them to the <code>sa_mask</code> It’s a “set”, which means you can do normal set operations to manipulate them: <code>sigemptyset()</code>, <code>sigfillset()</code>, <code>sigaddset()</code>, <code>sigdelset()</code>, and <code>sigismember()</code>. In this example, we’ll just clear the set and not block any other signals.</p>
<p>Examples always help! Here’s one that handled <code>SIGINT</code>, which can be delivered by hitting <code>^C</code>, called <a href="https://beej.us/guide/bgipc/source/examples/sigint.c"><code>sigint.c</code></a><a href="footnotes.html#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb5-1"><a href="signals.html#cb5-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb5-2"><a href="signals.html#cb5-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb5-3"><a href="signals.html#cb5-3"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb5-4"><a href="signals.html#cb5-4"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb5-5"><a href="signals.html#cb5-5"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb5-6"><a href="signals.html#cb5-6"></a></span>
<span id="cb5-7"><a href="signals.html#cb5-7"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span></span>
<span id="cb5-8"><a href="signals.html#cb5-8"></a><span class="op">{</span></span>
<span id="cb5-9"><a href="signals.html#cb5-9"></a>        <span class="co">/* using a char[] so that sizeof will work */</span></span>
<span id="cb5-10"><a href="signals.html#cb5-10"></a>    <span class="dt">const</span> <span class="dt">char</span> msg<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;Ahhh! SIGINT!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb5-11"><a href="signals.html#cb5-11"></a>    write<span class="op">(</span><span class="dv">0</span><span class="op">,</span> msg<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>msg<span class="op">));</span></span>
<span id="cb5-12"><a href="signals.html#cb5-12"></a><span class="op">}</span></span>
<span id="cb5-13"><a href="signals.html#cb5-13"></a></span>
<span id="cb5-14"><a href="signals.html#cb5-14"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb5-15"><a href="signals.html#cb5-15"></a><span class="op">{</span></span>
<span id="cb5-16"><a href="signals.html#cb5-16"></a>    <span class="dt">char</span> s<span class="op">[</span><span class="dv">200</span><span class="op">];</span></span>
<span id="cb5-17"><a href="signals.html#cb5-17"></a>        <span class="kw">struct</span> sigaction sa <span class="op">=</span> <span class="op">{</span></span>
<span id="cb5-18"><a href="signals.html#cb5-18"></a>            <span class="op">.</span>sa_handler <span class="op">=</span> sigint_handler<span class="op">,</span></span>
<span id="cb5-19"><a href="signals.html#cb5-19"></a>            <span class="op">.</span>sa_flags <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// or SA_RESTART</span></span>
<span id="cb5-20"><a href="signals.html#cb5-20"></a>            <span class="op">.</span>sa_mask <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-21"><a href="signals.html#cb5-21"></a>        <span class="op">};</span></span>
<span id="cb5-22"><a href="signals.html#cb5-22"></a></span>
<span id="cb5-23"><a href="signals.html#cb5-23"></a>    <span class="cf">if</span> <span class="op">(</span>sigaction<span class="op">(</span>SIGINT<span class="op">,</span> <span class="op">&amp;</span>sa<span class="op">,</span> NULL<span class="op">)</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-24"><a href="signals.html#cb5-24"></a>        perror<span class="op">(</span><span class="st">&quot;sigaction&quot;</span><span class="op">);</span></span>
<span id="cb5-25"><a href="signals.html#cb5-25"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb5-26"><a href="signals.html#cb5-26"></a>    <span class="op">}</span></span>
<span id="cb5-27"><a href="signals.html#cb5-27"></a></span>
<span id="cb5-28"><a href="signals.html#cb5-28"></a>    printf<span class="op">(</span><span class="st">&quot;Enter a string:</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb5-29"><a href="signals.html#cb5-29"></a></span>
<span id="cb5-30"><a href="signals.html#cb5-30"></a>    <span class="cf">if</span> <span class="op">(</span>fgets<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> stdin<span class="op">)</span> <span class="op">==</span> NULL<span class="op">)</span></span>
<span id="cb5-31"><a href="signals.html#cb5-31"></a>        perror<span class="op">(</span><span class="st">&quot;fgets&quot;</span><span class="op">);</span></span>
<span id="cb5-32"><a href="signals.html#cb5-32"></a>    <span class="cf">else</span> </span>
<span id="cb5-33"><a href="signals.html#cb5-33"></a>        printf<span class="op">(</span><span class="st">&quot;You entered: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> s<span class="op">);</span></span>
<span id="cb5-34"><a href="signals.html#cb5-34"></a></span>
<span id="cb5-35"><a href="signals.html#cb5-35"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-36"><a href="signals.html#cb5-36"></a><span class="op">}</span></span></code></pre></div>
<p>This program has two functions: <code>main()</code> which sets up the signal handler (using the <code>sigaction()</code> call), and <code>sigint_handler()</code> which is the signal handler, itself.</p>
<p>What happens when you run it? If you are in the midst of entering a string and you hit <code>^C</code>, the call to <code>gets()</code> fails and sets the global variable <code>errno</code> to <code>EINTR</code>. Additionally, <code>sigint_handler()</code> is called and does its routine, so you actually see:</p>
<pre><code>Enter a string:
the quick brown fox jum^CAhhh! SIGINT!
fgets: Interrupted system call</code></pre>
<p>And then it exits. Hey—what kind of handler is this, if it just exits anyway?</p>
<p>Well, we have a couple things at play, here. First, you’ll notice that the signal handler was called, because it printed “Ahhh! SIGINT!” But then <code>fgets()</code> returns an error, namely <code>EINTR</code>, or “Interrupted system call”. See, some system calls can be interrupted by signals, and when this happens, they return an error. You might see code like this (sometimes cited as an excusable use of <code>goto</code>):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="signals.html#cb7-1" aria-hidden="true" tabindex="-1"></a>restart<span class="op">:</span></span>
<span id="cb7-2"><a href="signals.html#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>some_system_call<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-3"><a href="signals.html#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>errno <span class="op">==</span> EINTR<span class="op">)</span> <span class="cf">goto</span> restart<span class="op">;</span></span>
<span id="cb7-4"><a href="signals.html#cb7-4" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;some_system_call&quot;</span><span class="op">);</span></span>
<span id="cb7-5"><a href="signals.html#cb7-5" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb7-6"><a href="signals.html#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>Instead of using <code>goto</code> like that, you might be able to set your <code>sa_flags</code> to include <code>SA_RESTART</code>. For example, if we change our <code>SIGINT</code> handler code to look like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="signals.html#cb8-1" aria-hidden="true" tabindex="-1"></a>    sa<span class="op">.</span>sa_flags <span class="op">=</span> SA_RESTART<span class="op">;&lt;/</span>code<span class="op">&gt;</span></span></code></pre></div>
<p>Then our run looks more like this:</p>
<pre><code>Enter a string:
Hello^CAhhh! SIGINT!
Er, hello!^CAhhh! SIGINT!
This time fer sure!
You entered: This time fer sure!</code></pre>
<p>Some system calls are interruptible, and some can be restarted. It’s system dependent.</p>
<h2 data-number="3.2" id="the-handler-is-not-omnipotent"><span class="header-section-number">3.2</span> The Handler is not Omnipotent</h2>
<p>You have to be careful when you make function calls in your signal handler. Those functions must be “async safe”, so they can be called without invoking undefined behavior.</p>
<p>You might be curious, for instance, why my signal handler, above, called <code>write()</code> to output the message instead of <code>printf()</code>. Well, the answer is that POSIX says that <code>write()</code> is async-safe (so is safe to call from within the handler), while <code>printf()</code> is not.</p>
<p>The library functions and system calls that are async-safe and can be called from within your signal handlers are (breath):</p>
<p><code>_Exit()</code>, <code>_exit()</code>, <code>abort()</code>, <code>accept()</code>, <code>access()</code>, <code>aio_error()</code>, <code>aio_return()</code>, <code>aio_suspend()</code>, <code>alarm()</code>, <code>bind()</code>, <code>cfgetispeed()</code>, <code>cfgetospeed()</code>, <code>cfsetispeed()</code>, <code>cfsetospeed()</code>, <code>chdir()</code>, <code>chmod()</code>, <code>chown()</code>, <code>clock_gettime()</code>, <code>close()</code>, <code>connect()</code>, <code>creat()</code>, <code>dup()</code>, <code>dup2()</code>, <code>execle()</code>, <code>execve()</code>, <code>fchmod()</code>, <code>fchown()</code>, <code>fcntl()</code>, <code>fdatasync()</code>, <code>fork()</code>, <code>fpathconf()</code>, <code>fstat()</code>, <code>fsync()</code>, <code>ftruncate()</code>, <code>getegid()</code>, <code>geteuid()</code>, <code>getgid()</code>, <code>getgroups()</code>, <code>getpeername()</code>, <code>getpgrp()</code>, <code>getpid()</code>, <code>getppid()</code>, <code>getsockname()</code>, <code>getsockopt()</code>, <code>getuid()</code>, <code>kill()</code>, <code>link()</code>, <code>listen()</code>, <code>lseek()</code>, <code>lstat()</code>, <code>mkdir()</code>, <code>mkfifo()</code>, <code>open()</code>, <code>pathconf()</code>, <code>pause()</code>, <code>pipe()</code>, <code>poll()</code>, <code>posix_trace_event()</code>, <code>pselect()</code>, <code>raise()</code>, <code>read()</code>, <code>readlink()</code>, <code>recv()</code>, <code>recvfrom()</code>, <code>recvmsg()</code>, <code>rename()</code>, <code>rmdir()</code>, <code>select()</code>, <code>sem_post()</code>, <code>send()</code>, <code>sendmsg()</code>, <code>sendto()</code>, <code>setgid()</code>, <code>setpgid()</code>, <code>setsid()</code>, <code>setsockopt()</code>, <code>setuid()</code>, <code>shutdown()</code>, <code>sigaction()</code>, <code>sigaddset()</code>, <code>sigdelset()</code>, <code>sigemptyset()</code>, <code>sigfillset()</code>, <code>sigismember()</code>, <code>sleep()</code>, <code>signal()</code>, <code>sigpause()</code>, <code>sigpending()</code>, <code>sigprocmask()</code>, <code>sigqueue()</code>, <code>sigset()</code>, <code>sigsuspend()</code>, <code>sockatmark()</code>, <code>socket()</code>, <code>socketpair()</code>, <code>stat()</code>, <code>symlink()</code>, <code>sysconf()</code>, <code>tcdrain()</code>, <code>tcflow()</code>, <code>tcflush()</code>, <code>tcgetattr()</code>, <code>tcgetpgrp()</code>, <code>tcsendbreak()</code>, <code>tcsetattr()</code>, <code>tcsetpgrp()</code>, <code>time()</code>, <code>timer_getoverrun()</code>, <code>timer_gettime()</code>, <code>timer_settime()</code>, <code>times()</code>, <code>umask()</code>, <code>uname()</code>, <code>unlink()</code>, <code>utime()</code>, <code>wait()</code>, <code>waitpid()</code>, and <code>write()</code>.</p>
<p>Of course, you can call your own functions from within your signal handler (as long they don’t call any non-async-safe functions.)</p>
<p>But wait—there’s more!</p>
<p>You also cannot safely alter any shared (e.g. global) data, with one notable exception: variables that are declared to be of storage class and type <code>volatile sig_atomic_t</code>.</p>
<p>Here’s an example that handles <code>SIGUSR1</code> by setting a global flag, which is then examined in the main loop to see if the handler was called. This is <a href="https://beej.us/guide/bgipc/source/examples/sigusr.c"><code>sigusr.c</code></a><a href="footnotes.html#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb10-1"><a href="signals.html#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb10-2"><a href="signals.html#cb10-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb10-3"><a href="signals.html#cb10-3"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb10-4"><a href="signals.html#cb10-4"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb10-5"><a href="signals.html#cb10-5"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb10-6"><a href="signals.html#cb10-6"></a></span>
<span id="cb10-7"><a href="signals.html#cb10-7"></a><span class="dt">volatile</span> <span class="dt">sig_atomic_t</span> got_usr1<span class="op">;</span></span>
<span id="cb10-8"><a href="signals.html#cb10-8"></a></span>
<span id="cb10-9"><a href="signals.html#cb10-9"></a><span class="dt">void</span> sigusr1_handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span></span>
<span id="cb10-10"><a href="signals.html#cb10-10"></a><span class="op">{</span></span>
<span id="cb10-11"><a href="signals.html#cb10-11"></a>    got_usr1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-12"><a href="signals.html#cb10-12"></a><span class="op">}</span></span>
<span id="cb10-13"><a href="signals.html#cb10-13"></a></span>
<span id="cb10-14"><a href="signals.html#cb10-14"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb10-15"><a href="signals.html#cb10-15"></a><span class="op">{</span></span>
<span id="cb10-16"><a href="signals.html#cb10-16"></a>        <span class="kw">struct</span> sigaction sa <span class="op">=</span> <span class="op">{</span></span>
<span id="cb10-17"><a href="signals.html#cb10-17"></a>            <span class="op">.</span>sa_handler <span class="op">=</span> sigusr1_handler<span class="op">,</span></span>
<span id="cb10-18"><a href="signals.html#cb10-18"></a>            <span class="op">.</span>sa_flags <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// or SA_RESTART</span></span>
<span id="cb10-19"><a href="signals.html#cb10-19"></a>            <span class="op">.</span>sa_mask <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-20"><a href="signals.html#cb10-20"></a>        <span class="op">};</span></span>
<span id="cb10-21"><a href="signals.html#cb10-21"></a></span>
<span id="cb10-22"><a href="signals.html#cb10-22"></a>    got_usr1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-23"><a href="signals.html#cb10-23"></a></span>
<span id="cb10-24"><a href="signals.html#cb10-24"></a>    <span class="cf">if</span> <span class="op">(</span>sigaction<span class="op">(</span>SIGUSR1<span class="op">,</span> <span class="op">&amp;</span>sa<span class="op">,</span> NULL<span class="op">)</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-25"><a href="signals.html#cb10-25"></a>        perror<span class="op">(</span><span class="st">&quot;sigaction&quot;</span><span class="op">);</span></span>
<span id="cb10-26"><a href="signals.html#cb10-26"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-27"><a href="signals.html#cb10-27"></a>    <span class="op">}</span></span>
<span id="cb10-28"><a href="signals.html#cb10-28"></a></span>
<span id="cb10-29"><a href="signals.html#cb10-29"></a>    <span class="cf">while</span> <span class="op">(!</span>got_usr1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-30"><a href="signals.html#cb10-30"></a>        printf<span class="op">(</span><span class="st">&quot;PID </span><span class="sc">%d</span><span class="st">: working hard...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> getpid<span class="op">());</span></span>
<span id="cb10-31"><a href="signals.html#cb10-31"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-32"><a href="signals.html#cb10-32"></a>    <span class="op">}</span></span>
<span id="cb10-33"><a href="signals.html#cb10-33"></a></span>
<span id="cb10-34"><a href="signals.html#cb10-34"></a>    printf<span class="op">(</span><span class="st">&quot;Done in by SIGUSR1!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-35"><a href="signals.html#cb10-35"></a></span>
<span id="cb10-36"><a href="signals.html#cb10-36"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-37"><a href="signals.html#cb10-37"></a><span class="op">}</span></span></code></pre></div>
<p>Fire it it up in one window, and then use the <code>kill -USR1</code> in another window to kill it. The <code>sigusr</code> program conveniently prints out its process ID so you can pass it to <code>kill</code>:</p>
<pre><code>$ sigusr
PID 5023: working hard...
PID 5023: working hard...
PID 5023: working hard...</code></pre>
<p>Then in the other window, send it the signal <code>SIGUSR1</code>:</p>
<pre><code>$ kill -USR1 5023</code></pre>
<p>And the program should respond:</p>
<pre><code>PID 5023: working hard...
PID 5023: working hard...
Done in by SIGUSR1!</code></pre>
<p>(And the response should be immediate even if <code>sleep()</code> has just been called—<code>sleep()</code> gets interrupted by signals.)</p>
<h2 data-number="3.3" id="what-about-signal"><span class="header-section-number">3.3</span> What about <code>signal()</code></h2>
<p>ANSI C defines a function called <code>signal()</code> that can be used to catch signals. It’s not as reliable or as full-featured as <code>sigaction()</code>, so use of <code>signal()</code>is generally discouraged.</p>
<h2 data-number="3.4" id="some-signals-to-make-you-popular"><span class="header-section-number">3.4</span> Some signals to make you popular</h2>
<p>Here is a list of signals you (most likely) have at your disposal:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Signal</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>SIGABRT</code></td>
<td>Process abort signal.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGALRM</code></td>
<td>Alarm clock.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGFPE</code></td>
<td>Erroneous arithmetic operation.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGHUP</code></td>
<td>Hangup.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGILL</code></td>
<td>Illegal instruction.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGINT</code></td>
<td>Terminal interrupt signal.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGKILL</code></td>
<td>Kill (cannot be caught or ignored).</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGPIPE</code></td>
<td>Write on a pipe with no one to read it.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGQUIT</code></td>
<td>Terminal quit signal.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGSEGV</code></td>
<td>Invalid memory reference.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGTERM</code></td>
<td>Termination signal.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGUSR1</code></td>
<td>User-defined signal 1.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGUSR2</code></td>
<td>User-defined signal 2.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGCHLD</code></td>
<td>Child process terminated or stopped.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGCONT</code></td>
<td>Continue executing, if stopped.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGSTOP</code></td>
<td>Stop executing (cannot be caught or ignored).</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGTSTP</code></td>
<td>Terminal stop signal.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGTTIN</code></td>
<td>Background process attempting read.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGTTOU</code></td>
<td>Background process attempting write.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGBUS</code></td>
<td>Bus error.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGPOLL</code></td>
<td>Pollable event.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGPROF</code></td>
<td>Profiling timer expired.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGSYS</code></td>
<td>Bad system call.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGTRAP</code></td>
<td>Trace/breakpoint trap.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGURG</code></td>
<td>High bandwidth data is available at a socket.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGVTALRM</code></td>
<td>Virtual timer expired.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>SIGXCPU</code></td>
<td>CPU time limit exceeded.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>SIGXFSZ</code></td>
<td>File size limit exceeded.</td>
</tr>
</tbody>
</table>
<p>Each signal has its own default signal handler, the behavior of which is defined in your local man pages.</p>
<h2 data-number="3.5" id="what-i-have-glossed-over"><span class="header-section-number">3.5</span> What I have Glossed Over</h2>
<p>Nearly all of it. There are tons of flags, realtime signals, mixing signals with threads, masking signals, <code>longjmp()</code> and signals, and more.</p>
<p>Of course, this is just a “getting started” guide, but in a last-ditch effort to give you more information, here is a list of man pages with more information:</p>
<p>Handling signals:</p>
<ul>
<li><a href="https://man.archlinux.org/man/sigaction.2"><code>sigaction()</code></a><a href="footnotes.html#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigwait.3"><code>sigwait()</code></a><a href="footnotes.html#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigwaitinfo.2"><code>sigwaitinfo()</code></a><a href="footnotes.html#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigtimedwait.2"><code>sigtimedwait()</code></a><a href="footnotes.html#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigsuspend.2"><code>sigsuspend()</code></a><a href="footnotes.html#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigpending.2"><code>sigpending()</code></a><a href="footnotes.html#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a></li>
</ul>
<p>Delivering signals:</p>
<ul>
<li><a href="https://man.archlinux.org/man/kill.2"><code>kill()</code></a><a href="footnotes.html#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a></li>
<li><a href="https://man.archlinux.org/man/raise.3"><code>raise()</code></a><a href="footnotes.html#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigqueue.3"><code>sigqueue()</code></a><a href="footnotes.html#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a></li>
</ul>
<p>Set operations:</p>
<ul>
<li><a href="https://man.archlinux.org/man/sigemptyset.3"><code>sigemptyset()</code></a><a href="footnotes.html#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigfillset.3"><code>sigfillset()</code></a><a href="footnotes.html#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigaddset.3"><code>sigaddset()</code></a><a href="footnotes.html#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigdelset.3"><code>sigdelset()</code></a><a href="footnotes.html#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigismember.3"><code>sigismember()</code></a><a href="footnotes.html#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a></li>
</ul>
<p>Other:</p>
<ul>
<li><a href="https://man.archlinux.org/man/sigprocmask.2"><code>sigprocmask()</code></a><a href="footnotes.html#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigaltstack.2"><code>sigaltstack()</code></a><a href="footnotes.html#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a></li>
<li><a href="https://man.archlinux.org/man/siginterrupt.3"><code>siginterrupt()</code></a><a href="footnotes.html#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a></li>
<li><a href="https://man.archlinux.org/man/sigsetjmp.3"><code>sigsetjmp()</code></a><a href="footnotes.html#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a></li>
<li><a href="https://man.archlinux.org/man/siglongjmp.3"><code>siglongjmp()</code></a><a href="footnotes.html#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a></li>
<li><a href="https://man.archlinux.org/man/signal.2"><code>signal()</code></a><a href="footnotes.html#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a></li>
</ul>
<!-- Beej's guide to IPC

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<!-- ======================================================= -->
<!-- Pipes -->
<!-- ======================================================= -->
<hr><div style="text-align:center"><span><a href="fork.html">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="pipes.html">Next</a></span></div></body>
</html>
