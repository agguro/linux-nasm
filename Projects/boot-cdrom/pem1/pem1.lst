     1                                  org 0
     2                                  BITS 16
     3                                  
     4 00000000 EB22                         jmp       start
     5 00000002 50454D31206C6F6164-     pemloading:  db   'PEM1 loading, please wait....', 10, 13, 0
     5 0000000B 696E672C20706C6561-
     5 00000014 736520776169742E2E-
     5 0000001D 2E2E0A0D00         
     6 00000022 0000                    videomode:   dw   0
     7                                  
     8                                  start:
     9                                  %define FIRSTBANK  0
    10                                  %define STARTBANK 10
    11                                  %define LASTBANK  79
    12                                  %define ENDBANK   LASTBANK
    13                                  %define LINES_PER_BANK 13
    14                                  %define PIXELS_PER_LINE 1280
    15                                  %define SCAN_LINES 1240
    16                                  %define DISPLACEMENT 256
    17                                  ; 1280 * 1024 = 1310720 pixels / screen
    18                                  ; 13 * 1280 = 16640 pixels per bank
    19                                  ; 1310720 / 16640 = 78,7 banks per screen (79)
    20                                  
    21 00000024 B800A0                  mov ax, 0xA000
    22 00000027 8EC0                    mov es,ax
    23 00000029 8ED8                    mov ds,ax
    24                                  
    25 0000002B B90A00                  mov cx, STARTBANK                                              ; banknumber
    26                                  nextbank:
    27                                  ; switch bank
    28 0000002E B8054F                   mov ax, 0x4F05
    29 00000031 BB0000                   mov bx, 0
    30 00000034 89CA                     mov dx, cx                                            ; switch to banknumber in cx
    31 00000036 CD10                     int 0x10
    32                                   ; draw again
    33 00000038 B80001                   mov ax, DISPLACEMENT                                            ; banknr * displacement 256
    34 0000003B 89CB                     mov bx, cx
    35 0000003D F7E3                     mul bx
    36 0000003F 89C7                     mov di, ax
    37 00000041 B204                     mov dl, 00000100b                                       
    38 00000043 51                       push cx                                                 ; save banknumber
    39 00000044 B90041                   mov cx, PIXELS_PER_LINE*LINES_PER_BANK
    40 00000047 51                       push cx
    41                                   repeat:
    42 00000048 59                       pop  cx
    43 00000049 AC                       lodsb
    44 0000004A 08D0                     or al, dl
    45 0000004C AA                       stosb
    46 0000004D 49                       dec cx
    47 0000004E 21C9                     and cx, cx
    48 00000050 51                       push cx
    49 00000051 75F5                     jnz repeat
    50 00000053 59                       pop cx
    51 00000054 59                       pop cx                                                ; restore banknumber
    52 00000055 41                       inc cx
    53 00000056 83F94F                   cmp cx, ENDBANK
    54 00000059 75D3                     jne nextbank
    55                                   
    56 0000005B B8054F                  mov ax, 0x4F05
    57 0000005E BB0000                   mov bx, 0
    58 00000061 BA0000                   mov dx, FIRSTBANK                                            ; switch to banknumber in cx
    59 00000064 CD10                     int 0x10
    60                                  
    61                                   ;%define BANK 10
    62                                   ;string:
    63                                   ;mov  ax, 0x4f05
    64                                   ;mov  bx, 0
    65                                   ;mov  dx, BANK
    66                                   ;int  0x10
    67                                   
    68                                   ;mov ax, 0xA000
    69                                   ;mov es, ax
    70                                   ;mov di, BANK*256
    71                                   ;mov al, 255
    72                                   ;mov cx, 1280*13
    73                                   ;rep movsb
    74                                   
    75                                   
    76                                   ;mov  ax, 0x4f05
    77                                   ;mov  bx, 0
    78                                   ;mov  dx, 0
    79                                   ;int  0x10
    80 00000066 8CC8                         mov       ax, cs
    81 00000068 8EC0                         mov       es, ax
    82 0000006A 8ED8                         mov       ds, ax
    83 0000006C BE[0200]                     mov       si, pemloading
    84                                       ; test if stack behaves
    85 0000006F 56                           push      si
    86 00000070 31F6                         xor       si, si
    87 00000072 5E                           pop       si
    88 00000073 E80100                       call      Print
    89 00000076 CB                           retf
    90                                  
    91                                  Print:
    92 00000077 60                           pusha
    93 00000078 B40E                         mov       ah, 0Eh              ; int 10h teletype function
    94 0000007A BB0F00                       mov       bx, 0x000F
    95                                  .repeat:
    96 0000007D AC                           lodsb                    ; Get char from string
    97 0000007E 3C00                         cmp       al, 0
    98 00000080 7404                         je        .done          ; If char is zero, end of string
    99 00000082 CD10                         int       10h            ; Otherwise, print it
   100 00000084 EBF7                         jmp       .repeat        ; And move on to next char
   101                                  .done:
   102 00000086 61                           popa
   103 00000087 C3                           ret
   104                                       
   105                                       
   106                                  ;0 = black               8 = dark grey
   107                                  ;1 = dark blue           9 = bright blue
   108                                  ;2 = dark green          a = bright green
   109                                  ;3 = dark cyan           b = bright cyan
   110                                  ;4 = dark red            c = bright red
   111                                  ;5 = dark purple         d = bright purple
   112                                  ;6 = brown               e = yellow
   113                                  ;7 = light grey          f = white     
